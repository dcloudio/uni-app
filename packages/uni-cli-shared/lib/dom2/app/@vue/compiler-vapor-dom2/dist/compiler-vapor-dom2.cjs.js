"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var y=require("@vue/compiler-dom"),d=require("@vue/compiler-vapor"),N=require("@vue/shared"),fe=require("@babel/parser"),Ht=require("@babel/types"),tt=require("estree-walker"),Kt=require("source-map-js");function Js(t,e){}function js(t,e){}function zt(t,e=[]){const n=t.ast||t._fastPathAst;if(n)return me(n);if(t.isStatic)return!0;if(t.ast===null)try{return t._fastPathAst=fe.parseExpression(t.content,{plugins:e}),me(t._fastPathAst)}catch{}return!1}function me(t){switch(t=y.unwrapTSNode(t),t.type){case"UnaryExpression":return t.operator==="void"?!1:me(t.argument);case"ParenthesizedExpression":return me(t.expression);case"StringLiteral":case"NumericLiteral":case"BooleanLiteral":case"NullLiteral":case"BigIntLiteral":return!0}return!1}function Ee(t){try{return!!new Function(`return ${t.content}`)()}catch{}return null}function nt(t){try{const e=new Function(`return ${t.content}`)();return typeof e=="string"?e:null}catch{}return null}function qt(t,e){J(t.key,e),rt(t.values,e)}function rt(t,e,n=!1,r=!1){t.forEach(s=>{J(s,e,n,r)})}function J(t,e,n=!1,r=!1){(n||!zt(t))&&(t.sharedData={ident:e.nextIdent()})}function Xt(t,e){t.delegate=!1,J(t.key,e),t.sharedData={ident:e.nextIdent()}}function Zt(t,e){J(t.event,e,!0)}function Qt(t,e){J(t.source,e,!0);const n=e.enterIdent();t.keyProp&&J(t.keyProp,e,!0),we(t.render,e),n()}function en(t,e){J(t.value,e)}function st(t,e){const{condition:n,positive:r,negative:s}=t;Ee(n)===null&&J(n,e,!0),ne(r,e),s&&(s.type===1?ne(s,e):st(s,e))}function tn(t,e){qt(t.prop,e)}function nn(t,e){t.sharedData={ident:e.nextIdent()}}function rn({node:t,value:e},n){t.tagType===0&&J(e,n,!0)}function Bs(t,e){}function sn(t,e){rt(t.values,e,!1,!0)}function Ys(t,e){}function an(t,e){t.sharedData={ident:e.nextIdent()},t.slots.forEach(n=>{switch(n.slotType){case 0:Object.keys(n.slots).forEach(s=>{ne(n.slots[s],e)});break;case 1:nt(n.name)||(n.name.sharedData={ident:e.nextIdent()}),ne(n.fn,e);break;case 2:J(n.loop.source,e);const r=e.enterIdent();nt(n.name)||(n.name.sharedData={ident:e.nextIdent()}),ne(n.fn,e),r();break;case 3:at(n,e);break}})}function at(t,e){Ee(t.condition)===null&&J(t.condition,e,!0),ne(t.positive.fn,e),t.negative&&(t.negative.slotType===3?at(t.negative,e):ne(t.negative.fn,e))}function on(t,e){const{fallback:n,name:r}=t;J(r,e),n&&ne(n,e)}function ln({dir:{exp:t}},e){t&&J(t,e)}function cn({dir:t},e){const n=t.exp;J(n,e,!0),n.sharedData.vModel={eventIdent:e.nextIdent()}}function un(t,e){switch(t.name){case"show":return ln(t,e);case"model":return cn(t,e)}}function it(t,e){for(const n of t)ot(n,e)}function ot(t,e){fn(t,e)}function fn(t,e){switch(t.type){case 2:return tn(t,e);case 3:return nn(t,e);case 4:return sn(t,e);case 5:return Xt(t,e);case 6:return Zt(t,e);case 7:return en(t,e);case 8:return rn(t,e);case 9:return void 0;case 10:return void 0;case 15:return st(t,e);case 16:return Qt(t,e);case 11:return an(t,e);case 14:return void 0;case 12:return on(t,e);case 13:return un(t,e);case 17:return void 0;default:const n=t;throw new Error(`Unhandled operation type in genOperation: ${n}`)}}function pn(t,e){for(const n of t)dn(n,e)}function dn({operations:t},e){it(t,e)}function Oe(t,e){const{operation:n}=t;n&&ot(n,e)}function lt(t,e){const{children:n}=t;let r=0;const s=[];for(const[,a]of n.entries()){a.flags&2&&r--;const i=a.flags&1?a.flags&4?a.anchor:a.id:void 0;if(i===void 0&&!a.hasDynamicChild){Oe(a,e);continue}i===a.anchor&&Oe(a,e),s.push(a)}for(const a of s)lt(a,e)}function ne(t,e){we(t,e)}function we(t,e){const{dynamic:n,effect:r,operation:s}=t,a=e.enterBlock(t);for(const i of n.children)Oe(i,e);for(const i of n.children)lt(i,e);it(s,e),pn(r,e),a()}class Me{constructor(e=1e3,n=30){if(this._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",this._nextIds=[0],this._generated=[],this._currentIndex=0,e<0)throw new Error("\u9884\u751F\u6210\u6570\u91CF\u4E0D\u80FD\u4E3A\u8D1F\u6570");this._groupSize=n,e>0&&this._pregenerate(e)}_generateId(){const e=[];for(const n of this._nextIds)e.unshift(this._chars[n]);return e.join("")}_generateNextValidId(){let e;do e=this._generateId(),this._increment();while(hn.has(e));return e}_pregenerate(e){this._generated=new Array(e);for(let n=0;n<e;n++)this._generated[n]=this._generateNextValidId()}next(){if(this._currentIndex<this._generated.length)return this._generated[this._currentIndex++];const e=this._generateNextValidId();return this._generated.push(e),this._currentIndex++,e}getIndexOf(e){return this._generated.indexOf(e)}getGroupInfo(e){const n=this.getIndexOf(e);return n===-1?null:{index:Math.floor(n/this._groupSize),bitValue:1<<n%this._groupSize}}reset(){this._nextIds=[0],this._generated=[],this._currentIndex=0}get generatedCount(){return this._generated.length}get currentIndex(){return this._currentIndex}get hasPregenerated(){return this._currentIndex<this._generated.length}get generatedList(){return this._generated}_increment(){for(let e=0;e<this._nextIds.length;e++)if(++this._nextIds[e]>=this._chars.length)this._nextIds[e]=0;else return;this._nextIds.push(0)}*[Symbol.iterator](){for(;;)yield this.next()}}const hn=new Set(["abstract","arguments","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield"]);class gn{constructor(e,n){this._ident=new Me,this._identCache=new Map,this.ir=e,this.options=n,this.block=e.block,this._identCache.set(this._ident,new Map)}enterBlock(e){const n=this.block;return this.block=e,()=>this.block=n}enterIdent(){const e=this._ident;return this._ident=new Me,this._identCache.set(this._ident,new Map),()=>this._ident=e}nextIdent(){return this._ident.next()}}function mn(t,e){const n=new gn(t,e);we(t.block,n)}function En({parent:t,elements:e,anchor:n},{helper:r}){let s=e.map(a=>`n${a}`).join(", ");return e.length>1&&(s=`[${s}]`),[d.NEWLINE,...d.genCall(r("insert"),s,`n${t}`,n===void 0?void 0:`n${n}`)]}function $n(t,{helper:e}){return[d.NEWLINE,...d.genCall(e("prepend"),`n${t.parent}`,...t.elements.map(n=>`n${n}`))]}function I(t,e,n){const{content:r,ast:s,isStatic:a,loc:i}=t;if(a)return[[JSON.stringify(r),-2,i]];if(!t.content.trim()||s===!1||d.isConstantExpression(t))return[[r,-2,i],n&&` = ${n}`];if(s===null)return ct(r,e,i,n);const o=[],l=new Map,c=[];y.walkIdentifiers(s,f=>{o.push(f),l.set(f,c.slice())},!1,c);let u=!1;if(o.length){const[f,p]=d.buildCodeFragment(),h=s&&y.TS_NODE_TYPES.includes(s.type);return o.sort((g,m)=>g.start-m.start).forEach((g,m)=>{const S=g.start-1,b=g.end-1,_=o[m-1];if(!(h&&m===0)){const T=r.slice(_?_.end-1:0,S);T.length&&p([T,-3])}const w=r.slice(S,b),F=l.get(g),B=F[F.length-1];u||(u=B&&(B.type==="MemberExpression"||B.type==="OptionalMemberExpression")),p(...ct(w,e,{start:y.advancePositionWithClone(t.loc.start,w,S),end:y.advancePositionWithClone(t.loc.start,w,b),source:w},u?void 0:n,g,B,F)),m===o.length-1&&b<r.length&&!h&&p([r.slice(b),-3])}),n&&u&&p(` = ${n}`),f}else return[[r,-3,i]]}function ct(t,e,n,r,s,a,i){const{options:o,helper:l,identifiers:c}=e,{inline:u,bindingMetadata:f}=o;let p=t;const h=c[t];if(h&&h.length){const _=h[0];return N.isString(_)?a&&a.type==="ObjectProperty"&&a.shorthand?[[`${p}: ${_}`,-2,n]]:[[_,-2,n]]:I(_,e,r)}let g;y.isStaticProperty(a)&&a.shorthand&&(g=`${t}: `);const m=f&&f[t];if(u)switch(m){case"setup-let":p=t=r?`_isRef(${t}) ? (${t}.value = ${r}) : (${t} = ${r})`:b();break;case"setup-ref":p=t=S(`${t}.value`);break;case"setup-maybe-ref":const _=a&&y.isInDestructureAssignment(a,i||[]),w=a&&a.type==="AssignmentExpression"&&a.left===s,F=a&&a.type==="UpdateExpression"&&a.argument===s;t=w||F||_?p=`${t}.value`:r?`${l("isRef")}(${t}) ? (${t}.value = ${r}) : null`:b();break;case"props":t=N.genPropsAccessExp(t);break;case"props-aliased":t=N.genPropsAccessExp(f.__propsAliases[t]);break;default:t=S(t)}else yn(t)&&(m==="props-aliased"?t=`$props['${f.__propsAliases[t]}']`:t=`${m==="props"?"$props":"_ctx"}.${t}`),t=S(t);return[g,[t,-2,n,p]];function S(_){return r?`${_} = ${r}`:_}function b(){return`${l("unref")}(${t})`}}function yn(t){return!(N.isGloballyAllowed(t)||t==="require"||t==="$props"||t==="$emit"||t==="$attrs"||t==="$slots")}function Nn(t,e,n){const{seenVariable:r,variableToExpMap:s,expToVariableMap:a,seenIdentifier:i,updatedVariable:o}=Sn(e),l=vn(t,r,s,a,i,o),c=_n(t,e,l,o,a);return Tn([...l,...c],t,n)}function Sn(t){const e=Object.create(null),n=new Map,r=new Map,s=new Set,a=new Set,i=(o,l,c,u,f=[])=>{c&&s.add(o),e[o]=(e[o]||0)+1,n.set(o,(n.get(o)||new Set).add(l));const p=r.get(l)||[];p.push({name:o,loc:u}),r.set(l,p),f.some(h=>h.type==="UpdateExpression"||h.type==="AssignmentExpression")&&a.add(o)};for(const o of t){if(!o.ast){o.ast===null&&i(o.content,o,!0);continue}y.walkIdentifiers(o.ast,(l,c,u)=>{if(c&&ut(c)){const f=re(c,p=>{i(p.name,o,!0,{start:p.start,end:p.end})});i(f,o,!1,{start:c.start,end:c.end},u)}else u.some(ut)||i(l.name,o,!0,{start:l.start,end:l.end},u)})}return{seenVariable:e,seenIdentifier:s,variableToExpMap:n,expToVariableMap:r,updatedVariable:a}}function vn(t,e,n,r,s,a){const i=[],o=new Map;for(const[l,c]of n)if(!a.has(l)&&e[l]>1&&c.size>0){const u=s.has(l),f=u?l:Ae(l);c.forEach(p=>{if(p.ast&&f!==l){const h=o.get(p)||[];h.push({name:f,locs:r.get(p).reduce((g,m)=>(m.name===l&&m.loc&&g.push(m.loc),g),[])}),o.set(p,h)}}),!i.some(p=>p.name===f)&&(!u||In(l,r,c))&&i.push({name:f,isIdentifier:u,value:N.extend({ast:u?null:$e(t,l)},y.createSimpleExpression(l)),rawName:l,exps:c,seenCount:e[l]})}for(const[l,c]of o)c.flatMap(({name:u,locs:f})=>f.map(({start:p,end:h})=>({start:p,end:h,name:u}))).sort((u,f)=>f.end-u.end).forEach(({start:u,end:f,name:p})=>{l.content=l.content.slice(0,u-1)+p+l.content.slice(f-1)}),l.ast=$e(t,l.content);return i}function In(t,e,n){const r=Array.from(n,a=>e.get(a).map(i=>i.name));if(r.every(a=>a.length===1)||r.some(a=>a.filter(i=>i===t).length>1))return!0;const s=r[0];return r.some(a=>a.length!==s.length)?!(r.some(a=>a.length>s.length&&a.every(i=>s.includes(i)))||r.some(a=>s.length>a.length&&s.every(i=>a.includes(i)))):!r.some(a=>a.some(i=>s.includes(i)))}function _n(t,e,n,r,s){const a=[],i=e.reduce((o,l)=>{const c=s.get(l).map(u=>u.name);return l.ast&&l.ast.type!=="Identifier"&&!(c&&c.some(u=>r.has(u)))&&(o[l.content]=(o[l.content]||0)+1),o},Object.create(null));return Object.entries(i).forEach(([o,l])=>{if(l>1){const c=Ae(o);if(!a.some(u=>u.name===c)){const u={};for(let p=n.length-1;p>=0;p--){const h=n[p];!h.exps||!h.seenCount||[...h.exps].every(g=>g.content===o&&h.seenCount===l)&&(u[h.name]=h.rawName,n.splice(p,1))}const f=N.extend({},e.find(p=>p.content===o));Object.keys(u).forEach(p=>{f.content=f.content.replace(p,u[p]),f.ast&&(f.ast=$e(t,f.content))}),a.push({name:c,value:f})}e.forEach(u=>{u.content===o?(u.content=c,u.ast=null):u.content.includes(o)&&(u.content=u.content.replace(new RegExp(Dn(o),"g"),c),u.ast=$e(t,u.content))})}}),a}function Tn(t,e,n){const[r,s]=d.buildCodeFragment(),a=Object.create(null),i=new Set;return t.forEach(({name:o,isIdentifier:l,value:c})=>{if(l){const u=a[o]=`_${o}`;i.add(u),n&&s("const "),s(`${u} = `,...I(c,e),d.NEWLINE)}}),t.forEach(({name:o,isIdentifier:l,value:c})=>{if(!l){const u=a[o]=`_${o}`;i.add(u),n&&s("const "),s(`${u} = `,...e.withId(()=>I(c,e),a),d.NEWLINE)}}),{ids:a,frag:r,varNames:[...i]}}function Dn(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $e(t,e){const n=t.options.expressionPlugins,r={plugins:n?[...n,"typescript"]:["typescript"]};return fe.parseExpression(`(${e})`,r)}function Ae(t){return`${t.replace(/[^a-zA-Z0-9]/g,"_").replace(/_+/g,"_").replace(/_+$/,"")}`}function re(t,e){if(!t)return"";switch(t.type){case"Identifier":return e(t),t.name;case"StringLiteral":return t.extra?t.extra.raw:t.value;case"NumericLiteral":return t.value.toString();case"BinaryExpression":return`${re(t.left,e)} ${t.operator} ${re(t.right,e)}`;case"CallExpression":return`${re(t.callee,e)}(${t.arguments.map(s=>re(s,e)).join(", ")})`;case"MemberExpression":case"OptionalMemberExpression":const n=re(t.object,e),r=t.computed?`[${re(t.property,e)}]`:`.${re(t.property,N.NOOP)}`;return`${n}${r}`;default:return""}}const ut=t=>t.type==="MemberExpression"||t.type==="OptionalMemberExpression";function ft(t,e,n,r){return t.sharedData?d.genCall(e.helper("setSharedData"),e.sharedDataVar,JSON.stringify(t.sharedData.ident),n?d.genCall(n,I(t,e)):I(t,e)):I(t,e)}function xn(t,e){const{key:n,keyOverride:r,value:s,modifiers:a,sharedData:i}=t,o=ke(e,s,a);return[d.NEWLINE,...n.sharedData?d.genCall(e.helper("setSharedData"),e.sharedDataVar,JSON.stringify(n.sharedData.ident),l()).concat(d.NEWLINE):[],...d.genCall(e.helper("setSharedDataEvent"),e.sharedDataVar,JSON.stringify(i.ident),o)];function l(){const c=I(n,e);if(r){const u=JSON.stringify(r[0]),f=JSON.stringify(r[1]),p=["(",...c,")"];return[...p,` === ${u} ? ${f} : `,...p]}else return I(n,e)}}function Cn(t,e){return[d.NEWLINE,...d.genCall(e.helper("setSharedDataDynamicEvents"),e.sharedDataVar,JSON.stringify(t.event.sharedData.ident),I(t.event,e))]}function ke(t,e,n={nonKeys:[],keys:[]},r=!1){let s=["() => {}"];if(e&&e.content.trim())if(y.isMemberExpression(e,t.options))s=I(e,t),!bn(e,t)&&!r&&(e.ast&&e.ast.type==="TSAsExpression"?s=["(e: any) => (",e.content,")(e)"]:s=["(e: any) => ",...s,"(e)"]);else if(y.isFnExpression(e,t.options))s=I(e,t);else{const a=e.content.includes("$event"),i=e.content.includes(";"),o=a?t.withId(()=>I(e,t),{$event:null}):I(e,t);s=[a?"($event: any) => ":"() => ",i?"{":"(",...o,i?"}":")"]}return r&&s.unshift("() => "),s}function bn(t,e){if(t.ast===null&&e.options.bindingMetadata[t.content]==="setup-const")return!0}function On(t,e){const{helper:n}=e,{source:r,value:s,key:a,index:i,render:o,keyProp:l,once:c,id:u,component:f,onlyChild:p}=t,h=e.sharedDataVar;let g=null;const m=a&&a.content,S=i&&i.content,b=["() => (",...I(r,e),")"],_=k(),w=e.enterVFor(),[F,B]=e.enterScope(),T={},Z=`_for_item${w}`;T[Z]=null,_.forEach(($,O)=>{let D=`${Z}.value${$?$.path:""}`;if($)if($.helper&&(T[$.helper]=null,D=`${$.helper}(${D}, ${$.helperArgs})`),$.dynamic){const R=T[O]=y.createSimpleExpression(D),Q=e.options.expressionPlugins;R.ast=fe.parseExpression(`(${D})`,{plugins:Q?[...Q,"typescript"]:["typescript"]})}else T[O]=D;else T[O]=D});const le=[e.sharedDataVForVar,", ",Z];if(m){const $=`_for_key${w}`;le.push(`, ${$}`),T[m]=`${$}.value`,T[$]=null}if(S){const $=`_for_index${w}`;le.push(`, ${$}`),T[S]=`${$}.value`,T[$]=null}const ce=d.genCall(n("setSharedData"),h,JSON.stringify(r.sharedData.ident),ht(e)),de=M(l,e,e.sharedDataVForVar),{selectorPatterns:ee,keyOnlyBindingPatterns:te}=pt(o,l,T),he=[],ae=[];for(let $=0;$<ee.length;$++){const{selector:O}=ee[$],D=`_selector${u}_${$}`;he.push(`let ${D}: (oper: () => void) => void`,d.NEWLINE),$===0&&ae.push("({ createSelector }) => {",d.INDENT_START),ae.push(d.NEWLINE,`${D} = `,...d.genCall("createSelector",["() => ",...I(O,e)])),$===ee.length-1&&ae.push(d.INDENT_END,d.NEWLINE,"}")}const be=e.withId(()=>{const $=[];return $.push("(",...le,") => {",d.INDENT_START),ee.length||te.length?$.push(...Ne(o,e,!1,()=>{const O=[];for(let D=0;D<ee.length;D++){const{effect:R}=ee[D];O.push(d.NEWLINE,`_selector${u}_${D}(() => {`,d.INDENT_START);for(const Q of R.operations)O.push(...We(Q,e));O.push(d.INDENT_END,d.NEWLINE,"})")}for(const{effect:D}of te)for(const R of D.operations)O.push(...We(R,e));return O})):$.push(...Ne(o,e)),$.push(d.INDENT_END,d.NEWLINE,"}"),$},T);B();let v=0;return p&&(v|=1),f&&(v|=2),c&&(v|=4),[d.NEWLINE,...he,...d.genCall([n("createSharedDataFor"),"undefined"],ce,b,be,de,v?String(v):void 0,ae.length?ae:void 0)];function k(){const $=new Map;return s&&(g=s&&s.content,s.ast?y.walkIdentifiers(s.ast,(O,D,R,Q,ue)=>{if(ue){let U="",A=!1,H,L;for(let ge=0;ge<R.length;ge++){const W=R[ge],ie=R[ge+1]||O;if(W.type==="ObjectProperty"&&W.value===ie)W.key.type==="StringLiteral"?U+=`[${JSON.stringify(W.key.value)}]`:W.computed?(A=!0,U+=`[${s.content.slice(W.key.start-1,W.key.end-1)}]`):U+=`.${W.key.name}`;else if(W.type==="ArrayPattern"){const K=W.elements.indexOf(ie);ie.type==="RestElement"?U+=`.slice(${K})`:U+=`[${K}]`}else W.type==="ObjectPattern"&&ie.type==="RestElement"&&(H=e.helper("getSharedDataRestElement"),L="["+W.properties.filter(K=>K.type==="ObjectProperty").map(K=>K.key.type==="StringLiteral"?JSON.stringify(K.key.value):K.computed?(A=!0,s.content.slice(K.key.start-1,K.key.end-1)):JSON.stringify(K.key.name)).join(", ")+"]");ie.type==="AssignmentPattern"&&(W.type==="ObjectProperty"||W.type==="ArrayPattern")&&(A=!0,H=e.helper("getSharedDataDefaultValue"),L=s.content.slice(ie.right.start-1,ie.right.end-1))}$.set(O.name,{path:U,dynamic:A,helper:H,helperArgs:L})}},!0):$.set(g,null)),$}function M($,O,D){if(!$)return!1;const R=O.withId(()=>d.genCall(O.helper("setSharedData"),D,JSON.stringify($.sharedData.ident),I($,O)),G());return[...d.genMulti(["(",")",", "],D,g||(m||S?"_":void 0),m||(S?"__":void 0),S)," => (",...R,")"]}function G(){const $={};return m&&($[m]=null),S&&($[S]=null),_.forEach((O,D)=>$[D]=null),$}}function pt(t,e,n){const r=[],s=[];return t.effect.forEach(a=>{if(e!==void 0){const i=Mn(a,e.ast,n);i&&(r.push(i),a.generated=!0);const o=wn(a,e.ast);o&&(s.push(o),a.generated=!0)}}),{keyOnlyBindingPatterns:s,selectorPatterns:r}}function wn(t,e){if(t.expressions.length===1){const n=t.expressions[0].ast;if(typeof n=="object"&&n!==null&&pe(n,e))return{effect:t}}}function Mn(t,e,n){if(t.expressions.length===1){const r=t.expressions[0].ast;if(typeof r=="object"&&r){const a=[];if(tt.walk(r,{enter(i){if(typeof i=="object"&&i&&i.type==="BinaryExpression"&&i.operator==="==="&&i.left.type!=="PrivateName"){const{left:o,right:l}=i;for(const[c,u]of[[o,l],[l,o]]){const f=pe(c,e),p=pe(u,e),h=dt(u,n);f&&!p&&!h.locals.length&&a.push([c,u])}}}}),a.length===1){const[i,o]=a[0],l=t.expressions[0].content;let c=!1;const u=new Map,f=[];if(y.walkIdentifiers(r,p=>{p.start!==i.start&&p.start!==o.start&&(c=!0),u.set(p,f.slice())},!1,f),!c){const p=l.slice(o.start-1,o.end-1);return{effect:t,selector:{content:p,ast:N.extend({},o,{start:1,end:p.length+1}),loc:o.loc,isStatic:!1}}}}}const s=t.expressions[0].content;if(typeof r=="object"&&r&&r.type==="ConditionalExpression"&&r.test.type==="BinaryExpression"&&r.test.operator==="==="&&r.test.left.type!=="PrivateName"&&y.isStaticNode(r.consequent)&&y.isStaticNode(r.alternate)){const a=r.test.left,i=r.test.right;for(const[o,l]of[[a,i],[i,a]]){const c=pe(o,e),u=pe(l,e),f=dt(l,n);if(c&&!u&&!f.locals.length)return{effect:t,selector:{content:s.slice(l.start-1,l.end-1),ast:l,loc:l.loc,isStatic:!1}}}}}}function dt(t,e){let n=[],r=[];const s=[],a=new Map,i=[];y.walkIdentifiers(t,o=>{s.push(o),a.set(o,i.slice())},!1,i);for(const o of s)N.isGloballyAllowed(o.name)||(e[o.name]?r.push(o.name):n.push(o.name));return{globals:n,locals:r}}function pe(t,e){let n=!0;return tt.walk(t,{enter(r){if(Ht.isNodesEquivalent(r,e)){this.skip();return}r.type==="Identifier"&&(n=!1)}}),n}function ht(t){return`new UniSharedDataVFor(${t.sharedDataScopeVar}, () => ${t.helper("useSharedData")}<\`${t.sharedDataVForClass}\`>(${t.sharedDataScopeVar}))`}function An(t,e){var n;const{helper:r}=e,{value:s}=t;return[d.NEWLINE,...(n=s.sharedData)!=null&&n.ident?d.genCall(r("setSharedData"),e.sharedDataVar,JSON.stringify(s.sharedData.ident),I(s,e)):[]]}function gt(t,e,n=!1){const{helper:r}=e,{condition:s,positive:a,negative:i,once:o}=t,[l,c]=d.buildCodeFragment(),u=["() => ",...mt(s,e),""];let f=ye(a,e),p=!1;return i&&(i.type===1?p=ye(i,e):p=["() => ",...gt(i,e,!0)]),n||c(d.NEWLINE),c(...d.genCall(r("createSharedDataIf"),u,f,p,o&&"true")),l}function mt(t,e){return t.sharedData?d.genCall(e.helper("setSharedData"),e.sharedDataVar,JSON.stringify(t.sharedData.ident),d.genCall(e.helper("toBoolean"),I(t,e))):[JSON.stringify(Ee(t))]}const z={setText:{name:"setText"},setHtml:{name:"setHtml"},setClass:{name:"setClass"},setStyle:{name:"setStyle"},setValue:{name:"setValue"},setAttr:{name:"setAttr",needKey:!0},setProp:{name:"setProp",needKey:!0},setDOMProp:{name:"setDOMProp",needKey:!0}};function kn(t,e){const{prop:{key:n,values:r,modifier:s},tag:a}=t,i=Rn(a,n.content,s),[o,l]=d.buildCodeFragment();return r.filter(c=>{var u;return(u=c.sharedData)==null?void 0:u.ident}).forEach(c=>{l(d.NEWLINE,...d.genCall(e.helper(Nt(i.name)),e.sharedDataVar,JSON.stringify(c.sharedData.ident),Ve([c],e)))}),o}function Vn(t,e){const{helper:n}=e,r=t.props.map(s=>Array.isArray(s)?Et(s,e):s.kind===1?Et([s],e):I(s.value,e));return[d.NEWLINE,...d.genCall(n(Nt("setDynamicProps")),e.sharedDataVar,JSON.stringify(t.sharedData.ident),d.genMulti(d.DELIMITERS_ARRAY,...r))]}function Et(t,e){return d.genMulti(d.DELIMITERS_OBJECT,...t.map(n=>[...$t(n,e),": ",...Ve(n.values,e)]))}function $t({key:t,modifier:e,runtimeCamelize:n,handler:r,handlerModifiers:s},a){const{helper:i}=a,o=s?s.map(N.capitalize).join(""):"";if(t.isStatic){const c=(r?N.toHandlerKey(t.content):t.content)+o;return[[y.isSimpleIdentifier(c)?c:JSON.stringify(c),-2,t.loc]]}let l=I(t,a);return n&&(l=d.genCall(i("camelize"),l)),r&&(l=d.genCall(i("toHandlerKey"),l)),["[",e&&`${JSON.stringify(e)} + `,...l,o?` + ${JSON.stringify(o)}`:void 0,"]"]}function Ve(t,e){return t.length===1?I(t[0],e):d.genMulti(d.DELIMITERS_ARRAY,...t.map(n=>I(n,e)))}function Rn(t,e,n){const r=t.toUpperCase();return n?n==="."?yt(e,r)||z.setDOMProp:z.setAttr:yt(e,r)||(/aria[A-Z]/.test(e)?z.setDOMProp:N.isSVGTag(t)||N.shouldSetAsAttr(r,e)||e.includes("-")?z.setAttr:z.setProp)}function yt(t,e){if(t==="value"&&N.canSetValueDirectly(e))return z.setValue;if(t==="class")return z.setClass;if(t==="style")return z.setStyle;if(t==="innerHTML")return z.setHtml;if(t==="textContent")return z.setText}function Nt(t){switch(t){case"setClass":return"setSharedDataClass";case"setStyle":return"setSharedDataStyle";case"setText":case"setHtml":case"setValue":case"setAttr":case"setProp":case"setDOMProp":return"setSharedDataAttr";case"setDynamicProps":return"setSharedDataDynamicProps";default:const e=t;throw new Error(`Unhandled operation type in genOperation: ${e}`)}}const St="_setTemplateRef";function Ln(t,e){let n=d.genCall(St,`n${t.element}`,Fn(t.value,e),t.effect?`r${t.element}`:t.refFor?"void 0":void 0,t.refFor&&"true");return t.value.sharedData&&(n=d.genCall(e.helper("setSharedDataTemplateRef"),e.sharedDataVar,JSON.stringify(t.value.sharedData.ident),[`(n${t.element}: number) => {`,...n,"}"])),[d.NEWLINE,t.effect&&`r${t.element} = `,...n]}function Pn(t){return[d.NEWLINE,`let r${t.id}: any | null`]}function Fn(t,e){if(t&&e.options.inline){const n=e.options.bindingMetadata[t.content];if(n==="setup-let"||n==="setup-ref"||n==="setup-maybe-ref")return[t.content]}return I(t,e)}function Wn(t,e){const{helper:n}=e,{values:r}=t,[s,a]=d.buildCodeFragment(),i=new Set;return r.filter(o=>{var l;return(l=o.sharedData)==null?void 0:l.ident}).forEach(o=>{const l=o.sharedData.ident;i.has(l)||(i.add(l),a(d.NEWLINE,...d.genCall(n("setSharedData"),e.sharedDataVar,JSON.stringify(o.sharedData.ident),d.genCall(e.helper("toDisplayString"),I(o,e)))))}),s}function Jn(t,e){return[]}function jn({dir:{exp:t}},e){return t?[d.NEWLINE,...d.genCall(e.helper("applyVShow"),["() => { ",...d.genCall(e.helper("setSharedData"),e.sharedDataVar,JSON.stringify(t.sharedData.ident),d.genCall(e.helper("toBoolean"),I(t,e)))," }"])]:[]}function Bn(t,e){const{dir:{exp:n,modifiers:r}}=t,s=n.sharedData;return[d.NEWLINE,...d.genCall(e.helper("setSharedDataEvent"),e.sharedDataVar,JSON.stringify(s.vModel.eventIdent),d.genCall(e.helper("setSharedDataModel"),e.sharedDataVar,JSON.stringify(s.ident),["() => (",...I(n,e),")"],vt(n,e),r.length?`{ ${r.map(a=>a.content+": true").join(",")} }`:void 0))]}function vt(t,e){return[`${e.options.isTS?"(_value: any)":"_value"} => (`,...I(t,e,"_value"),")"]}function Yn(t,e){switch(t.name){case"show":return jn(t,e);case"model":return Bn(t,e);default:return[]}}function Gn(t){return t.map(e=>`${y.isSimpleIdentifier(e)?e:JSON.stringify(e)}: true`).join(", ")}function Un(t,e){const{helper:n}=e,r=m(),{root:s,props:a,slots:i,sharedData:o}=t,l=Xn(i,e),[c,u]=Kn(a,e),f=e.withId(()=>It(a,e),c),p=u.reduce((S,{name:b,value:_})=>{const w=ke(e,_,void 0,!1);return[...S,`const ${b} = `,...w,d.NEWLINE]},[]),h=t.dynamic&&!t.dynamic.isStatic,g=t.asset;return[d.NEWLINE,...p,`const n${t.id} = `,...d.genCall(n(h?"createSharedDataDynamicComponent":g?"createSharedDataComponentWithFallback":"createSharedDataComponent"),r,f,l,s?"true":!1),d.NEWLINE,...d.genCall(n("setSharedData"),e.sharedDataVar,JSON.stringify(o.ident),[`n${t.id}`,g?"?.sharedData":".sharedData"])];function m(){return t.dynamic?t.dynamic.isStatic?d.genCall(n("resolveDynamicComponent"),I(t.dynamic,e)):["() => (",...I(t.dynamic,e),")"]:t.asset?y.toValidAssetId(t.tag,"component"):I(N.extend(y.createSimpleExpression(t.tag,!1),{ast:null}),e)}}function Hn(t,e){const{seenInlineHandlerNames:n}=t;e=Ae(e);const r=n[e]||0;return n[e]=r+1,r===0?e:`${e}${r}`}function Kn(t,e){const n=Object.create(null),r=[],s=t[0];if(N.isArray(s))for(let a=0;a<s.length;a++){const i=s[a];i.handler&&i.values.forEach((o,l)=>{if(!y.isMemberExpression(o,e.options)){const c=Hn(e,`_on_${i.key.content}`);r.push({name:c,value:o}),n[c]=null,i.values[l]=N.extend({ast:null},y.createSimpleExpression(c))}})}return[n,r]}function It(t,e){const n=t[0];if(N.isArray(n))return!n.length&&t.length===1?void 0:Re(n,e,_t(t.slice(1),e));if(t.length)return Re([],e,_t(t,e))}function Re(t,e,n){const r=t.map(s=>Tt(s,e,!0));return n&&r.push(["$: ",...n]),d.genMulti(r.length>1?d.DELIMITERS_OBJECT_NEWLINE:d.DELIMITERS_OBJECT,...r)}function _t(t,e){const{helper:n}=e,r=[];for(const s of t){let a;if(N.isArray(s)){s.length&&r.push(Re(s,e));continue}else s.kind===1?a=d.genMulti(d.DELIMITERS_OBJECT,Tt(s,e)):(a=I(s.value,e),s.handler&&(a=d.genCall(n("toHandlers"),a)));r.push(["() => (",...a,")"])}if(r.length)return d.genMulti(d.DELIMITERS_ARRAY_NEWLINE,...r)}function Tt(t,e,n){const r=Ve(t.values,e);return[...$t(t,e),": ",...t.handler?ke(e,t.values[0],void 0,!0):n?["() => (",...r,")"]:r,...t.model?[...zn(t,e),...qn(t,e)]:[]]}function zn(t,e){const n=t.key.isStatic?[JSON.stringify(`onUpdate:${N.camelize(t.key.content)}`)]:['["onUpdate:" + ',...I(t.key,e),"]"],r=vt(t.values[0],e);return[",",d.NEWLINE,...n,": () => ",...r]}function qn(t,e){const{key:n,modelModifiers:r}=t;if(!r||!r.length)return[];const s=n.isStatic?n.content==="modelValue"?["modelModifiers"]:[`${n.content}Modifiers`]:["[",...I(n,e),' + "Modifiers"]'],a=Gn(r);return[",",d.NEWLINE,...s,`: () => ({ ${a} })`]}function Xn(t,e){if(!t.length)return;const n=t[0];return n.slotType===0?Le(n,e,t.length>1?t.slice(1):void 0):Le({slots:{}},e,t)}function Le({slots:t},e,n){const r=Object.keys(t).map(s=>[`${JSON.stringify(s)}: `,...Fe(t[s],e)]);return n&&r.push(["$: ",...Zn(n,e)]),d.genMulti(d.DELIMITERS_OBJECT_NEWLINE,...r)}function Zn(t,e){return d.genMulti(d.DELIMITERS_ARRAY_NEWLINE,...t.map(n=>n.slotType===0?Le(n,e):n.slotType===4?n.slots.content:Pe(n,e,!0)))}function Pe(t,e,n=!1){let r;switch(t.slotType){case 1:r=Qn(t,e);break;case 2:r=er(t,e);break;case 3:r=tr(t,e);break}return n?["() => (",...r,")"]:r}function Qn(t,e){const{name:n,fn:r}=t;return d.genMulti(d.DELIMITERS_OBJECT_NEWLINE,["name: ",...ft(n,e,e.helper("toDisplayString"))],["fn: ",...Fe(r,e)])}function er(t,e){e.enterVFor();const{name:n,fn:r,loop:s}=t,{value:a,key:i,index:o,source:l}=s,c=a&&a.content,u=i&&i.content,f=o&&o.content,p={};c&&(p[c]=c),u&&(p[u]=u),f&&(p[f]=f);const h=d.genMulti(d.DELIMITERS_OBJECT_NEWLINE,["name: ",...e.withId(()=>{if(!n.sharedData)return I(n,e);const g=e.enterBlock(r),m=ft(n,e,e.helper("toDisplayString"));return g(),m},p)],["fn: ",...e.withId(()=>Fe(r,e),p)]);return[...d.genCall(e.helper("createSharedDataForSlots"),d.genCall(e.helper("setSharedData"),e.sharedDataVar,JSON.stringify(l.sharedData.ident),ht(e)),I(l,e),[...d.genMulti(["(",")",", "],e.sharedDataVForVar,c||(u||f?"_":void 0),u||(f?"__":void 0),f)," => (",...h,")"])]}function tr(t,e){const{condition:n,positive:r,negative:s}=t;return[...mt(n,e),d.INDENT_START,d.NEWLINE,"? ",...Pe(r,e),d.NEWLINE,": ",...s?[...Pe(s,e)]:["void 0"],d.INDENT_END]}function Fe(t,e){let n=!1,r,s,a,i;const{props:o}=t,l=new Set;o&&(r=o.content,(n=!!o.ast)?([i,a]=e.enterScope(),s=`_slotProps${i}`,y.walkIdentifiers(o.ast,(f,p,h,g,m)=>{m&&l.add(f.name)},!0)):l.add(s=r));const c={};l.forEach(f=>c[f]=n?`${s}[${JSON.stringify(f)}]`:null);const u=e.withId(()=>ye(t,e,[s]),c);return a&&a(),u}function nr(t,e){const{helper:n}=e,{name:r,fallback:s}=t,[a,i]=d.buildCodeFragment(),o=r.sharedData?["() => (",...d.genCall(e.helper("setSharedData"),e.sharedDataVar,JSON.stringify(r.sharedData.ident),I(r,e)),")"]:I(r,e);let l;return s&&(l=ye(s,e)),i(d.NEWLINE,...d.genCall(n("createSharedDataSlot"),o,It(t.props,e)||"null",l)),a}function Dt(t,e){const[n,r]=d.buildCodeFragment();for(const s of t)r(...xt(s,e));return n}function xt(t,e){const[n,r]=d.buildCodeFragment();return r(...We(t,e)),n}function We(t,e){switch(t.type){case 2:return kn(t,e);case 3:return Vn(t,e);case 4:return Wn(t,e);case 5:return xn(t,e);case 6:return Cn(t,e);case 7:return An(t,e);case 8:return Ln(t,e);case 9:return En(t,e);case 10:return $n(t,e);case 15:return gt(t,e);case 16:return On(t,e);case 11:return Un(t,e);case 14:return Pn(t);case 12:return nr(t,e);case 13:return Yn(t,e);case 17:return Jn();default:const n=t;throw new Error(`Unhandled operation type in genOperation: ${n}`)}}function rr(t,e,n){const{helper:r}=e,s=t.flatMap(h=>h.expressions),[a,i,o]=d.buildCodeFragment(),l=n===void 0;let c=0;const{ids:u,frag:f,varNames:p}=Nn(e,s,l);i(...f);for(let h=0;h<t.length;h++){const g=t[h];c+=g.operations.length;const m=e.withId(()=>sr(g,e),u);h>0&&i(d.NEWLINE),a[a.length-1]===")"&&m[0]==="("&&i(";"),i(...m)}return(a.filter(h=>h===d.NEWLINE).length>1||c>1||f.length>0)&&(o("{",d.INDENT_START,d.NEWLINE),i(d.INDENT_END,d.NEWLINE,"}"),t.length||o(d.NEWLINE)),t.length&&(o(d.NEWLINE,`${r("renderSharedDataEffect")}(() => `),i(")")),!l&&p.length&&o(d.NEWLINE,"let ",p.join(", ")),n&&i(...e.withId(n,u)),a}function sr({operations:t},e){const[n,r]=d.buildCodeFragment(),s=Dt(t,e);return s.filter(a=>a===d.NEWLINE).length>1?r(...s):r(...s.filter(a=>a!==d.NEWLINE)),n}function Je(t,e){const[n,r]=d.buildCodeFragment(),{operation:s}=t;return s&&r(...xt(s,e)),n}function Ct(t,e){const[n,r]=d.buildCodeFragment(),{children:s}=t;let a=0;const i=[];for(const[o,l]of s.entries()){l.flags&2&&a--;const c=l.flags&1?l.flags&4?l.anchor:l.id:void 0;if(c===void 0&&!l.hasDynamicChild){r(...Je(l,e));continue}c===l.anchor&&r(...Je(l,e)),i.push(l)}if(i.length)for(const o of i)r(...Ct(o,e));return n}function ye(t,e,n=[],r){return["(",...n,") => {",d.INDENT_START,...Ne(t,e,r),d.INDENT_END,d.NEWLINE,"}"]}function Ne(t,e,n,r){const[s,a]=d.buildCodeFragment(),{dynamic:i,effect:o,operation:l}=t,c=e.enterBlock(t);if(n){for(let f of e.ir.component){const p=y.toValidAssetId(f,"component"),h=f.endsWith("__self");h&&(f=f.slice(0,-6)),a(d.NEWLINE,`const ${p} = `,...d.genCall(e.helper("resolveComponent"),JSON.stringify(f),h?"true":void 0))}u("directive","resolveDirective")}for(const f of i.children)a(...Je(f,e));for(const f of i.children)a(...Ct(f,e));return a(...Dt(l,e)),a(...rr(o.filter(f=>!f.generated),e,r)),c(),s;function u(f,p){for(const h of e.ir[f])a(d.NEWLINE,`const ${y.toValidAssetId(h,f)} = `,...d.genCall(e.helper(p),JSON.stringify(h)))}}const ar={ELEMENT:"element",NATIVE_VIEW:"nativeView"},ir={APP_ANDROID:"app-android",APP_HARMONY:"app-harmony",APP_IOS:"app-ios"};class bt{constructor(){this.vForCount=-1}enterVFor(){return this.vForCount++,this.vForCount}get sharedDataVar(){const{node:e}=this.block;let n=!1;return"__vFor"in e&&(n=e.__vFor),e.__vFor=n=e.type===1&&e.tagType===3&&e.props.some(r=>r.type===7&&r.name==="for"),n?this.sharedDataVForVar:"__sharedData"}get sharedDataVForVar(){return`__sharedData_VFor${this.vForCount}`}}class or extends bt{constructor(e,n){super(),this.ir=e,this.helpers=new Set([]),this.helper=s=>(this.helpers.add(s),`_${s}`),this.delegates=new Set,this.identifiers=Object.create(null),this.seenInlineHandlerNames=Object.create(null),this.scopeLevel=0;const r={mode:"module",platform:"app-harmony",prefixIdentifiers:!0,sourceMap:!1,filename:"template.vue.html",scopeId:null,runtimeGlobalName:"Vue",runtimeModuleName:"vue",ssrRuntimeModuleName:"vue/server-renderer",ssr:!1,isTS:!1,inSSR:!1,inline:!1,bindingMetadata:{},expressionPlugins:[],type:"page",className:""};this.options=N.extend(r,n),this.block=e.block}withId(e,n){const{identifiers:r}=this,s=Object.keys(n);for(const i of s)r[i]||(r[i]=[]),r[i].unshift(n[i]||i);const a=e();return s.forEach(i=>N.remove(r[i],n[i]||i)),a}enterBlock(e){const n=this.block;return this.block=e,()=>this.block=n}enterScope(){return[this.scopeLevel++,()=>this.scopeLevel--]}get sharedDataScopeVar(){return"__sharedDataScope"}get sharedDataVForClass(){return`\${__SHARED_DATA_CLASS_NAME_TYPE}_VFor${this.vForCount}`}}function lr(t,e){const[n,r]=d.buildCodeFragment(),s=new or(t,e),{helpers:a}=s,{inline:i}=e;r(d.NEWLINE,"return (function renderSharedData(): UniSharedData {"),r(d.INDENT_START),e.type==="page"?(r(d.NEWLINE,`const __sharedData = ${s.helper("useSharedDataPage")}<__SHARED_DATA_CLASS_NAME_TYPE>(__pageId!)`),r(d.NEWLINE,"__sharedDataScope = __sharedData")):r(d.NEWLINE,`const __sharedData = ${s.helper("useSharedDataComponent")}<__SHARED_DATA_CLASS_NAME_TYPE>(__sharedDataScope)`),t.hasTemplateRef&&r(d.NEWLINE,`const ${St} = ${s.helper("createSharedDataTemplateRefSetter")}()`),r(...Ne(t.block,s,!0)),r(d.NEWLINE,"return __sharedData"),r(d.INDENT_END,d.NEWLINE),r("})()");const o=cr(s)+ur(s),l=[...o].filter(f=>f===`
`).length;l&&!i&&n.unshift(...new Array(l).fill(d.LF));const[c,u]=d.codeFragmentToString(n,s);return{code:c,ast:t,preamble:o,map:u&&u.toJSON(),helpers:a}}function cr({helpers:t,options:e}){let n="";return t.size&&(n+=`import { ${[...t].map(r=>`${r} as _${r}`).join(", ")} } from '${e.runtimeModuleName}';
`),n}function ur(t){return`
const __className = '${t.options.className}' as const
type __SHARED_DATA_CLASS_NAME_TYPE = \`\${typeof __className}SharedData\`
`}const E=Symbol("newline"),Ot=Symbol("line feed"),q=Symbol("indent start"),X=Symbol("indent end");function j(...t){const e=t.push.bind(t),n=t.unshift.bind(t);return[t,e,n]}function Y([t,e,n,r],...s){if(r){for(;s.length>0&&!s[s.length-1];)s.pop();s=s.map(o=>o||r)}else s=s.filter(Boolean);const a=[];i(t);for(let[o,l]of s.entries())i(l),o<s.length-1&&i(n);return i(e),a;function i(o){N.isArray(o)||(o=[o]),a.push(...o)}}const Se=["[","]",", "],fr=[["[",q,E],[X,E,"]"],[", ",E]],ve=[["{",q,E],[X,E,"}"],[", ",E]];function C(t,...e){const n=N.isArray(t),r=n?t[0]:t,s=n?t[1]:"null";return[r,...Y(["(",")",", ",s],...e)]}function pr(t,e){const{options:{filename:n,sourceMap:r}}=e;let s;r&&(s=new Kt.SourceMapGenerator,s.setSourceContent(n,e.ir.source),s._sources.add(n));let a="";const i={line:1,column:1,offset:0};let o=0;for(let c of t){if(!c)continue;if(c===E)c=[`
${"  ".repeat(o)}`,0];else if(c===q){o++;continue}else if(c===X){o--;continue}else if(c===Ot){i.line++,i.column=0,i.offset++;continue}N.isString(c)&&(c=[c]);let[u,f=-2,p,h]=c;a+=u,s&&(p&&l(p.start,h),f===-3?y.advancePositionWithMutation(i,u):(i.offset+=u.length,f===-2?i.column+=u.length:(f===-1&&(f=u.length-1),i.line++,i.column=u.length-f)),p&&p!==y.locStub&&l(p.end))}return[a,s];function l(c,u=null){const{_names:f,_mappings:p}=s;u!==null&&!f.has(u)&&f.add(u),p.add({originalLine:c.line,originalColumn:c.column-1,generatedLine:i.line,generatedColumn:i.column-1,source:n,name:u})}}function dr({parent:t,elements:e,anchor:n},{helper:r}){let s=e.map(a=>`n${a}`).join(", ");return e.length>1&&(s=`[${s}]`),[E,...C(r("insert"),s,`n${t}`,n===void 0?void 0:`n${n}`)]}function hr(t,{helper:e}){return[E,...C(e("prepend"),`n${t.parent}`,...t.elements.map(n=>`n${n}`))]}function x(t,e,n){const{content:r,ast:s,isStatic:a,loc:i,sharedData:o}=t;if(o)return[[e.sharedDataIdent(o.ident),-2,i]];if(a)return[[JSON.stringify(r),-2,i]];if(!t.content.trim()||s===!1||d.isConstantExpression(t))return[[r,-2,i],n&&` = ${n}`];if(s===null)return wt(r,e,i,n);const l=[],c=new Map,u=[];y.walkIdentifiers(s,p=>{l.push(p),c.set(p,u.slice())},!1,u);let f=!1;if(l.length){const[p,h]=j(),g=s&&y.TS_NODE_TYPES.includes(s.type);return l.sort((m,S)=>m.start-S.start).forEach((m,S)=>{const b=m.start-1,_=m.end-1,w=l[S-1];if(!(g&&S===0)){const Z=r.slice(w?w.end-1:0,b);Z.length&&h([Z,-3])}const F=r.slice(b,_),B=c.get(m),T=B[B.length-1];f||(f=T&&(T.type==="MemberExpression"||T.type==="OptionalMemberExpression")),h(...wt(F,e,{start:y.advancePositionWithClone(t.loc.start,F,b),end:y.advancePositionWithClone(t.loc.start,F,_),source:F},f?void 0:n,m,T,B)),S===l.length-1&&_<r.length&&!g&&h([r.slice(_),-3])}),n&&f&&h(` = ${n}`),p}else return[[r,-3,i]]}function wt(t,e,n,r,s,a,i){const{options:o,helper:l,identifiers:c}=e,{inline:u,bindingMetadata:f}=o;let p=t;const h=c[t];if(h&&h.length){const _=h[0];return N.isString(_)?a&&a.type==="ObjectProperty"&&a.shorthand?[[`${p}: ${_}`,-2,n]]:[[_,-2,n]]:x(_,e,r)}let g;y.isStaticProperty(a)&&a.shorthand&&(g=`${t}: `);const m=f&&f[t];if(u)switch(m){case"setup-let":p=t=r?`_isRef(${t}) ? (${t}.value = ${r}) : (${t} = ${r})`:b();break;case"setup-ref":p=t=S(`${t}.value`);break;case"setup-maybe-ref":const _=a&&y.isInDestructureAssignment(a,i||[]),w=a&&a.type==="AssignmentExpression"&&a.left===s,F=a&&a.type==="UpdateExpression"&&a.argument===s;t=w||F||_?p=`${t}.value`:r?`${l("isRef")}(${t}) ? (${t}.value = ${r}) : null`:b();break;case"props":t=N.genPropsAccessExp(t);break;case"props-aliased":t=N.genPropsAccessExp(f.__propsAliases[t]);break;default:t=S(t)}else gr(t)&&(m==="props-aliased"?t=`$props['${f.__propsAliases[t]}']`:t=`${m==="props"?"$props":"_ctx"}.${t}`),t=S(t);return[g,[t,-2,n,p]];function S(_){return r?`${_} = ${r}`:_}function b(){return`${l("unref")}(${t})`}}function gr(t){return!(N.isGloballyAllowed(t)||t==="require"||t==="$props"||t==="$emit"||t==="$attrs"||t==="$slots")}function mr(t,e,n){const{seenVariable:r,variableToExpMap:s,expToVariableMap:a,seenIdentifier:i,updatedVariable:o}=Er(e),l=$r(t,r,s,a,i,o),c=Nr(t,e,l,o,a);return Sr([...l,...c],t,n)}function Er(t){const e=Object.create(null),n=new Map,r=new Map,s=new Set,a=new Set,i=(o,l,c,u,f=[])=>{c&&s.add(o),e[o]=(e[o]||0)+1,n.set(o,(n.get(o)||new Set).add(l));const p=r.get(l)||[];p.push({name:o,loc:u}),r.set(l,p),f.some(h=>h.type==="UpdateExpression"||h.type==="AssignmentExpression")&&a.add(o)};for(const o of t){if(!o.ast){o.ast===null&&i(o.content,o,!0);continue}y.walkIdentifiers(o.ast,(l,c,u)=>{if(c&&Mt(c)){const f=se(c,p=>{i(p.name,o,!0,{start:p.start,end:p.end})});i(f,o,!1,{start:c.start,end:c.end},u)}else u.some(Mt)||i(l.name,o,!0,{start:l.start,end:l.end},u)})}return{seenVariable:e,seenIdentifier:s,variableToExpMap:n,expToVariableMap:r,updatedVariable:a}}function $r(t,e,n,r,s,a){const i=[],o=new Map;for(const[l,c]of n)if(!a.has(l)&&e[l]>1&&c.size>0){const u=s.has(l),f=u?l:je(l);c.forEach(p=>{if(p.ast&&f!==l){const h=o.get(p)||[];h.push({name:f,locs:r.get(p).reduce((g,m)=>(m.name===l&&m.loc&&g.push(m.loc),g),[])}),o.set(p,h)}}),!i.some(p=>p.name===f)&&(!u||yr(l,r,c))&&i.push({name:f,isIdentifier:u,value:N.extend({ast:u?null:Ie(t,l)},y.createSimpleExpression(l)),rawName:l,exps:c,seenCount:e[l]})}for(const[l,c]of o)c.flatMap(({name:u,locs:f})=>f.map(({start:p,end:h})=>({start:p,end:h,name:u}))).sort((u,f)=>f.end-u.end).forEach(({start:u,end:f,name:p})=>{l.content=l.content.slice(0,u-1)+p+l.content.slice(f-1)}),l.ast=Ie(t,l.content);return i}function yr(t,e,n){const r=Array.from(n,a=>e.get(a).map(i=>i.name));if(r.every(a=>a.length===1)||r.some(a=>a.filter(i=>i===t).length>1))return!0;const s=r[0];return r.some(a=>a.length!==s.length)?!(r.some(a=>a.length>s.length&&a.every(i=>s.includes(i)))||r.some(a=>s.length>a.length&&s.every(i=>a.includes(i)))):!r.some(a=>a.some(i=>s.includes(i)))}function Nr(t,e,n,r,s){const a=[],i=e.reduce((o,l)=>{const c=s.get(l).map(u=>u.name);return l.ast&&l.ast.type!=="Identifier"&&!(c&&c.some(u=>r.has(u)))&&(o[l.content]=(o[l.content]||0)+1),o},Object.create(null));return Object.entries(i).forEach(([o,l])=>{if(l>1){const c=je(o);if(!a.some(u=>u.name===c)){const u={};for(let p=n.length-1;p>=0;p--){const h=n[p];!h.exps||!h.seenCount||[...h.exps].every(g=>g.content===o&&h.seenCount===l)&&(u[h.name]=h.rawName,n.splice(p,1))}const f=N.extend({},e.find(p=>p.content===o));Object.keys(u).forEach(p=>{f.content=f.content.replace(p,u[p]),f.ast&&(f.ast=Ie(t,f.content))}),a.push({name:c,value:f})}e.forEach(u=>{u.content===o?(u.content=c,u.ast=null):u.content.includes(o)&&(u.content=u.content.replace(new RegExp(vr(o),"g"),c),u.ast=Ie(t,u.content))})}}),a}function Sr(t,e,n){const[r,s]=j(),a=Object.create(null),i=new Set;return t.forEach(({name:o,isIdentifier:l,value:c})=>{if(l){const u=a[o]=`_${o}`;i.add(u),n&&s("const "),s(`${u} = `,...x(c,e),E)}}),t.forEach(({name:o,isIdentifier:l,value:c})=>{if(!l){const u=a[o]=`_${o}`;i.add(u),n&&s("const "),s(`${u} = `,...e.withId(()=>x(c,e),a),E)}}),{ids:a,frag:r,varNames:[...i]}}function vr(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ie(t,e){const n=t.options.expressionPlugins,r={plugins:n?[...n,"typescript"]:["typescript"]};return fe.parseExpression(`(${e})`,r)}function je(t){return`${t.replace(/[^a-zA-Z0-9]/g,"_").replace(/_+/g,"_").replace(/_+$/,"")}`}function se(t,e){if(!t)return"";switch(t.type){case"Identifier":return e(t),t.name;case"StringLiteral":return t.extra?t.extra.raw:t.value;case"NumericLiteral":return t.value.toString();case"BinaryExpression":return`${se(t.left,e)} ${t.operator} ${se(t.right,e)}`;case"CallExpression":return`${se(t.callee,e)}(${t.arguments.map(s=>se(s,e)).join(", ")})`;case"MemberExpression":case"OptionalMemberExpression":const n=se(t.object,e),r=t.computed?`[${se(t.property,e)}]`:`.${se(t.property,N.NOOP)}`;return`${n}${r}`;default:return""}}const Mt=t=>t.type==="MemberExpression"||t.type==="OptionalMemberExpression";function Ir(t,e){if(!(e.feature&2))return[];const{element:n,key:r,keyOverride:s,modifiers:a,delegate:i,effect:o,sharedData:l}=t,c=p(),u=h(),f=`e${l.ident}${t.element}`;return[E,`const ${f} = ${e.sharedDataIdent(l.ident)}`,E,...C(e.helper(i?"delegate":"onElement"),`n${n}`,c,["(event: UniEvent) => {",`${f}(event)`,"}"],u)];function p(){const g=x(r,e);if(s){const m=JSON.stringify(s[0]),S=JSON.stringify(s[1]),b=["(",...g,")"];return[...b,` === ${m} ? ${S} : `,...b]}else return x(r,e)}function h(){let{options:g}=a;if(!(!g.length&&!o))return Y(ve,o&&["effect: true"],...g.map(m=>[`${m}: true`]))}}function _r(t,e){if(!(e.feature&2))return[];const{helper:n,sharedDataIdent:r}=e;return[E,...C(n("setElementDynamicEvents"),`n${t.element}`,r(t.event.sharedData.ident))]}function Tr(t,e,n={nonKeys:[],keys:[]},r=!1){let s=["() => {}"];if(e&&e.content.trim())if(y.isMemberExpression(e,t.options))s=x(e,t),!Cr(e,t)&&!r&&(s=["e => ",...s,"(e)"]);else if(y.isFnExpression(e,t.options))s=x(e,t);else{const o=e.content.includes("$event"),l=e.content.includes(";"),c=o?t.withId(()=>x(e,t),{$event:null}):x(e,t);s=[o?"$event => ":"() => ",l?"{":"(",...c,l?"}":")"]}const{keys:a,nonKeys:i}=n;return i.length&&(s=Dr(t,s,i)),a.length&&(s=xr(t,s,a)),r&&s.unshift("() => "),s}function Dr(t,e,n){return C(t.helper("withModifiers"),e,JSON.stringify(n))}function xr(t,e,n){return C(t.helper("withKeys"),e,JSON.stringify(n))}function Cr(t,e){if(t.ast===null&&e.options.bindingMetadata[t.content]==="setup-const")return!0}function br(t,e){const{helper:n,factoryVar:r}=e,{source:s,value:a,key:i,index:o,render:l,keyProp:c,once:u,id:f,component:p,onlyChild:h}=t;let g=null;const m=i&&i.content,S=o&&o.content,b=["() => (",...x(s,e),")"],_=he(),w=e.enterVFor(),[F,B]=e.enterScope(),T={},Z=`_for_item${w}`;T[Z]=null,_.forEach((v,k)=>{let M=`${Z}.value${v?v.path:""}`;if(v)if(v.helper&&(T[v.helper]=null,M=`${v.helper}(${M}, ${v.helperArgs})`),v.dynamic){const G=T[k]=y.createSimpleExpression(M),$=e.options.expressionPlugins;G.ast=fe.parseExpression(`(${M})`,{plugins:$?[...$,"typescript"]:["typescript"]})}else T[k]=M;else T[k]=M});const le=[e.sharedDataVForVar];if(m){const v=`_for_key${w}`;T[m]=`${v}.value`,T[v]=null}if(S){const v=`_for_index${w}`;T[S]=`${v}.value`,T[v]=null}const{selectorPatterns:ce,keyOnlyBindingPatterns:de}=pt(l,c,T),ee=e.withId(()=>{const v=[];return v.push("(",...le,") => {",q),ce.length||de.length?v.push(...Ce(l,e,!1,()=>{const k=[];for(let M=0;M<ce.length;M++){const{effect:G}=ce[M],$=[];for(const O of G.operations)$.push(...He(O,e));$.length&&(k.push(E,n(`render${e.helperType}Effect`),"(() => {",q),k.push(...$),k.push(X,E,"})"))}for(const{effect:M}of de)for(const G of M.operations)k.push(...He(G,e));return k})):v.push(...Ce(l,e)),v.push(X,E,"}"),v},T);B();let te=0;return h&&(te|=1),p&&(te|=2),u&&(te|=4),[E,`const n${f} = `,...C([n(`create${e.helperType}For`),"undefined"],r,b,ee,ae(c,e.sharedDataVForVar),te?String(te):void 0,void 0)];function he(){const v=new Map;return a&&(g=a&&a.content,a.ast?y.walkIdentifiers(a.ast,(k,M,G,$,O)=>{if(O){let D="",R=!1,Q,ue;for(let U=0;U<G.length;U++){const A=G[U],H=G[U+1]||k;if(A.type==="ObjectProperty"&&A.value===H)A.key.type==="StringLiteral"?D+=`[${JSON.stringify(A.key.value)}]`:A.computed?(R=!0,D+=`[${a.content.slice(A.key.start-1,A.key.end-1)}]`):D+=`.${A.key.name}`;else if(A.type==="ArrayPattern"){const L=A.elements.indexOf(H);H.type==="RestElement"?D+=`.slice(${L})`:D+=`[${L}]`}else A.type==="ObjectPattern"&&H.type==="RestElement"&&(Q=e.helper("getRestElement"),ue="["+A.properties.filter(L=>L.type==="ObjectProperty").map(L=>L.key.type==="StringLiteral"?JSON.stringify(L.key.value):L.computed?(R=!0,a.content.slice(L.key.start-1,L.key.end-1)):JSON.stringify(L.key.name)).join(", ")+"]");H.type==="AssignmentPattern"&&(A.type==="ObjectProperty"||A.type==="ArrayPattern")&&(R=!0,Q=e.helper("getDefaultValue"),ue=a.content.slice(H.right.start-1,H.right.end-1))}v.set(k.name,{path:D,dynamic:R,helper:Q,helperArgs:ue})}},!0):v.set(g,null)),v}function ae(v,k){if(!v)return!1;const M=e.withId(()=>x(v,e),be());return[...Y(["(",")",", "],k)," => (",...M,")"]}function be(){const v={};return m&&(v[m]=null),S&&(v[S]=null),_.forEach((k,M)=>v[M]=null),v}}function Or(t,e){const{helper:n}=e,{value:r,element:s}=t;return[E,...C(n("setHtml"),`n${s}`,x(r,e))]}function At(t,e,n=!1){const{helper:r}=e,{condition:s,positive:a,negative:i,once:o}=t,[l,c]=j(),u=["() => (",...wr(s,e),")"];let f=xe(a,e),p=!1;return i&&(i.type===1?p=xe(i,e):p=["() => ",...At(i,e,!0)]),n||c(E,`const n${t.id} = `),c(...C(r(`create${e.helperType}If`),u,f,p,o&&"true")),l}function wr(t,e){return t.sharedData?x(t,e):[JSON.stringify(Ee(t))]}const _e={setElementClass:{name:"setElementClass"},setElementStyle:{name:"setElementStyle"},setElementAttr:{name:"setElementAttr",needKey:!0}},kt={setNativeViewAttr:{name:"setNativeViewAttr",needKey:!0}};function Mr(t,e){const{helper:n}=e,{prop:{key:r,values:s,modifier:a},tag:i}=t,o=r.content;if(o==="class"&&!(e.feature&16))return[];if(o==="id"&&!(e.feature&32))return[];const l=e.options.renderer==="nativeView"?Rr(i,o,a):Vr(i,o,a),c=kr(s,e);return[E,...C([n(l.name),null],`n${t.element}`,l.needKey?x(r,e):!1,c)]}function Ar(t,e){const{helper:n,sharedDataIdent:r}=e;return[E,...C(n(`set${e.helperType}DynamicProps`),`n${t.element}`,r(t.sharedData.ident))]}function kr(t,e){return t.length===1?x(t[0],e):Y(Se,...t.map(n=>x(n,e)))}function Vr(t,e,n){return t.toUpperCase(),n?n==="."&&Vt(e)||_e.setElementAttr:Vt(e)||_e.setElementAttr}function Vt(t,e){if(t==="class")return _e.setElementClass;if(t==="style")return _e.setElementStyle}function Rr(t,e,n){return t.toUpperCase(),n&&n==="."&&void 0||kt.setNativeViewAttr}function Lr(t,e){return t.value.sharedData?[E,e.sharedDataIdent(t.value.sharedData.ident)+`(n${t.element}.getNodeId())`]:[]}function Pr(t){return[]}function Fr(t,e){if(!(e.feature&1))return[];const{helper:n}=e,{element:r,values:s,generated:a}=t,i=Wr(s,e);return[E,...C(n("setElementText"),`${a?"x":"n"}${r}`,i)]}function Wr(t,e){return t.flatMap((n,r)=>{let s=x(n,e);return r>0&&s.unshift(" + "),s})}function Jr(t,e){return e.feature&1?[E,`const x${t.parent} = ${e.helper(`child${e.helperType}`)}(n${t.parent})`]:[]}function jr(t,e){return e.feature&8?[E,...C(e.helper("applyElementVShow"),`n${t.element}`,["() => (",...x(t.dir.exp,e),")"])]:[]}const Br={text:"applyElementTextModel",dynamic:"applyElementDynamicModel"};function Yr(t,e){if(!(e.feature&4))return[];const{modelType:n,element:r,dir:{exp:s,modifiers:a}}=t;return[E,...C(e.helper(Br[n]),`n${r}`,["() => (",...x(s,e),")"],e.sharedDataIdent(s.sharedData.vModel.eventIdent),a.length?`{ ${a.map(i=>i.content+": true").join(",")} }`:void 0)]}function Gr(t,e){switch(t.name){case"show":return jr(t,e);case"model":return Yr(t,e);default:return[]}}function Be(t,e){const n=Kr(t,e.block.operation);return n.length?Ur(n,e):[]}function Ur(t,e){const{helper:n}=e,r=`n${t[0].element}`,s=t.map(i),a=Y(Se,...s);return[E,...C(n("withVaporDirectives"),r,a)];function i({dir:o,name:l,asset:c}){const u=c?y.toValidAssetId(l,"directive"):x(N.extend(y.createSimpleExpression(l,!1),{ast:null}),e),f=o.exp&&["() => ",...x(o.exp,e)],p=o.arg&&x(o.arg,e),h=!!o.modifiers.length&&["{ ",Hr(o.modifiers.map(g=>g.content))," }"];return Y(Se.concat("void 0"),u,f,p,h)}}function Hr(t){return t.map(e=>`${y.isSimpleIdentifier(e)?e:JSON.stringify(e)}: true`).join(", ")}function Kr(t,e){return e.filter(n=>n.type===13&&n.element===t&&!n.builtin)}function zr(t,e){const{helper:n,sharedDataIdent:r}=e,{root:s,props:a,slots:i,sharedData:o}=t,l=Zr(i,e),[c,u]=Xr(a,e),f=u.reduce((p,{name:h,value:g})=>{const m=Tr(e,g,void 0,!1);return[...p,`const ${h} = `,...m,E]},[]);return[E,...f,`const n${t.id} = `,...C(t.dynamic&&!t.dynamic.isStatic?n(`create${e.helperType}DynamicComponent`):t.asset?n(`create${e.helperType}ComponentWithFallback`):n(`create${e.helperType}Component`),r(o.ident),void 0,l,s?"true":!1),...Be(t.id,e)]}function qr(t,e){const{seenInlineHandlerNames:n}=t;e=je(e);const r=n[e]||0;return n[e]=r+1,r===0?e:`${e}${r}`}function Xr(t,e){const n=Object.create(null),r=[],s=t[0];if(N.isArray(s))for(let a=0;a<s.length;a++){const i=s[a];i.handler&&i.values.forEach((o,l)=>{if(!y.isMemberExpression(o,e.options)){const c=qr(e,`_on_${i.key.content}`);r.push({name:c,value:o}),n[c]=null,i.values[l]=N.extend({ast:null},y.createSimpleExpression(c))}})}return[n,r]}function Zr(t,e){if(!t.length)return;const n=t[0];return n.slotType===0?Ye(n,e,t.length>1?t.slice(1):void 0):Ye({slots:{}},e,t)}function Ye({slots:t},e,n){const r=Object.keys(t).map(s=>[`${JSON.stringify(s)}: `,...Ue(t[s],e)]);return n&&r.push(["$: ",...Qr(n,e)]),Y(ve,...r)}function Qr(t,e){return Y(fr,...t.map(n=>n.slotType===0?Ye(n,e):n.slotType===4?n.slots.content:Ge(n,e,!0)))}function Ge(t,e,n=!1){let r;switch(t.slotType){case 1:r=es(t,e);break;case 2:r=ts(t,e);break;case 3:r=ns(t,e);break}return n?["() => (",...r,")"]:r}function es(t,e){const{name:n,fn:r}=t;return Y(ve,["name: ",...x(n,e)],["fn: ",...Ue(r,e)])}function ts(t,e){e.enterVFor();const{name:n,fn:r,loop:s}=t,{value:a,key:i,index:o,source:l}=s,c=a&&a.content,u=i&&i.content,f=o&&o.content,p={};c&&(p[c]=c),u&&(p[u]=u),f&&(p[f]=f);const h=Y(ve,["name: ",...e.withId(()=>{const g=e.enterBlock(r),m=x(n,e);return g(),m},p)],["fn: ",...e.withId(()=>Ue(r,e),p)]);return[...C(e.helper(`create${e.helperType}ForSlots`),x(l,e),[...Y(["(",")",", "],e.sharedDataVForVar,c||(u||f?"_":void 0),u||(f?"__":void 0),f)," => (",...h,")"])]}function ns(t,e){const{condition:n,positive:r,negative:s}=t;return[...x(n,e),q,E,"? ",...Ge(r,e),E,": ",...s?[...Ge(s,e)]:["void 0"],X]}function Ue(t,e){let n=!1,r,s,a,i;const{props:o}=t,l=new Set;o&&(r=o.content,(n=!!o.ast)?([i,a]=e.enterScope(),s=`_slotProps${i}`,y.walkIdentifiers(o.ast,(f,p,h,g,m)=>{m&&l.add(f.name)},!0)):l.add(s=r));const c={};l.forEach(f=>c[f]=n?`${s}[${JSON.stringify(f)}]`:null);const u=e.withId(()=>xe(t,e,[s]),c);return a&&a(),u}function rs(t,e){const{helper:n}=e,{id:r,name:s,fallback:a}=t,[i,o]=j(),l=s.isStatic?x(s,e):["() => (",...x(s,e),")"];let c;return a&&(c=xe(a,e)),o(E,`const n${r} = `,...C(n(`create${e.helperType}Slot`),l,"null",c)),i}function Rt(t,e){const[n,r]=j();for(const s of t)r(...Lt(s,e));return n}function Lt(t,e){const[n,r]=j();return d.isBlockOperation(t)&&t.parent&&r(...is(t,e)),r(...He(t,e)),n}function He(t,e){switch(t.type){case 2:return Mr(t,e);case 3:return Ar(t,e);case 4:return Fr(t,e);case 5:return Ir(t,e);case 6:return _r(t,e);case 7:return Or(t,e);case 8:return Lr(t,e);case 9:return dr(t,e);case 10:return hr(t,e);case 15:return At(t,e);case 16:return br(t,e);case 11:return zr(t,e);case 14:return Pr();case 12:return rs(t,e);case 13:return Gr(t,e);case 17:return Jr(t,e);default:const n=t;throw new Error(`Unhandled operation type in genOperation: ${n}`)}}function ss(t,e,n){const{helper:r}=e,s=t.flatMap(g=>g.expressions),[a,i,o]=j(),l=n===void 0;let c=0;const{ids:u,frag:f,varNames:p}=mr(e,s,l);for(let g=0;g<t.length;g++){const m=t[g];c+=m.operations.length;const S=e.withEffect(()=>e.withId(()=>as(m,e),u));g>0&&S.length&&i(E),a[a.length-1]===")"&&S[0]==="("&&i(";"),i(...S)}const h=a.filter(g=>g===E).length;return a.length&&(h>1||c>1||f.length>0)&&(o("{",q,E),i(X,E,"}"),t.length||o(E)),t.length&&a.length&&(o(E,`${r(`render${e.helperType}Effect`)}(() => `),i(")")),!l&&p.length&&o(E,"let ",p.join(", ")),n&&i(...e.withId(n,u)),a}function as({operations:t},e){const[n,r]=j(),s=Rt(t,e);return s.filter(a=>a===E).length>1?r(...s):r(...s.filter(a=>a!==E)),n}function is(t,e){return[E,...C(e.helper(`set${e.helperType}InsertionState`),`n${t.parent}`,t.anchor==null?void 0:t.anchor===-1?"0":`n${t.anchor}`)]}const P={TEXT:"text",BUTTON:"button",COMMENT:"comment",ELEMENT:"element"},V={VALUE_ATTR:"value",EMPTY_STRING:"",UNKNOWN_COMMENT:"unknown",EXT_STYLE_MARKER:"ext:style"},oe={ELEMENT:"e",STYLE:"s",TEMPLATE:"t",FACTORY:"f"},os=/[\\]+n/g,Pt="<!--",Ft="-->",Wt="<!",Ke=/\s/,ls=/[\s=]/,ze=/\s*\/$/;class et{constructor(e){this.html=e,this.length=e.length,this.index=0}parse(){const e=[];for(this.index=0;this.index<this.length;)if(this.html[this.index]==="<"){const n=this.parseTag();n?(e.push(n.node),this.index=n.endIndex):this.index++}else{const n=this.parseText();n&&e.push(n)}return e}parseText(){const e=this.index,n=this.html.indexOf("<",e),r=n===-1?this.length:n;if(e===r)return null;const s=this.html.substring(e,r);return this.index=r,{type:"text",content:s}}parseTag(){return this.html.startsWith(Pt,this.index)?this.parseComment():this.html.startsWith(Wt,this.index)?this.parseDoctype():this.parseElement()}parseComment(){const e=this.index+Pt.length,n=this.html.indexOf(Ft,e);return n===-1?null:{node:{type:"comment",content:this.html.substring(e,n)},endIndex:n+Ft.length}}parseDoctype(){const e=this.html.indexOf(">",this.index+Wt.length);return e===-1?null:{node:{type:"comment",content:""},endIndex:e+1}}parseElement(){const e=this.html.indexOf(">",this.index);if(e===-1)return null;const n=this.html.substring(this.index+1,e),{tag:r,attrs:s,selfClosing:a}=this.parseTagContent(n);if(a)return{node:{type:"element",tag:r,attrs:s,children:[]},endIndex:e+1};const i=this.findMatchingEndTag(r,e+1);if(i===-1)return{node:{type:"element",tag:r,attrs:s,children:[]},endIndex:e+1};const o=this.html.substring(e+1,i),l=o?new et(o).parse():[];return{node:{type:"element",tag:r,attrs:s,children:l},endIndex:i+`</${r}>`.length}}parseTagContent(e){const n=ze.test(e),r=e.replace(ze,"").trim();if(!r)return{tag:"",attrs:{},selfClosing:n};const s=r.search(Ke),a=s===-1?r:r.substring(0,s);if(s===-1)return{tag:a,attrs:{},selfClosing:n};const i=r.substring(s+1),o=this.parseAttributes(i);return{tag:a,attrs:o,selfClosing:n}}parseAttributes(e){const n={};let r=0;const s=e.length;for(;r<s&&(r=this.skipWhitespace(e,r),!(r>=s));){const a=r;for(;r<s&&!ls.test(e[r]);)r++;if(r===a)break;const i=e.substring(a,r);if(r=this.skipWhitespace(e,r),r>=s||e[r]!=="="){this.isSpecialAttribute(i)||(n[i]=i);continue}if(r++,r=this.skipWhitespace(e,r),r>=s){this.isSpecialAttribute(i)||(n[i]="");continue}const o=this.parseAttributeValue(e,r);(!this.isSpecialAttribute(i)||o.value.trim()!=="")&&(n[i]=o.value),r=o.endIndex}return n}parseAttributeValue(e,n){const r=e[n];if(r==='"'||r==="'"){const s=n+1;let a=s;for(;a<e.length&&e[a]!==r;)a++;return{value:e.substring(s,a),endIndex:a<e.length?a+1:a}}else{const s=n;let a=s;for(;a<e.length&&!Ke.test(e[a]);)a++;return{value:e.substring(s,a),endIndex:a}}}isSpecialAttribute(e){return e==="id"||e==="class"||e==="style"}skipWhitespace(e,n){for(;n<e.length&&Ke.test(e[n]);)n++;return n}findMatchingEndTag(e,n){const r=`<${e}`,s=`</${e}>`;let a=1,i=n;for(;a>0&&i<this.length;){const o=this.html.indexOf(r,i),l=this.html.indexOf(s,i);if(l===-1)break;if(o!==-1&&o<l){const c=this.html.indexOf(">",o);if(c!==-1&&c<l){const u=this.html.substring(o+1,c);ze.test(u)||a++}i=c+1}else{if(a--,a===0)return l;i=l+s.length}}return-1}}function qe(t){return!t||t.length!==1||t[0].type!==P.TEXT||t[0].content===" "?V.EMPTY_STRING:t[0].content||V.EMPTY_STRING}function cs(t){return t.replace(os,function(e){return JSON.parse(`"${e}"`)})}function Xe(t){return!t||Object.keys(t).length===0||Object.keys(t).length===1&&V.EXT_STYLE_MARKER in t}function Jt(t,e){const n=N.extend({},t);return e&&(n[V.VALUE_ATTR]=e),n}function jt(t){const e="page: UniPage",n=t.options.renderer==="element"?": UniElement":": UniNativeView";return{paramType:e,returnType:n}}function Ze(t){return`${oe.ELEMENT}${t.templateVariableCounter++}`}function us(t){return`${oe.STYLE}${t.templateStyleCounter++}`}function fs(t,e,n=!0){return n&&e.resetTemplateCounters(),Bt(t,e)}function Bt(t,e){switch(t.type){case P.TEXT:return ps(t.content||V.EMPTY_STRING,e);case P.COMMENT:return Yt(t.content||V.EMPTY_STRING,e);case P.ELEMENT:return hs(t,e);default:return Yt(V.UNKNOWN_COMMENT,e)}}function ps(t,e){const n=Ze(e),r=[`const ${n} = ${e.genCreateTag("text",JSON.stringify(cs(t)))}`];return{variableName:n,statements:r}}function Yt(t,e){const n=Ze(e),r=[`const ${n} = ${e.genCreateTag("comment",JSON.stringify(t))}`];return{variableName:n,statements:r}}const ds={[P.TEXT]:gs,[P.BUTTON]:ms};function hs(t,e){const{tag:n,attrs:r,children:s}=t,a={tag:n,attrs:r,children:s},i=ds[n];return i?i(a,e):Es(a,e)}function gs(t,e){const{tag:n,attrs:r,children:s}=t;if(s&&s.some(a=>a.type===P.ELEMENT))return Te(n,e,r,s);{const a=qe(s),i=Jt(r,a);return Te(n,e,i,void 0)}}function ms(t,e){const n=qe(t.children),r=Jt(t.attrs,n);return Te(t.tag,e,r,void 0)}function Es(t,e){const{tag:n,attrs:r,children:s}=t;return Te(n,e,r,s)}function $s(t,e){if(!t)return;const n={};for(const[r,s]of Object.entries(t))e.options.isIgnoreAttr(r)||(n[r]=s);return n}function Te(t,e,n,r){const s=Ze(e),a=[];a.push(`const ${s} = ${e.genCreateTag(t)}`);const i=$s(n,e);if(i&&!Xe(i)){let o=!1;V.EXT_STYLE_MARKER in i&&(o=!0,delete i[V.EXT_STYLE_MARKER]);for(const[l,c]of Object.entries(i))if(l==="style"){const u=e.options.parseStaticStyle(e.options.renderer,c);if(u){if(o){const f=us(e);a.push(`const ${f} = ${JSON.stringify(u)}`),a.push(`${s}.ext.set('style', ${f})`)}Object.keys(u).forEach(f=>{a.push(`${s}.${f}(${u[f]})`)})}else a.push(`${s}.setAttribute(${JSON.stringify(l)}, ${JSON.stringify(c)})`)}else a.push(`${s}.setAttribute(${JSON.stringify(l)}, ${JSON.stringify(c)})`)}if(r&&r.length>0)for(const o of r){const l=ys(o,e);if(l)a.push(e.genAppendChild(s,l));else{const c=Bt(o,e);a.push(...c.statements),a.push(e.genAppendChild(s,c.variableName))}}return{variableName:s,statements:a}}function ys(t,e){switch(t.type){case P.TEXT:return e.genCreateTag("text",JSON.stringify(t.content||V.EMPTY_STRING));case P.COMMENT:return e.genCreateTag("comment",JSON.stringify(t.content||V.EMPTY_STRING));case P.ELEMENT:const n=t;return Ns(n)?e.genCreateTag(n.tag):null;default:return e.genCreateTag("comment",JSON.stringify(V.UNKNOWN_COMMENT))}}function Ns(t){return!(t.tag===P.TEXT||!Xe(t.attrs)||t.children&&t.children.length>0)}function Ss(t,e,n){try{if(!t||typeof t!="string")return De(e,n);const r=new et(t).parse();return r.length===0?De(e,n):r.length===1?vs(r[0],e,n):De(e,n)}catch{return De(e,n)}}function De(t,e){const{paramType:n,returnType:r}=jt(e);return[`const ${oe.FACTORY}${t} = (${n})${r} => {`,E,`  return ${e.genCreateTag("text",JSON.stringify(V.EMPTY_STRING))}`,E,"}"]}function vs(t,e,n){const{paramType:r,returnType:s}=jt(n),a=Is(t,n);if(a)return[`const ${oe.FACTORY}${e} = (${r})${s} => {`,E,`  return ${a}`,E,"}"];const i=fs(t,n),o=[`const ${oe.FACTORY}${e} = (${r})${s} => {`,E];for(const l of i.statements)typeof l=="string"?o.push(`  ${l}`,E):o.push(l,E);return o.push(`  return ${i.variableName}`,E,"}"),o}function Is(t,e){switch(t.type){case P.TEXT:return e.genCreateTag("text",JSON.stringify(t.content||V.EMPTY_STRING));case P.COMMENT:return e.genCreateTag("comment",JSON.stringify(t.content||V.EMPTY_STRING));case P.ELEMENT:const n=t;return _s(n)?e.genCreateTag(n.tag):null;default:return e.genCreateTag("comment",JSON.stringify(V.UNKNOWN_COMMENT))}}function _s(t){return Xe(t.attrs)?t.tag===P.TEXT?!qe(t.children):!t.children||t.children.length===0:!1}function Ts(t,e){const n=[];for(let r=0;r<t.length;r++){const s=Ss(t[r],r,e);n.push(E,...s)}return n}function Ds(t,e,n){const{helper:r,options:s}=n,a=[];for(let i=0;i<t.length;i++){const o=i===e?", true":"";a.push(`const ${oe.TEMPLATE}${i} = ${r(`${s.renderer}Factory`)}(${n.factoryVar}, ${oe.FACTORY}${i}${o})`),i<t.length-1&&a.push(E)}return a}function xs(t,e,n){return Ts(t,n)}function Qe(t,e){const[n,r]=j(),{id:s,template:a,operation:i}=t;return s!==void 0&&a!==void 0&&(r(E,`const n${s} = t${a}()`),r(...Be(s,e))),i&&r(...Lt(i,e)),n}function Gt(t,e,n,r=`n${t.id}`){const{helper:s}=e,[a,i]=j(),{children:o}=t;let l=0,c;const u=[];for(const[f,p]of o.entries()){p.flags&2&&l--;const h=p.flags&1?p.flags&4?p.anchor:p.id:void 0;if(h===void 0&&!p.hasDynamicChild){i(...Qe(p,e));continue}const g=Number(f)+l,m=h===void 0?`p${e.block.tempId++}`:`n${h}`;if(n(E,`const ${m} = `),c)g-c[1]===1?n(...C(s(`next${e.helperType}`),c[0])):n(...C(s(`nthChild${e.helperType}`),r,String(g)));else if(g===0)n(...C(s(`child${e.helperType}`),r));else{let S=C(s(`child${e.helperType}`),r);g===1?S=C(s(`next${e.helperType}`),S):g>1&&(S=C(s(`nthChild${e.helperType}`),r,String(g))),n(...S)}h===p.anchor&&i(...Qe(p,e)),h!==void 0&&i(...Be(h,e)),c=[m,g],u.push([p,m])}if(u.length)for(const[f,p]of u)i(...Gt(f,e,n,p));return a}function xe(t,e,n=[],r){return["(",...n,") => {",q,...Ce(t,e),X,E,"}"]}function Ce(t,e,n,r){const[s,a]=j(),{dynamic:i,effect:o,operation:l,returns:c}=t,u=e.enterBlock(t);for(const h of i.children)a(...Qe(h,e));for(const h of i.children)a(...Gt(h,e,a,`n${h.id}`));a(...Rt(l,e)),a(...ss(o.filter(h=>!h.generated),e,r)),a(E,"return ");const f=c.map(h=>`n${h}`),p=f.length>1?Y(Se,...f):[f[0]||"null"];return a(...p),u(),s}const Cs=63,bs=0;function Os(t){return!1}const ws=["class","id"];function Ms(t){return ws.includes(t)}class As extends bt{constructor(e,n){super(),this.ir=e,this.helpers=new Set([]),this.helper=a=>(this.helpers.add(a),`_${a}`),this.delegates=new Set,this.identifiers=Object.create(null),this.seenInlineHandlerNames=Object.create(null),this.scopeLevel=0,this.sharedDataIdent=a=>(this.effectSharedDataIdentifiers.add(a),`${this.sharedDataVar}._get_${a}(__reactivity)`),this.templateVariableCounter=0,this.templateStyleCounter=0,this.effectSharedDataIdentifiers=new Set;const r={mode:"module",platform:"app-harmony",renderer:"element",prefixIdentifiers:!0,sourceMap:!1,filename:"template.vue.html",scopeId:null,runtimeGlobalName:"Vue",runtimeModuleName:"vue",ssrRuntimeModuleName:"vue/server-renderer",ssr:!1,isTS:!1,inSSR:!1,inline:!1,bindingMetadata:{},expressionPlugins:[],type:"page",className:"",parseStaticStyle:(a,i)=>({}),isIgnoreAttr:()=>!1};this.options=N.extend(r,n),this.block=e.block;const s=this.options.renderer==="nativeView";this.genCreateTag=s?this.genCreateNativeView:this.genCreateElement,this.genAppendChild=s?this.genAppendChildNativeView:this.genAppendChildElement}withId(e,n){const{identifiers:r}=this,s=Object.keys(n);for(const i of s)r[i]||(r[i]=[]),r[i].unshift(n[i]||i);const a=e();return s.forEach(i=>N.remove(r[i],n[i]||i)),a}enterBlock(e){const n=this.block;return this.block=e,()=>this.block=n}enterScope(){return[this.scopeLevel++,()=>this.scopeLevel--]}get factoryVar(){return"__page"}get helperType(){return this.options.renderer==="nativeView"?"NativeView":"Element"}get feature(){return this.options.renderer==="nativeView"?bs:Cs}resetTemplateCounters(){this.templateVariableCounter=0,this.templateStyleCounter=0}withEffect(e){this.effectSharedDataIdentifiers.clear();const n=e();if(this.effectSharedDataIdentifiers.size){const[r,s]=j();return s(E),s(`if(${Ls(this)}) {`),s(E),s(q),s(...n),s(X),s(E),s("}"),this.effectSharedDataIdentifiers.clear(),r}return n}genCreateNativeView(e,n,r){const s=[];n&&e!=="text"&&s.push(n),r&&s.push("true");const a=s.join(", ");switch(e){case"view":return`page.createNativeView(${a})`;case"text":return`page.createNativeTextView(${a})`;case"image":return`page.createNativeImageView(${a})`;case"scroll-view":return`page.createNativeScrollView(${a})`;case"native-view":return`page.createNativeCustomView(${a})`;default:throw new Error(`Invalid tag: ${e}`)}}genCreateElement(e,n,r){const s=[];n&&e!=="comment"&&s.push(n),r&&s.push("true");const a=s.join(", ");switch(e){case"view":return`page.createViewElement(${a})`;case"text":return`page.createTextElement(${a})`;case"image":return`page.createImageElement(${a})`;default:return`page.createElement('${e}', ${a})`}}genAppendChildNativeView(e,n){return`${this.helper("appendNativeViewChild")}(${e}, ${n})`}genAppendChildElement(e,n){return`${e}.appendChild(${n})`}}function Ut(t,e){var n;e.renderer=(n=e.renderer)!=null?n:"element",e.isIgnoreAttr=e.renderer==="element"?Os:Ms;const[r,s]=j(),a=new As(t,e),{helpers:i}=a,o="render"+N.capitalize(e.renderer),l=[`__sharedData: ${e.className}SharedData`,"__page: UniPage","__reactivity: VueReactivity"].join(", ");s(E,`export function ${o}(${l}): ${a.helperType}Block {`),s(q);const c=xs(t.template,t.rootTemplateIndex,a);if(s(...c),t.template.length>0){const m=Ds(t.template,t.rootTemplateIndex,a);s(E,...m)}s(...Ce(t.block,a)),s(X,E),s("}");const u=ks(a),f=Vs(a)+u,p=[...f].filter(m=>m===`
`).length;p&&r.unshift(...new Array(p).fill(Ot));let[h,g]=pr(r,a);return h=f+h,{code:h,ast:t,preamble:f,map:g&&g.toJSON(),helpers:i}}function ks({delegates:t,helper:e}){return t.size?C(e("delegateEvents"),...Array.from(t).map(n=>`"${n}"`)).join("")+`
`:""}function Vs({helpers:t,helper:e,options:n}){let r="";return["getRestElement","getDefaultValue"].forEach(s=>{t.delete(s)}),t.size&&(r+=`import { ${[...t].map(s=>`${s} as _${s}`).join(", ")} } from '${n.runtimeModuleName}';
`),r}const Rs=new Me(2e3);function Ls(t){return Array.from(t.effectSharedDataIdentifiers).map(e=>Ps(e,t)).join(" || ")}function Ps(t,e){const{index:n,bitValue:r}=Rs.getGroupInfo(t);return`${e.sharedDataVar}._flag${n} & ${r}`}function Fs(t,e){const n=N.extend({},e),r=N.isString(t)?d.parse(t,n):t,[s,a]=Ws(),{expressionPlugins:i}=e;(!i||!i.includes("typescript"))&&(n.expressionPlugins=[...i||[],"typescript"]);const o=d.transform(r,N.extend({},n,{nodeTransforms:[...s,...e.nodeTransforms||[]],directiveTransforms:N.extend({},a,e.directiveTransforms||{})}));mn(o,{platform:e.platform,bindingMetadata:e.bindingMetadata||N.EMPTY_OBJ});const l=lr(o,n),c=Ut(o,{...n,renderer:"nativeView"}),u=Ut(o,{...n,renderer:"element"});return e.emitElement&&e.emitElement(u),e.emitNativeView&&e.emitNativeView(c),{...l,sharedData:l,nativeView:c,element:u}}function Ws(){return d.getBaseTransformPreset()}exports.parse=y.parse,exports.RENDERER_TYPE=ar,exports.TARGET_PLATFORM=ir,exports.compile=Fs;

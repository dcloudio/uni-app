"use strict";var e=require("debug");require("fs"),require("path");const r=e("uts:transformer:importAndExportDeclaration"),t=[e=>{function t(t){const{factory:n}=t;function o(e){if(e.endsWith(".uts")||e.endsWith(".ts"))return e.replace(/.u?ts$/,"")}function i(s){if(e.isImportDeclaration(s)&&s.moduleSpecifier&&e.isStringLiteral(s.moduleSpecifier)){const t=o(s.moduleSpecifier.text);if(t){if(r.enabled){const n=e.getOriginalNode(s);r(n.moduleSpecifier.getText(),`${t} at ${n.getSourceFile().fileName}`)}return n.updateImportDeclaration(s,s.modifiers,s.importClause,n.createStringLiteral(t),s.assertClause)}}else if(e.isExportDeclaration(s)&&s.moduleSpecifier&&e.isStringLiteral(s.moduleSpecifier)){const t=o(s.moduleSpecifier.text);if(t){if(r.enabled){const n=e.getOriginalNode(s);r(n.moduleSpecifier.getText(),`${t} at ${n.getSourceFile().fileName}`)}return n.updateExportDeclaration(s,s.modifiers,s.isTypeOnly,s.exportClause,n.createStringLiteral(t),s.assertClause)}}return e.visitEachChild(s,i,t)}return r=>e.visitNode(r,i)}return{parser:{SourceFile:e=>t(e)},afterDeclarations:t}}];var n;function o(e,r,t,n,o,i,s){return{code:e,category:r,key:t,message:n,reportsUnnecessary:o,elidedInCompatabilityPyramid:i,reportsDeprecated:s}}function i(e,r,t,n){return o=>{const i=t(o);return t=>{const s=e.isSourceFile(t);return o.fileName||s&&(o.fileName=t.fileName,t.__utsMeta||(t.__utsMeta={})),r.shouldTransform(o.fileName)?(s&&!t.isUTSFile&&(t.isUTSFile=!0,r.isVueFile?.(o.fileName)&&(t.isVueFile=!0)),s&&"parser"===n&&t.statements.length&&(t.statements[0].parent||e.setParentRecursive(t,!0)),i(t)):t}}}function s(e,r){return r&&r!==e&&!Array.isArray(r)&&(r.__parsedByUtsParser=!0,r.parent=e.parent),r}let a;function l(e,r,t){return function(e){if(!e.ObjectFlags.UTSType){const{Class:r,Interface:t,Reference:n,Anonymous:o,ArrayLiteral:i}=e.ObjectFlags;e.ObjectFlags.UTSType=r|t|n|o|i}if(!e.TypeFlags.UTSType){const{Any:r,String:t,Number:n,Boolean:o,Enum:i,StringLiteral:s,NumberLiteral:a,BooleanLiteral:l,EnumLiteral:_,Void:p,Null:c,Object:u,Union:f,TemplateLiteral:d}=e.TypeFlags;e.TypeFlags.UTSType=r|t|n|o|i|s|a|l|_|p|c|u|f|d,e.TypeFlags.UTSStringLike=t|s|d,e.TypeFlags.UTSNumberLike=n|a}}(e),n=>{const o={},l=[],_=[],p=[];return r.forEach((r=>{let c=r(e,n,t);if("function"==typeof c)l.push(i(e,n,c,"before"));else{if(c.parser){const l=r(function(e){if(a)return a;a={...e};const{visitNode:r,visitEachChild:t}=e;return a.visitNode=(e,t)=>r(e,(e=>s(e,t(e)))),a.visitEachChild=(e,r,n)=>t(e,(e=>s(e,r(e))),n),a}(e),n,t);l.parser&&function(e,r,t,n){n.TypeAliasDeclaration&&(t.TypeAliasDeclaration||(t.TypeAliasDeclaration=[])).push(i(e,r,(e=>{const r=n.TypeAliasDeclaration(e);return e=>s(e,r(e))}),"parser")),n.SourceFile&&(t.SourceFile||(t.SourceFile=[])).push(i(e,r,n.SourceFile,"parser"))}(e,n,o,l.parser)}c.before&&l.push(i(e,n,c.before,"before")),c.after&&_.push(i(e,n,c.after,"after")),c.afterDeclarations&&p.push(i(e,n,c.afterDeclarations,"afterDeclarations"))}})),{parser:o,before:l,after:_,afterDeclarations:p}}}!function(e){e[e.Warning=0]="Warning",e[e.Error=1]="Error",e[e.Suggestion=2]="Suggestion",e[e.Message=3]="Message"}(n||(n={})),o(1e5,n.Error,"Type_literal_property_must_have_a_type_annotation_100000","Type literal property must have a type annotation."),o(100001,n.Error,"Only_one_extends_heritage_clause_is_allowed_for_interface_100001","Only one extends heritage clause is allowed for interface."),o(100002,n.Error,"Variable_declaration_must_have_initializer_100002","Variable declaration must have initializer."),o(100003,n.Error,"Nested_type_literal_is_not_supported_100003","Nested type literal is not supported."),o(100004,n.Error,"Invalid_generic_type_which_can_not_be_constructed_100004","Invalid generic type which can not be constructed."),o(100005,n.Error,"script_setup_cannot_contain_ES_module_exports_100005","`<script setup>` cannot contain ES module exports."),o(100006,n.Error,"Type_aliases_cannot_appear_in_local_scope_100006","Type aliases cannot appear in local scope."),o(110111101,n.Error,"Direct_declaration_of_Object_Literal_Type_is_not_supported_110111101","Direct declaration of Object Literal Type is not supported."),o(110111163,n.Error,"Object_literals_only_support_object_types_defined_by_construction_type_and_do_not_support_interfaces_110111163","Object literals only support object types defined by construction type, and do not support interfaces."),o(110111120,n.Error,"Conditional_statements_must_use_boolean_types_110111120","Conditional statements must use boolean types."),o(110111164,n.Error,"Class_cannot_be_used_as_a_value_110111164","Class cannot be used as a value."),o(110111134,n.Error,"Methods_to_modify_objects_are_not_supported_110111134","Methods to modify objects are not supported."),o(110111125,n.Error,"TypeScript_utility_types_are_not_supported_110111125","TypeScript utility types are not supported."),o(110111119,n.Error,"Undefined_is_not_supported_110111119","Undefined is not supported."),o(110111128,n.Error,"Private_fields_starting_with_are_not_supported_110111128","Private fields starting with #are not supported."),o(110111161,n.Error,"Property_methods_for_type_class_or_interface_do_not_support_defining_generic_information_110111161","Property methods for type, class, or interface do not support defining generic information."),o(110111138,n.Error,"Declaring_properties_on_functions_is_not_supported_110111138","Declaring properties on functions is not supported."),o(110111143,n.Error,"Type_protection_using_instanceof_and_as_110111143","Type protection using instanceof and as."),o(110111146,n.Error,"Generator_functions_are_not_supported_110111146","Generator functions are not supported."),o(110111149,n.Error,"Delete_operator_is_not_supported_110111149","Delete operator is not supported."),o(12e7,n.Error,"You_cannot_assign_a_function_to_an_interface_120000000","You cannot assign a function to an interface."),o(120000001,n.Error,"Members_of_an_interface_cannot_be_a_call_signatures_120000001","Members of an interface cannot be a call signatures."),o(120000003,n.Error,"Enum_member_initializer_only_supports_number_or_string_literal_120000003","Enum member initializer only supports number or string literal."),o(120000004,n.Error,"Enum_declarations_must_be_at_top_level_in_Kotlin_120000004","Enum declarations must be at top level in Kotlin."),o(110111165,n.Error,"Recursive_calls_on_function_expressions_are_not_supported_Define_the_function_separately_before_invo_110111165","Recursive calls on function expressions are not supported. Define the function separately before invoking it."),o(100007,n.Error,"The_type_could_not_be_inferred_100007","The type could not be inferred."),e("uts:transformer:autoImport"),e("uts:transformer:arguments"),e("uts:transformer:checker"),e("uts:transformer:generics"),e("uts:transformer:in"),e("uts:transformer:keyof"),e("uts:transformer:narrowType:discriminatedUnion"),e("uts:transformer:narrowType:nonNullable"),e("uts:transformer:narrowType"),e("uts:transformer:narrowType:parameterUnionType"),e("uts:transformer:UTSObjectUnionType"),e("uts:transformer:objectLiteral"),e("uts:transformer:returnType"),e("uts:transformer:UTSJSONObject"),exports.emitDeclaration=function({typescript:e,inputDir:r,rootFiles:n,compilerOptions:o={}}){const i=e.createCompilerHost(o),s=new Map;i.fileExists=t=>{if(s.has(t))return!0;if(t.startsWith(r))if(t.endsWith(".uts.ts")){const r=t.slice(0,-3);if(e.sys.fileExists(r))return s.set(t,r),!0}else if(t.endsWith(".ts")){const r=t.slice(0,-3)+".uts";if(e.sys.fileExists(r))return s.set(t,r),!0}return e.sys.fileExists(t)},i.readFile=r=>{const t=s.get(r);return t?e.sys.readFile(t):e.sys.readFile(r)};const a=e.createProgram(n,{...o,declaration:!0,emitDeclarationOnly:!0,emitUTS:!0,allowNonTsExtensions:!0,listEmittedFiles:!0},i),{afterDeclarations:_}=l(e,t,{platform:"app-android",targetLanguage:"Kotlin",setParentRecursive:!1})({getProgram:()=>a,isUTSDeclarationFile:e=>!0,shouldTransform:e=>e.startsWith(r),isVueFile:()=>!1});return a.emit(void 0,void 0,void 0,!0,{afterDeclarations:_},!1===o.noEmitOnError)};

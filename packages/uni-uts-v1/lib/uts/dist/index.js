"use strict";var e=require("debug");require("fs"),require("path");const t=e("uts:transformer:importAndExportDeclaration"),r=[e=>{function r(r){const{factory:i}=r;function s(e){if(e.endsWith(".uts")||e.endsWith(".ts"))return e.replace(/.u?ts$/,"")}function a(n){if(e.isImportDeclaration(n)&&n.moduleSpecifier&&e.isStringLiteral(n.moduleSpecifier)){const r=s(n.moduleSpecifier.text);if(r){if(t.enabled){const i=e.getOriginalNode(n);t(i.moduleSpecifier.getText(),`${r} at ${i.getSourceFile().fileName}`)}return i.updateImportDeclaration(n,n.modifiers,n.importClause,i.createStringLiteral(r),n.assertClause)}}else if(e.isExportDeclaration(n)&&n.moduleSpecifier&&e.isStringLiteral(n.moduleSpecifier)){const r=s(n.moduleSpecifier.text);if(r){if(t.enabled){const i=e.getOriginalNode(n);t(i.moduleSpecifier.getText(),`${r} at ${i.getSourceFile().fileName}`)}return i.updateExportDeclaration(n,n.modifiers,n.isTypeOnly,n.exportClause,i.createStringLiteral(r),n.assertClause)}}return e.visitEachChild(n,a,r)}return t=>e.visitNode(t,a)}return{parser:{SourceFile:e=>r(e)},afterDeclarations:r}}];var i;function s(e,t,r,i,s,a,n){return{code:e,category:t,key:r,message:i,reportsUnnecessary:s,elidedInCompatabilityPyramid:a,reportsDeprecated:n}}function a(e,t,r,i){return s=>{const a=r(s);return r=>{const n=e.isSourceFile(r);return s.fileName||n&&(s.fileName=r.fileName),t.shouldTransform(s.fileName)?(n&&!r.isUTSFile&&(r.isUTSFile=!0,t.isVueFile?.(s.fileName)&&(r.isVueFile=!0)),n&&"parser"===i&&r.statements.length&&(r.statements[0].parent||e.setParentRecursive(r,!0)),a(r)):r}}}function n(e,t){return t&&t!==e&&!Array.isArray(t)&&(t.__parsedByUtsParser=!0,t.parent=e.parent),t}let o;function l(e,t,r){return function(e){if(!e.ObjectFlags.UTSType){const{Class:t,Interface:r,Reference:i,Anonymous:s,ArrayLiteral:a}=e.ObjectFlags;e.ObjectFlags.UTSType=t|r|i|s|a}if(!e.TypeFlags.UTSType){const{Any:t,String:r,Number:i,Boolean:s,Enum:a,StringLiteral:n,NumberLiteral:o,BooleanLiteral:l,EnumLiteral:c,Void:u,Null:p,Object:f,Union:_,TemplateLiteral:d}=e.TypeFlags;e.TypeFlags.UTSType=t|r|i|s|a|n|o|l|c|u|p|f|_|d,e.TypeFlags.UTSStringLike=r|n|d,e.TypeFlags.UTSNumberLike=i|o}}(e),i=>{const s={},l=[],c=[],u=[];return t.forEach((t=>{let p=t(e,i,r);if("function"==typeof p)l.push(a(e,i,p,"before"));else{if(p.parser){const l=t(function(e){if(o)return o;o={...e};const{visitNode:t,visitEachChild:r}=e;return o.visitNode=(e,r)=>t(e,(e=>n(e,r(e)))),o.visitEachChild=(e,t,i)=>r(e,(e=>n(e,t(e))),i),o}(e),i,r);l.parser&&function(e,t,r,i){i.TypeAliasDeclaration&&(r.TypeAliasDeclaration||(r.TypeAliasDeclaration=[])).push(a(e,t,(e=>{const t=i.TypeAliasDeclaration(e);return e=>n(e,t(e))}),"parser")),i.SourceFile&&(r.SourceFile||(r.SourceFile=[])).push(a(e,t,i.SourceFile,"parser"))}(e,i,s,l.parser)}p.before&&l.push(a(e,i,p.before,"before")),p.after&&c.push(a(e,i,p.after,"after")),p.afterDeclarations&&u.push(a(e,i,p.afterDeclarations,"afterDeclarations"))}})),{parser:s,before:l,after:c,afterDeclarations:u}}}!function(e){e[e.Warning=0]="Warning",e[e.Error=1]="Error",e[e.Suggestion=2]="Suggestion",e[e.Message=3]="Message"}(i||(i={})),s(1e5,i.Error,"Type_literal_property_must_have_a_type_annotation_100000","Type literal property must have a type annotation."),s(100001,i.Error,"Only_one_extends_heritage_clause_is_allowed_for_interface_100001","Only one extends heritage clause is allowed for interface"),s(100002,i.Error,"Variable_declaration_must_have_initializer_100002","Variable declaration must have initializer."),s(100003,i.Error,"Nested_type_literal_is_not_supported_100003","Nested type literal is not supported."),s(100004,i.Error,"Invalid_generic_type_which_can_not_be_constructed_100004","Invalid generic type which can not be constructed."),s(100005,i.Error,"script_setup_cannot_contain_ES_module_exports_100005","`<script setup>` cannot contain ES module exports."),s(100006,i.Error,"UTS_does_not_allow_type_assignment_operations_in_local_scopes_100006","UTS does not allow type assignment operations in local scopes"),s(110111101,i.Error,"direct_declaration_of_Object_Literal_Type_is_not_supported_110111101","direct declaration of Object Literal Type is not supported."),s(110111163,i.Error,"Object_literals_only_support_object_types_defined_by_construction_type_and_do_not_support_interfaces_110111163","Object literals only support object types defined by construction type, and do not support interfaces"),s(110111120,i.Error,"Conditional_statements_must_use_boolean_types_110111120","Conditional statements must use boolean types"),e("uts:transformer:autoImport"),e("uts:transformer:arguments"),e("uts:transformer:checker"),e("uts:transformer:generics"),e("uts:transformer:in"),e("uts:transformer:keyof"),e("uts:transformer:narrowType:discriminatedUnion"),e("uts:transformer:narrowType:nonNullable"),e("uts:transformer:narrowType"),e("uts:transformer:narrowType:parameterUnionType"),e("uts:transformer:UTSObjectUnionType"),e("uts:transformer:objectLiteral"),e("uts:transformer:returnType"),e("uts:transformer:UTSJSONObject"),exports.emitDeclaration=function({typescript:e,inputDir:t,rootFiles:i,compilerOptions:s={}}){const a=e.createCompilerHost(s),n=new Map;a.fileExists=r=>{if(n.has(r))return!0;if(r.startsWith(t))if(r.endsWith(".uts.ts")){const t=r.slice(0,-3);if(e.sys.fileExists(t))return n.set(r,t),!0}else if(r.endsWith(".ts")){const t=r.slice(0,-3)+".uts";if(e.sys.fileExists(t))return n.set(r,t),!0}return e.sys.fileExists(r)},a.readFile=t=>{const r=n.get(t);return r?e.sys.readFile(r):e.sys.readFile(t)};const o=e.createProgram(i,{...s,declaration:!0,emitDeclarationOnly:!0,emitUTS:!0,allowNonTsExtensions:!0,listEmittedFiles:!0},a),{afterDeclarations:c}=l(e,r,{platform:"app-android",targetLanguage:"Kotlin",setParentRecursive:!1})({getProgram:()=>o,isUTSDeclarationFile:e=>!0,shouldTransform:e=>e.startsWith(t),isVueFile:()=>!1});return o.emit(void 0,void 0,void 0,!0,{afterDeclarations:c},!1===s.noEmitOnError)};

"use strict";require("fs");var e=require("debug"),t=require("path"),r=require("fs-extra"),i=require("source-map-js");const n=["/uni-app-x/types/uni/","/uni-app-x/types/uni-cloud/","/UniPage.d.ts","/IUniElement.d.ts"];function s(e){return e.replace(/\\/g,"/")}function o(e,t){const r=e.getSourceFile();if(r.isDeclarationFile){if(!0===r.__isUTSDeclarationFile)return!0;if(!1===r.__isUTSDeclarationFile)return!1;const e=s(r.fileName);return e.startsWith(t)||n.some((t=>e.includes(t)))?(r.__isUTSDeclarationFile=!0,!0):(r.__isUTSDeclarationFile=!1,!1)}return!0}var a;function c(e,t,r,i,n,s,o){return{code:e,category:t,key:r,message:i,reportsUnnecessary:n,elidedInCompatabilityPyramid:s,reportsDeprecated:o}}!function(e){e[e.Warning=0]="Warning",e[e.Error=1]="Error",e[e.Suggestion=2]="Suggestion",e[e.Message=3]="Message"}(a||(a={}));const l={Type_literal_property_must_have_a_type_annotation:c(1e5,a.Error,"Type_literal_property_must_have_a_type_annotation_100000","Type literal property must have a type annotation."),Only_one_extends_heritage_clause_is_allowed_for_interface:c(100001,a.Error,"Only_one_extends_heritage_clause_is_allowed_for_interface_100001","Only one extends heritage clause is allowed for interface."),Variable_declaration_must_have_initializer:c(100002,a.Error,"Variable_declaration_must_have_initializer_100002","Variable declaration must have initializer."),Nested_type_literal_is_not_supported:c(100003,a.Error,"Nested_type_literal_is_not_supported_100003","Nested type literal is not supported."),Invalid_generic_type_which_can_not_be_constructed:c(100004,a.Error,"Invalid_generic_type_which_can_not_be_constructed_100004","Invalid generic type which can not be constructed."),script_setup_cannot_contain_ES_module_exports:c(100005,a.Error,"script_setup_cannot_contain_ES_module_exports_100005","`<script setup>` cannot contain ES module exports."),Type_aliases_cannot_appear_in_local_scope:c(100006,a.Error,"Type_aliases_cannot_appear_in_local_scope_100006","Type aliases cannot appear in local scope."),Direct_declaration_of_Object_Literal_Type_is_not_supported:c(110111101,a.Error,"Direct_declaration_of_Object_Literal_Type_is_not_supported_110111101","Direct declaration of Object Literal Type is not supported."),Object_literals_only_support_object_types_defined_by_construction_type_and_do_not_support_interfaces:c(110111163,a.Error,"Object_literals_only_support_object_types_defined_by_construction_type_and_do_not_support_interfaces_110111163","Object literals only support object types defined by construction type, and do not support interfaces."),Conditional_statements_must_use_boolean_types:c(110111120,a.Error,"Conditional_statements_must_use_boolean_types_110111120","Conditional statements must use boolean types."),Class_cannot_be_used_as_a_value:c(110111164,a.Error,"Class_cannot_be_used_as_a_value_110111164","Class cannot be used as a value."),Methods_to_modify_objects_are_not_supported:c(110111134,a.Error,"Methods_to_modify_objects_are_not_supported_110111134","Methods to modify objects are not supported."),Undefined_is_not_supported:c(110111119,a.Error,"Undefined_is_not_supported_110111119","Undefined is not supported."),Private_fields_starting_with_are_not_supported:c(110111128,a.Error,"Private_fields_starting_with_are_not_supported_110111128","Private fields starting with #are not supported."),Property_methods_for_type_class_or_interface_do_not_support_defining_generic_information:c(110111161,a.Error,"Property_methods_for_type_class_or_interface_do_not_support_defining_generic_information_110111161","Property methods for type, class, or interface do not support defining generic information."),Declaring_properties_on_functions_is_not_supported:c(110111138,a.Error,"Declaring_properties_on_functions_is_not_supported_110111138","Declaring properties on functions is not supported."),Type_protection_using_instanceof_and_as:c(110111143,a.Error,"Type_protection_using_instanceof_and_as_110111143","Type protection using instanceof and as."),Generator_functions_are_not_supported:c(110111146,a.Error,"Generator_functions_are_not_supported_110111146","Generator functions are not supported."),Delete_operator_is_not_supported:c(110111149,a.Error,"Delete_operator_is_not_supported_110111149","Delete operator is not supported."),You_cannot_assign_a_function_to_an_interface:c(12e7,a.Error,"You_cannot_assign_a_function_to_an_interface_120000000","You cannot assign a function to an interface.")};var p;function u(e){let t,r=()=>{};return t=e?Promise.race([new Promise((t=>setTimeout(t,e,!0))),new Promise((e=>r=e))]):new Promise((e=>r=e)),{promise:t,resolve:r}}!function(e){e[e.STARTING_COMPILATION_IN_WATCH_MODE=6031]="STARTING_COMPILATION_IN_WATCH_MODE",e[e.FILE_CHANGE_DETECTED=6032]="FILE_CHANGE_DETECTED",e[e.FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES=6193]="FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES",e[e.FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES=6194]="FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES"}(p||(p={}));class d{constructor(e){this._startDeferred=null,this._finishDeferred=null,this._ts=e}watch(e){this._startDeferred=u(e),this._finishDeferred=u()}handleStatus(e){if(e.category===this._ts.DiagnosticCategory.Message)switch(e.code){case p.FILE_CHANGE_DETECTED:this.resolveStart();break;case p.FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES:case p.FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES:this.resolveFinish()}}resolveStart(){this._startDeferred&&(this._startDeferred.resolve(!1),this._startDeferred=null)}resolveFinish(){this._finishDeferred&&(this._finishDeferred.resolve(!1),this._finishDeferred=null)}async wait(){if(this._startDeferred){await this._startDeferred.promise&&(this._startDeferred=null,this._finishDeferred=null),await(this._finishDeferred?.promise)}}}const f=e("uts:tsc:compile"),y={strict:!0,noLib:!0,emitUTS:!0,isolatedModules:!0,target:99,module:99,moduleResolution:100};class g{constructor(e){this._rootFiles=[],this._options=e}debug(e,...t){return f(e,...t)}getProgram(){return this._watcher?.getProgram()?.getProgram()}getTypeScript(){return this._options.typescript}hasRootFile(e){return this._rootFiles.includes(s(e))}async addRootFile(e,t=2e3){return this.addRootFiles([e],t)}async addRootFiles(e,t=2e3){const r=e.map(s).filter((e=>!this._rootFiles.includes(e)));if(0===r.length)return void(e.length&&f.enabled&&f("addRootFile",e,"already exists"));f.enabled&&f("addRootFiles.start",r);const i=Date.now();this._rootFiles.push(...r),await this._watcher.updateRootFileNames(this._rootFiles.slice()),f.enabled&&f("addRootFiles.end",r,Date.now()-i)}getRootFiles(){return this._rootFiles}async wait(e,t){const r=Date.now();this._helper.watch(e),await this._helper.wait(),f.enabled&&f("wait",Date.now()-r,t)}async close(){this._watcher&&this._watcher.close()}getDiagnostics(){const e=this._watcher?.getProgram();if(!e)return[];const t=this._options.typescript.getPreEmitDiagnostics(e.getProgram()),r=[],i=e.getProgram().getSourceFiles(),n=new Set(Object.values(l).map((e=>e.code)));return i.forEach((e=>{if(e.bindDiagnostics?.length){const t=e.bindDiagnostics.filter((e=>n.has(e.code)));r.push(...t)}if(e.parseDiagnostics?.length){const t=e.parseDiagnostics.filter((e=>n.has(e.code)));r.push(...t)}})),this._options.typescript.sortAndDeduplicateDiagnostics([...t,...r])}async init(){if(this._watcher)return;const e=Date.now(),{typescript:r,compilerOptions:i,rootFiles:n,incremental:o,createTransformers:a,watchFile:c,reportFileName:l,reportDiagnostic:u,normalizeFileName:g,sourceMapCallback:T}=this._options;f.enabled&&r.performance.enable(r.sys);const _=s(this._options.inputDir);this._rootFiles=n.map(s);const x={...i,...y,incremental:o,tsBuildInfoFile:o&&this._options.cacheDir?t.resolve(this._options.cacheDir,".tsbuildInfo"):""};if(x.paths||(x.paths={}),x.paths["@/*"]=[_+"/*"],f.enabled)if(Object.keys(x.paths).length>200){const{paths:e,...t}=x;f("Compiler options:",t)}else f("Compiler options:",x);let S=!0;const N=new Map,b=r.sys.useCaseSensitiveFileNames?m:h,E={...r.sys,watchFile:(e,t,i,n)=>c?c(e,t,i,n):r.sys.watchFile(e,t,i,n),fileExists:e=>!!L(e,r),readFile:(e,t)=>r.sys.readFile(L(e,r),t)};let v;f.enabled&&f("rootFiles",this._rootFiles);const{parser:F,before:D,after:A,afterDeclarations:C}=a({getProgram:()=>v,shouldTransform:function(e){if(N.has(e))return!0;return e.startsWith(_)},normalizeFileName:g},{rootDir:s(x.rootDir||"")});globalThis.__utsParser__||(globalThis.__utsParser__=F),globalThis.__utsCustomParser__=F;const{watcher:k,helper:P}=function(){let e=0;const t=new d(r),i={excludeDirectories:["/**/*/"]};f.enabled&&f("watchOptions",i);const s=r.createWatchCompilerHost(n,x,E,r.createEmitAndSemanticDiagnosticsBuilderProgram,u,(function(i){f.enabled&&f("reportWatchStatusChanged",i,Date.now()-e,"ms"),i.category===r.DiagnosticCategory.Message&&(i.code===p.STARTING_COMPILATION_IN_WATCH_MODE||i.code===p.FILE_CHANGE_DETECTED?e=Date.now():i.code!==p.FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES&&i.code!==p.FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES||(f.enabled&&f("Compilation completed in",Date.now()-e,"ms"),function(e,t){if(f.enabled){const r={Files:t.getSourceFiles().length,Identifiers:t.getIdentifierCount(),Symbols:t.getSymbolCount(),Types:t.getTypeCount(),Instantiations:t.getInstantiationCount(),"Memory used":Math.round((e.sys.getMemoryUsage?e.sys.getMemoryUsage():-1)/1e3/1e3)+"M",cache:t.getRelationCacheSizes()};e.performance.forEachMeasure(((e,t)=>{r[e]=t})),f.enabled&&f("performance:",r),e.performance.disable(),e.performance.enable(e.sys)}}(r,v)));t.handleStatus(i)}),void 0,i);const o=s.createProgram;s.createProgram=(e,t,r,i)=>{!function(e){const t=e.resolveModuleNameLiterals;e.resolveModuleNameLiterals=(e,r,i,n,s,o)=>{const a=t(e,r,i,n,s,o);return a.forEach((({resolvedModule:e})=>{if(e){const t=N.get(b(e.resolvedFileName));t&&(e.resolvedFileName=t)}})),a}}(r);const n=o(e,t,r,i);return function(e,t){v=t;const r=t.emit.bind(t);t.emit=(i,n,s,o,a)=>{a||(a={}),(a.before||(a.before=[])).push(...D),(a.after||(a.after=[])).push(...A),(a.afterDeclarations||(a.afterDeclarations=[])).push(...C);return r(i,((r,i,s,o,a,c)=>{if(n=n||e?.writeFile||t.writeFile,!(T&&r.endsWith(".map")&&T(r,i,((e,t)=>n(e,t,s,o,a,c)))))return n(r,i,s,o,a,c)}),s,o,a)}}(r,n.getProgram()),function(e){if(f.enabled){const t=e.getSourceFiles(),r=[],i=[],n=[];t.forEach((e=>{const{type:t,fileName:s}=l(e.fileName);"system"===t?r.push(s):"user"===t?i.push(s):n.push(s)})),S&&(S=!1,f("libs:",r.length),r.sort().forEach((e=>f("  ",e))),f("users:",i.length),i.sort().forEach((e=>f("  ",e))),f("others:",n.length),n.sort().forEach((e=>f("  ",e)))),f("sourceFiles",{total:t.length,libs:r.length,users:i,others:n.length})}}(n.getProgram()),n};const a=r.createWatchProgram(s);return{watcher:a,helper:t}}();return this._watcher=k,this._helper=P,void(f.enabled&&f("init",Date.now()-e));function L(e,t){const r=b(e),i=N.get(r);if(i)return i;let n=e.split("?",2)[0];const s=n.endsWith(".ts");if(!s){const e=n+".ts";if(t.sys.fileExists(e))return N.set(r,e),n}if(t.sys.fileExists(n))return N.set(r,n),n;if(s){const e=n.slice(0,-3),i=[".uvue.ts",".uts.ts",".vue.ts"];for(const n of i){const i=e+n;if(t.sys.fileExists(i))return N.set(r,i),i}}}}}function m(e){return e}function T(e){return e.toLowerCase()}const _=/[^\u0130\u0131\u00DFa-z0-9\\/:\-_. ]+/g;function h(e){return _.test(e)?e.replace(_,T):e}class x{addAutoImport(e){this.autoImports.some((t=>t.fileName===e.fileName&&t.name===e.name&&t.localName===e.localName))||this.autoImports.push(e)}constructor(e,t,r,i,n,s){this.currentNode=e,this.currentSourceFile=t,this.checker=r,this.context=i,this.ts=n,this.autoImports=s}static updateSourceFile(e,t,r,i){if(0===e.length)return t;const n=[];for(let t=0;t<e.length;t++){const i=e[t],s=r.createImportDeclaration(void 0,r.createImportClause(!1,void 0,r.createNamedImports([r.createImportSpecifier(!1,r.createIdentifier(i.localName),r.createIdentifier(i.name))])),r.createStringLiteral(i.fileName));n.push(s)}const s=t.statements.findIndex((e=>!i.isImportDeclaration(e)))??t.statements.length,o=[...t.statements.slice(0,s),...n,...t.statements.slice(s)];return r.updateSourceFile(t,o,t.isDeclarationFile,t.referencedFiles,t.typeReferenceDirectives,t.hasNoDefaultLib,t.libReferenceDirectives)}visitTypeNode(e){const t=this.ts.visitEachChild(e,(e=>this.visitTypeNode(e)),this.context);if(this.ts.isImportTypeNode(t)){const e=t.qualifier;if(e){const r=e.symbol,i=r.declarations&&r.declarations[0];if(i){const r=i.getSourceFile().fileName,n=e.escapedText,s=ts.getUniqueName(n,this.currentSourceFile);if(n&&s)return this.addAutoImport({fileName:r,name:n,localName:s}),this.context.factory.createTypeReferenceNode(s,t.typeArguments)}}}else if(this.ts.isIdentifier(t)){const e=t.symbol;if(this.checker.isSymbolAccessible(e,this.currentNode,this.ts.SymbolFlags.Type,!0).accessibility===this.ts.SymbolAccessibility.CannotBeNamed)throw new Error(`Type '${t.getText()}' is not accessible in the current context.`)}return t}}function S(e){return e.endsWith(".uts.ts")?e.replace(/\.uts\.ts$/,""):e.replace(/\.\w+$/,"")}function N(e,t,r,i){return n=>{const s=r(n);return r=>{const o=e.isSourceFile(r);return n.fileName||o&&(n.fileName=r.fileName,r.__utsMeta||(r.__utsMeta={})),t.shouldTransform(n.fileName)?(o&&!r.isUTSFile&&(r.isUTSFile=!0,t.isVueFile?.(n.fileName)&&(r.isVueFile=!0)),o&&"parser"===i&&r.statements.length&&(r.statements[0].parent||e.setParentRecursive(r,!0)),s(r)):r}}}function b(e,t){return t&&t!==e&&!Array.isArray(t)&&(t.__parsedByUtsParser=!0,t.parent=e.parent),t}let E;function v(e,t,r){return function(e){if(!e.ObjectFlags.UTSType){const{Class:t,Interface:r,Reference:i,Anonymous:n,ArrayLiteral:s}=e.ObjectFlags;e.ObjectFlags.UTSType=t|r|i|n|s}if(!e.TypeFlags.UTSType){const{Any:t,String:r,Number:i,Boolean:n,Enum:s,StringLiteral:o,NumberLiteral:a,BooleanLiteral:c,EnumLiteral:l,Void:p,Null:u,Object:d,Union:f,TemplateLiteral:y}=e.TypeFlags;e.TypeFlags.UTSType=t|r|i|n|s|o|a|c|l|p|u|d|f|y,e.TypeFlags.UTSStringLike=r|o|y,e.TypeFlags.UTSNumberLike=i|a}}(e),i=>{const n={},s=[],o=[],a=[];return t.forEach((t=>{let c=t(e,i,r);if("function"==typeof c)s.push(N(e,i,c,"before"));else{if(c.parser){const s=t(function(e){if(E)return E;E={...e};const{visitNode:t,visitEachChild:r}=e;return E.visitNode=(e,r)=>t(e,(e=>b(e,r(e)))),E.visitEachChild=(e,t,i)=>r(e,(e=>b(e,t(e))),i),E}(e),i,r);s.parser&&function(e,t,r,i){i.TypeAliasDeclaration&&(r.TypeAliasDeclaration||(r.TypeAliasDeclaration=[])).push(N(e,t,(e=>{const t=i.TypeAliasDeclaration(e);return e=>b(e,t(e))}),"parser")),i.SourceFile&&(r.SourceFile||(r.SourceFile=[])).push(N(e,t,i.SourceFile,"parser"))}(e,i,n,s.parser)}c.before&&s.push(N(e,i,c.before,"before")),c.after&&o.push(N(e,i,c.after,"after")),c.afterDeclarations&&a.push(N(e,i,c.afterDeclarations,"afterDeclarations"))}})),{parser:n,before:s,after:o,afterDeclarations:a}}}function F(e){if(e&&!e.getUTSJSONObjectType&&e.getGlobalType){const t=e.getGlobalType("UTSJSONObject",0,!0);e.getUTSJSONObjectType=()=>t;const r=e.getGlobalType("String",0,!0);e.getUTSStringType=()=>r;const i=e.getGlobalType("Number",0,!0);e.getUTSNumberType=()=>i}}function D(e,t,r){if(r.flags&e.TypeFlags.TypeParameter)return!0;if(r.isUnion()){if(r.types.length>2)return!1;if(r===t.getBooleanType())return!0;const i=t.getNullType(),n=r.types[0],s=r.types[1];return n===i&&D(e,t,s)||s===i&&D(e,t,n)}return r.flags&e.TypeFlags.Object?!!(r.objectFlags&e.ObjectFlags.UTSType):!!(r.flags&e.TypeFlags.UTSType)}function A(e,t,r){const i=e.getOriginalNode(r);return e.isExpression(i)?t.getContextualType(i):void 0}function C(e,t){return e.getContextualType(t)??e.getTypeAtLocation(t)}function k(e,t){return t?e.getNonNullableType(t):t}function P(e,t){return t.flags&e.TypeFlags.Object&&t.objectFlags&e.ObjectFlags.Anonymous&&!t.aliasSymbol&&0===t.getCallSignatures().length}function L(e,t){if(e.symbol&&e.aliasSymbol&&e.aliasSymbol.flags&t.SymbolFlags.TypeAlias&&1===e.aliasSymbol.declarations?.length){const r=e.aliasSymbol.declarations[0];if(t.isTypeAliasDeclaration(r)&&t.isTypeLiteralNode(r.type)&&r.type.members.every((e=>t.isPropertySignature(e)||t.isCallSignatureDeclaration(e))))return!0}return!1}function w(e,t,r){const i=e.getOriginalNode(r).parent;if(i&&e.isObjectLiteralExpression(i)&&e.isIdentifier(r.name)){const e=t.getContextualType(i);if(e){const i=e.getProperty(r.name.text);if(i)return t.getTypeOfSymbol(i)}}}function O(e,t,r){return e===r.getErrorType?.()||!!(e.flags&t.TypeFlags.Any&&e.aliasSymbol)}function I(e,t){return t.map((t=>e.isIdentifier(t.name)?t.name.text:t.name)).join(", ")}function U(e,t){return!!t.isImportTypeNode(e)||(t.forEachChild(e,(e=>U(e,t)))||!1)}function K(e,t,r,i){const n=function(e,t){for(t=e.getOriginalNode(t);;){if(!(t=t.parent))return;switch((t=e.getOriginalNode(t)).kind){case e.SyntaxKind.SourceFile:case e.SyntaxKind.MethodDeclaration:case e.SyntaxKind.MethodSignature:case e.SyntaxKind.FunctionDeclaration:case e.SyntaxKind.FunctionExpression:case e.SyntaxKind.GetAccessor:case e.SyntaxKind.SetAccessor:case e.SyntaxKind.ClassDeclaration:case e.SyntaxKind.InterfaceDeclaration:case e.SyntaxKind.EnumDeclaration:case e.SyntaxKind.ModuleDeclaration:return t}}}(r,t);let s=i.typeToTypeNode(e,n,r.NodeBuilderFlags.None);if(!s&&n&&(s=i.typeToTypeNode(e,void 0,r.NodeBuilderFlags.None)),s)return U(s,r)?i.typeToTypeNode(e,void 0,r.NodeBuilderFlags.None):r.isTypeLiteralNode(s)?r.factory.createTypeReferenceNode(r.factory.createIdentifier("UTSJSONObject"),void 0):(r.isTypeReferenceNode(s)&&s.typeArguments&&(s=R(r,s)),s)}function R(e,t){if(e.isTypeReferenceNode(t)&&t.typeArguments){let r=!1;const i=t.typeArguments.map((t=>{if(e.isTypeLiteralNode(t))return r=!0,e.factory.createTypeReferenceNode(e.factory.createIdentifier("UTSJSONObject"),void 0);if(e.isTypeReferenceNode(t)){const i=R(e,t);return i!==t&&(r=!0),i}return t}));if(r)return e.factory.createTypeReferenceNode(t.typeName,i)}return t}e("uts:transformer:importAndExportDeclaration");const $=e("uts:transformer:autoImport");function M(e,t,r){const i=new Map;r.statements.forEach((r=>{if(!e.isImportDeclaration(r))return;const n=r.importClause;if(!n)return;const{name:o,namedBindings:a}=n;a&&e.isNamedImports(a)&&a.elements.forEach((e=>{const r=t.getSymbolAtLocation(e.name);if(r){const n=function(e){const{declarations:t}=e;if(!t||1!==t.length)return;return S(s(t[0].getSourceFile().fileName))}(t.getAliasedSymbol(r));if(!n)return;i.has(n)||i.set(n,{}),i.get(n)[e.name.text]=e.propertyName?.text??e.name.text}}))})),r.__imports=i}function j(e,r,i,n,o,a){let{aliasSymbol:c}=k(i,n);if(!c)return;const l=function(e,t,r){if(t.declarations)for(const i of t.declarations){const t=i.getSourceFile();if(t.isDeclarationFile)return;if(t===r||t.fileName===r.fileName)return;if(e.isModuleDeclaration(i))return;return S(s(t.fileName))}}(e,c,o);if(!l)return;const{factory:p}=e,u=c.getName();o.__imports||M(e,i,o);const d=o.__imports;if(d.has(l)){const e=d.get(l);if(e[u])return p.createTypeReferenceNode(e[u])}const f=function(e,t,r){let i=e.getUniqueName(t,r);r.__uniqueNames||(r.__uniqueNames=[]);let n=1;for(;r.__uniqueNames.includes(i);)i=`${t}_${n}`,n++;return r.__uniqueNames.push(i),i}(e,u,o);let y=l;const g=o.__rootDir;if(g&&l.startsWith(g)){const e=S(s(o.fileName));e.startsWith(g)&&(y=r.normalizeFileName(t.relative(t.dirname(e),l)),y=y.startsWith(".")?y:"./"+y)}const m=p.createImportDeclaration(void 0,p.createImportClause(!1,void 0,p.createNamedImports([p.createImportSpecifier(!1,f!==u?p.createIdentifier(u):void 0,p.createIdentifier(f))])),p.createStringLiteral(y),void 0);return $.enabled&&$(`import { ${u} as ${f} } from '${y}'`,"at",o.__relativeFileName),a.set(c,m),d.has(l)||d.set(l,{}),d.get(l)[u]=f,f!==u?p.createTypeReferenceNode(f):void 0}function z(e,t){return t.flags===e.TypeFlags.Null||t.flags===e.TypeFlags.Undefined}function W(e,t){return t.getNonNullableType(e)!==e}function q(e,t,r,i=!1){if(r.isStringLiteral())return function(e){G||(G=e.factory.createKeywordTypeNode(e.SyntaxKind.StringKeyword));return G}(e);if(r.isNumberLiteral())return Z(e);if(r.flags&e.TypeFlags.BooleanLiteral)return function(e){H||(H=e.factory.createKeywordTypeNode(e.SyntaxKind.BooleanKeyword));return H}(e);if(r.isUnion()){const n=t.getNonNullableType(r);if(n.isUnion()){if(i)return t.typeToTypeNode(r,void 0,void 0);const s=n.types;if(s.length){let n=s[0];for(let t=1;t<s.length;t++)if(s[t].flags!==n.flags)return s.length!==r.types.length?e.factory.createUnionTypeNode([e.factory.createKeywordTypeNode(e.SyntaxKind.AnyKeyword),Y(e)]):e.factory.createKeywordTypeNode(e.SyntaxKind.AnyKeyword);if(s.length===r.types.length)return q(e,t,n,i);{const r=q(e,t,n,i);if(r)return e.factory.createUnionTypeNode([r,Y(e)])}}}else{const r=q(e,t,n,i);if(r)return e.factory.createUnionTypeNode([r,Y(e)])}}}let B,G,V,H,J;function Q(e){return J||(J=e.factory.createKeywordTypeNode(e.SyntaxKind.AnyKeyword)),J}function X(e,t){return t.factory.createUnionTypeNode([e,Y(t)])}function Y(e){return B||(B=e.factory.createLiteralTypeNode(e.factory.createNull())),B}function Z(e){return V||(V=e.factory.createKeywordTypeNode(e.SyntaxKind.NumberKeyword)),V}function ee(e,t,r,i){if(z(e,r)&&function(e,t){return t.flags&(e.TypeFlags.Null|e.TypeFlags.Undefined)}(e,i))return!0;F(t);const n=t.getUTSJSONObjectType?.();if(n){const s=t.getNonNullableType(i);if(P(e,r)&&s===n||P(e,i)&&r===n)return!0}}const te={isRelatedTo:ee,isTypeRelatedTo:function(e,t,r,i){return ee(e,t,r,i)},useTypeAndInterfaceAsValue:!0},re=e("uts:transformer:arguments"),ie=(e,t,r)=>{const i=r.transformArguments?.shouldTransform??(()=>!0);return{before(n){const s=t.getProgram().getTypeChecker(),{factory:o}=n,a=new Map;let c;const l=t=>{const a=e.visitEachChild(t,l,n);if(e.isMethodDeclaration(a)){const t=k(s,w(e,s,a));if(t){if(!i(a,t,s))return a;const r=t.getCallSignatures();if(r&&r.length){const t=se(e,o,r,a.parameters);if(t){if(re.enabled){const r=e.getOriginalNode(a);re("method:",`${r.name.getText()}(${I(e,t)}) at ${c.__relativeFileName}`)}return o.updateMethodDeclaration(a,a.modifiers,a.asteriskToken,a.name,a.questionToken,a.typeParameters,t,a.type,a.body)}}}}else if(e.isArrowFunction(a)){const t=k(s,C(s,a));if(t.isUnion())return a;if(!i(a,t,s))return a;const r=t.getCallSignatures();if(r&&r.length){const t=se(e,o,r,a.parameters);if(t)return re.enabled&&re("arrow function:",`(${I(e,t)}) at ${c.__relativeFileName}`),o.updateArrowFunction(a,a.modifiers,a.typeParameters,t,a.type,a.equalsGreaterThanToken,a.body)}}else if(e.isFunctionExpression(a)){const t=k(s,C(s,a));if(t.isUnion())return a;if(!i(a,t,s))return a;const r=t.getCallSignatures();if(r&&r.length){const t=se(e,o,r,a.parameters);if(t)return re.enabled&&re("function expression:",`(${I(e,t)}) at ${c.__relativeFileName}`),o.updateFunctionExpression(a,a.modifiers,a.asteriskToken,a.name,a.typeParameters,t,a.type,a.body)}}else if(("Kotlin"===r.targetLanguage||"Swift"===r.targetLanguage)&&e.isCallExpression(a)&&0===a.arguments.length){const t=k(s,C(s,a.expression)).getCallSignatures();if(t&&1===t.length){const r=t[0].parameters;if(1===r.length){if(ne(s.getTypeOfSymbol(r[0]),e))return o.updateCallExpression(a,a.expression,a.typeArguments,o.createNodeArray([o.createVoidExpression(o.createNumericLiteral(0))]))}}}return a};return t=>{c=t;const r=e.visitNode(t,l);return 0===a.size?r:o.updateSourceFile(r,[...a.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function ne(e,t){return!!(e.flags&t.TypeFlags.Void)||e.isUnion()&&e.types.some((e=>ne(e,t)))}function se(e,t,r,i){let n;const s=i.length;for(const e of r){if(e.parameters.length===s)return;e.parameters.length>s&&(!n||e.parameters.length<n.parameters.length)&&(n=e)}if(!n)return;const o=[];for(const t of n.parameters){if(!t.valueDeclaration)return;if(!e.isParameter(t.valueDeclaration))return;if(t.valueDeclaration.questionToken||t.valueDeclaration.dotDotDotToken)break;o.push(t)}const a=o.length-s;if(a<=0)return;const c=[];for(let e=0;e<a;e++)c.push(t.createParameterDeclaration(void 0,void 0,t.createIdentifier(`_${n.parameters[e+s].name}`),void 0,void 0,void 0));return t.createNodeArray([...i,...c])}function oe(e,t,r,i,n,s,o){let a=` https://doc.dcloud.net.cn/uni-app-x/uts/uts_diff_ts.html#UTS${n}`;return{file:i,start:r.pos,length:r.end-r.pos,messageText:t+(s?a:"")+(o?`\n建议: ${o}`:""),category:e.DiagnosticCategory.Error,code:n}}function ae(e,t,r,i){!function(e,t,r){if(e.isIdentifier(t)&&"undefined"===t.text){const i={pos:t.getStart(),end:t.getEnd()},{message:n,code:s}=l.Undefined_is_not_supported;r.addSemanticDiagnostic(oe(e,n,i,t.getSourceFile(),s,!0,""))}}(e,t,r),function(e,t,r){if(e.isPropertyDeclaration(t)&&e.isPrivateIdentifier(t.name)&&t.getText().startsWith("#")&&t.parent&&e.isClassDeclaration(t.parent)){const i={pos:t.getStart(),end:t.getEnd()},{message:n,code:s}=l.Private_fields_starting_with_are_not_supported;r.addSemanticDiagnostic(oe(e,n,i,t.getSourceFile(),s,!0,""))}}(e,t,r),function(e,t,r){if(e.isPropertySignature(t)&&t.type&&e.isFunctionTypeNode(t.type)&&t.type.typeParameters&&t.type.typeParameters.length>0){const i=t.parent;e.isTypeLiteralNode(i)&&i.parent&&e.isTypeAliasDeclaration(i.parent)&&ce(e,t.type.typeParameters,r,t.getSourceFile())}if(e.isPropertySignature(t)&&t.type&&e.isFunctionTypeNode(t.type)&&t.type.typeParameters&&t.type.typeParameters.length>0){const i=t.parent;e.isInterfaceDeclaration(i)&&ce(e,t.type.typeParameters,r,t.getSourceFile())}if(e.isPropertyDeclaration(t)&&t.type&&e.isFunctionTypeNode(t.type)&&t.type.typeParameters&&t.type.typeParameters.length>0){const i=t.parent;e.isClassDeclaration(i)&&ce(e,t.type.typeParameters,r,t.getSourceFile())}}(e,t,r),function(e,t,r){if(e.isTypePredicateNode(t)&&t.type&&t.kind===e.SyntaxKind.TypePredicate){const i=t.getChildren().find((t=>t.kind===e.SyntaxKind.IsKeyword));if(i){const{code:t,message:n}=l.Type_protection_using_instanceof_and_as,s={pos:i.getStart(),end:i.getEnd()};r.addSyntacticDiagnostic(oe(e,n,s,i.getSourceFile(),t,!0,""))}}}(e,t,r),function(e,t,r){const{message:i,code:n}=l.Generator_functions_are_not_supported;if((e.isFunctionDeclaration(t)||e.isFunctionExpression(t)||e.isMethodDeclaration(t))&&t.asteriskToken&&t.asteriskToken.kind===e.SyntaxKind.AsteriskToken){const s={pos:t.asteriskToken.getStart(),end:t.asteriskToken.getEnd()};r.addSyntacticDiagnostic(oe(e,i,s,t.getSourceFile(),n,!0,""))}}(e,t,r),function(e,t,r){if(e.isDeleteExpression(t)){const i=t.getChildren().find((t=>t.kind===e.SyntaxKind.DeleteKeyword));if(i){const{message:t,code:n}=l.Delete_operator_is_not_supported;r.addSyntacticDiagnostic(oe(e,t,{pos:i.getStart(),end:i.getEnd()},i.getSourceFile(),n,!0,""))}}}(e,t,r)}function ce(e,t,r,i){const n=t[0],s=t[t.length-1],o={pos:n.getStart(),end:s.getEnd()},{message:a,code:c}=l.Property_methods_for_type_class_or_interface_do_not_support_defining_generic_information;r.addSemanticDiagnostic(oe(e,a,o,i,c,!0,""))}function le(e,t,r,i){const n=i.getProgram();if(!n)return;const s=n.getTypeChecker();let o=null;switch(t.kind){case e.SyntaxKind.IfStatement:case e.SyntaxKind.WhileStatement:o=t.expression;break;case e.SyntaxKind.ConditionalExpression:o=t.condition}o&&function(e,t,r,i){try{const n=t.kind;if(![e.SyntaxKind.PrefixUnaryExpression].includes(n))return;if(n===e.SyntaxKind.PrefixUnaryExpression){const n=t,s=n.operand,o=r.getTypeAtLocation(s);if(n.operator===e.SyntaxKind.ExclamationToken&&!pe(e,o,r)){const n=t.getSourceFile(),{code:a,message:c}=l.Conditional_statements_must_use_boolean_types;return void i.addSemanticDiagnostic(oe(e,`${c}`,{pos:t.getStart(),end:t.getEnd()},n,a,!0,function(e,t){const r=e.startsWith("!"),i=r?e.substring(1):e;switch(t){case"number":return r?`${i} == 0 或 ${i} <= 0`:`${e} != 0 或 ${e} > 0`;case"string":case'""':return r?`${i} == '' 或 ${i}.length == 0`:`${e} != '' 或 ${e}.length > 0`;case"null":return r?`${i} == null`:`${e} != null`;default:return t.includes("null")||t.includes("object")?r?`${i} == null`:`${e} != null`:t.includes("array")||t.includes("[]")?r?`${i}.length == 0`:`${e}.length > 0`:""}}(s.getText(),r.typeToString(o))))}}}catch(e){console.warn(`类型检查失败: ${e}`)}}(e,o,s,r),function(e,t,r,i){if(e.isBinaryExpression(t)&&t.operatorToken.kind===e.SyntaxKind.BarBarToken){const n=r.getTypeAtLocation(t.left),s=r.getTypeAtLocation(t.right);if(!pe(e,n,r)||!pe(e,s,r)){const r=t.getSourceFile(),{code:n,message:s}=l.Conditional_statements_must_use_boolean_types;i.addSemanticDiagnostic(oe(e,`${s}`,{pos:t.getStart(),end:t.getEnd()},r,n,!0,""))}}}(e,t,s,r)}function pe(e,t,r){const i=r.typeToString(t).toLocaleLowerCase();if("string"!==i&&"number"!==i&&"object"!==i&&'""'!==i)return!0;if(t.flags&e.TypeFlags.Boolean)return!0;if(t.flags&e.TypeFlags.BooleanLiteral)return!0;if("Boolean"===r.typeToString(t))return!0;if(t.flags&e.TypeFlags.Union){return t.types.every((t=>pe(e,t,r)))}return!1}function ue(e,t,r,i){const n=i.getProgram();if(!n)return;const s=n.getTypeChecker();e.isIdentifier(t)&&function(e,t,r,i){const n=t.parent;if(!n)return;const s=function(e,t,r){if(e.isPropertyAssignment(r)&&r.initializer===t)return!0;if(e.isBinaryExpression(r)&&r.operatorToken.kind===e.SyntaxKind.EqualsToken&&r.right===t)return!0;if(e.isVariableDeclaration(r)&&r.initializer===t)return!0;if(e.isCallExpression(r)){if(r.arguments.includes(t))return!0}if(e.isConditionalExpression(r)&&(r.whenTrue===t||r.whenFalse===t))return!0;return!1}(e,t,n);if(!s)return;if(e.isPropertyAssignment(n)&&n.initializer===t&&e.isIdentifier(n.name)&&"class"===n.name.text)return;if(function(e,t,r){const i=r.getSymbolAtLocation(t);if(!i)return!1;if(i.flags&e.SymbolFlags.Class)return!0;if(i.flags&e.SymbolFlags.Alias){const t=r.getAliasedSymbol(i);if(t&&t.flags&e.SymbolFlags.Class)return!0}return!1}(e,t,i)){const i={pos:t.getStart(),end:t.getEnd()};if(e.isCallExpression(n))return;if(function(e,t){let r=t.parent,i=0;for(;r&&i<5;){if(e.isPropertyAssignment(r)){const t=r.name;if(e.isIdentifier(t)&&"props"===t.text)return!0}r=r.parent,i++}return!1}(e,t))return;const{message:s,code:o}=l.Class_cannot_be_used_as_a_value;r.addSemanticDiagnostic(oe(e,s,i,t.getSourceFile(),o,!0,""))}}(e,t,r,s)}function de(e,t,r,i){if(e.isExpressionStatement(t)){const n=t.expression;if(e.isBinaryExpression(n)&&n.operatorToken.kind===e.SyntaxKind.EqualsToken){const t=n.left;if(e.isPropertyAccessExpression(t)){const n=t.expression;if(e.isIdentifier(n)&&"uni"===n.text){const n=i.getProgram();if(n){const i=n.getTypeChecker().getSymbolAtLocation(t);i?.flags&&fe(i?.getFlags(),e)&&ye(e,r,{pos:t.getStart(),end:t.getEnd()},t)}}}if(e.isPropertyAccessExpression(t)){const n=i.getProgram();if(n){const i=n.getTypeChecker(),s=t.expression;if(e.isIdentifier(s)){const n=i.getSymbolAtLocation(s);n&&n.flags&e.SymbolFlags.Function&&function(e,t,r,i){const n=l.Declaring_properties_on_functions_is_not_supported;t.addSemanticDiagnostic(oe(e,n.message,r,i.getSourceFile(),n.code,!0,""))}(e,r,{pos:t.getStart(),end:t.getEnd()},t)}}}}}if(e.isVariableStatement(t)){t.declarationList.declarations.forEach((t=>{if(t.initializer&&e.isPropertyAccessExpression(t.initializer)){const n=t.initializer,s=n.expression;if(e.isIdentifier(s)&&"uni"===s.text){const t=i.getProgram();if(t){const i=t.getTypeChecker().getSymbolAtLocation(n);i?.flags&&fe(i?.getFlags(),e)&&ye(e,r,{pos:n.getStart(),end:n.getEnd()},n)}}}}))}}function fe(e,t){return e===t.SymbolFlags.Function||e===t.SymbolFlags.Method}function ye(e,t,r,i){const{code:n,message:s}=l.Methods_to_modify_objects_are_not_supported;t.addSemanticDiagnostic(oe(e,s,r,i.getSourceFile(),n,!0,""))}function ge(e,t,r,i,n,s){const a=i.getProgram();if(!a)return;const c=a.getTypeChecker();if(!c)return;const p=a.getCompilerOptions().rootDir;if(!p)return;if(t.parent&&e.isReturnStatement(t.parent)&&e.isObjectLiteralExpression(t)&&function(e,t,r,i,n){const s=e.findAncestor(t.parent,e.isFunctionLike);if(s&&s.type){const a=s.type;if(a.kind===e.SyntaxKind.TypeReference){const s=a.typeName;if(e.isIdentifier(s)){const c=i.getTypeAtLocation(s).getSymbol();c&&c.flags&e.SymbolFlags.Interface&&c.declarations?.length&&o(c.declarations[0],n)&&me({pos:a.getStart(),end:a.getEnd()},t,e,r)}}}}(e,t,r,c,p),!e.isTypeReferenceNode(t))return;const u=t.typeName;if(!e.isIdentifier(u))return;const d=t.parent,f=c.getSymbolAtLocation(u);if(f&&f.flags&e.SymbolFlags.Interface&&(!f.declarations?.length||o(f.declarations[0],p))){if(e.isAsExpression(d)&&e.isObjectLiteralExpression(d.expression)&&e.isTypeReferenceNode(d.type)&&e.isIdentifier(d.type.typeName)){if(d.type.typeName.text===u.text)return void me({pos:d.getStart(),end:d.getEnd()},t,e,r)}if(d&&e.isVariableDeclaration(d)&&d.type===t){if(d.initializer&&e.isObjectLiteralExpression(d.initializer)){me({pos:d.initializer.getStart(),end:d.initializer.getEnd()},t,e,r)}if(d.initializer&&(e.isArrowFunction(d.initializer)||e.isMethodDeclaration(d.initializer)||e.isFunctionDeclaration(d.initializer)||e.isFunctionExpression(d.initializer)||e.isConstructorDeclaration(d.initializer))){const i={pos:d.initializer.getStart(),end:d.initializer.getEnd()};r.addSemanticDiagnostic(oe(e,l.You_cannot_assign_a_function_to_an_interface.message,i,t.getSourceFile(),l.You_cannot_assign_a_function_to_an_interface.code,!1,""))}}}}function me(e,t,r,i){const{message:n,code:s}=l.Object_literals_only_support_object_types_defined_by_construction_type_and_do_not_support_interfaces;i.addSemanticDiagnostic(oe(r,n,e,t.getSourceFile(),s,!0,""))}const Te=e("uts:transformer:checker"),_e=(e,t,r)=>({before(i){Te.enabled&&Te(r.hxPluginDir);const n=s=>{const o=e.visitEachChild(s,n,i);return o&&o.flags===e.NodeFlags.Synthesized||(function(e,t,r){if(e.isTypeLiteralNode(t)){const i=t.parent;if(i&&(e.isTypeAliasDeclaration(i)||e.isInterfaceDeclaration(i)||e.isTypeLiteralNode(i)||e.isTypeAssertionExpression(i)))return;if(function(e,t){let r=t.parent,i=0;for(;r&&i<5;){if(e.isTypeReferenceNode(r)){const t=r.typeName;if(e.isIdentifier(t)&&"SlotsType"===t.text)return!0}r=r.parent,i++}return!1}(e,t))return;if(e.isCallExpression(i)&&e.isIdentifier(i.expression)&&"defineProps"===i.expression.text)return;const n={pos:t.getStart(),end:t.getEnd()};r.addSemanticDiagnostic(oe(e,l.Direct_declaration_of_Object_Literal_Type_is_not_supported.message,n,t.getSourceFile(),l.Direct_declaration_of_Object_Literal_Type_is_not_supported.code,!0,""))}else if(e.isVariableDeclaration(t)&&t.parent&&e.isVariableDeclarationList(t.parent)){const i=t.type;if(i&&e.isTypeLiteralNode(i)){const i={pos:t.pos+1,end:t.end};r.addSemanticDiagnostic(oe(e,l.Direct_declaration_of_Object_Literal_Type_is_not_supported.message,i,t.getSourceFile(),l.Direct_declaration_of_Object_Literal_Type_is_not_supported.code,!0,""))}}}(e,o,i),ge(e,o,i,t,r.hxPluginDir,r.utsLibDir),function(e,t,r){if(e.isTypeAliasDeclaration(t)&&!e.isBlockScopedContainerTopLevel(t.parent)&&t.type.kind!==e.SyntaxKind.TypeLiteral){const i={pos:t.getStart(),end:t.getEnd()},{message:n,code:s}=l.Type_aliases_cannot_appear_in_local_scope;r.addSemanticDiagnostic(oe(e,n,i,t.getSourceFile(),s,!0,""))}}(e,o,i),le(e,o,i,t),ue(e,o,i,t),de(e,o,i,t),ae(e,o,i)),o};return t=>e.visitNode(t,n)}}),he=(e,r,i)=>{function n(n,o){if(e.isSourceFile(o)){if(F(r.getProgram()?.getTypeChecker()),!o.__relativeFileName){const e=n.getCompilerOptions();if(e.rootDir&&t.isAbsolute(e.rootDir)){const r=s(e.rootDir),i=s(o.fileName);o.__rootDir=r,i.startsWith(r)?o.__relativeFileName=s(t.relative(r,i)):i.includes("/@dcloudio/")&&(o.__relativeFileName="@dcloudio/"+i.split("/@dcloudio/")[1])}o.__relativeFileName||(o.__relativeFileName=t.basename(o.fileName))}if(!n.printNode){const t=e.createPrinter();n.printNode=(r,i)=>t.printNode(e.EmitHint.Unspecified,r,i)}n.addSyntacticDiagnostic||(n.addSyntacticDiagnostic=e=>{o.parseDiagnostics.push(e)},n.addSemanticDiagnostic=e=>{o.bindDiagnostics.push(e)}),n.error||(n.error=e=>{if(i.watch)return e.__throwError=!0,void n.addSyntacticDiagnostic(e);const t=new Error(e.messageText.toString());throw t.diagnostic=e,Object.defineProperty(t,"id",{get:()=>e.file.fileName,set(e){}}),t})}return o}return{before:e=>t=>n(e,t),after:e=>t=>n(e,t),afterDeclarations:e=>t=>n(e,t)}},xe=e("uts:transformer:generics"),Se=(e,t,r)=>{const i=r.transformGenericsParameterDefaults?.shouldTransform??(()=>!0);return{before(r){const n=t.getProgram().getTypeChecker(),{factory:s}=r,o=new Map;let a;const c=l=>{const p=e.visitEachChild(l,c,r);if(e.isTypeReferenceNode(p)){const c=n.getTypeAtLocation(p),l=c.aliasSymbol;if(l&&l.flags&e.SymbolFlags.TypeAlias&&!c.aliasTypeArguments)return p;if(c.resolvedTypeArguments||c.mapper||c.aliasTypeArguments){if(!i(p,c,n,r))return p;const l=Ne(p,c.resolvedTypeArguments||function(e){if(!e)return;if(0===e.kind)return[e.target];if(1===e.kind)return e.targets;if(2===e.kind)return e.targets.map((e=>e()))}(c.mapper)||c.aliasTypeArguments,e,n);if(l){if(l.newTypes.forEach((r=>j(e,t,n,r,a,o))),xe.enabled){const t=e.getOriginalNode(p);xe(t.getText(),`${n.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return s.updateTypeReferenceNode(p,p.typeName,l.newTypeArguments)}}}else if(e.isExpressionWithTypeArguments(p)){const c=n.getTypeFromTypeNode(p);if(function(e,t){return!!(function(e,t){return e.flags&t.TypeFlags.Object?e.objectFlags:0}(e,t)&t.ObjectFlags.Reference)}(c,e)&&c.resolvedTypeArguments?.length){if(!i(p,c,n,r))return p;const l=Ne(p,c.resolvedTypeArguments,e,n);if(l){if(l.newTypes.forEach((r=>j(e,t,n,r,a,o))),xe.enabled){const t=e.getOriginalNode(p);xe(t.getText(),`${n.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return s.updateExpressionWithTypeArguments(p,p.expression,l.newTypeArguments)}}}else if(e.isNewExpression(p)){const c=n.getTypeAtLocation(p),l=c.resolvedTypeArguments;if(Array.isArray(l)&&l.length){if(!i(p,c,n,r))return p;const u=Ne(p,l,e,n);if(u){if(u.newTypes.forEach((r=>j(e,t,n,r,a,o))),xe.enabled){const t=e.getOriginalNode(p);xe(t.getText(),`${n.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return s.updateNewExpression(p,p.expression,u.newTypeArguments,p.arguments)}}}else e.isCallExpression(p);return p};return t=>{a=t;const r=e.visitNode(t,c);return 0===o.size?r:s.updateSourceFile(r,[...o.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function Ne(e,t,r,i){const n=e.typeArguments?.length??0;if(t.length===n)return;const s=e.typeArguments??[],o=t.slice(s.length);return{newTypeArguments:r.factory.createNodeArray([...s,...o.map((t=>K(t,e,r,i)))]),newTypes:o}}const be=e("uts:transformer:in"),Ee=(e,t,r)=>({before(i){const n=t.getProgram().getTypeChecker(),{factory:s}=i,o=t=>{const a=e.visitEachChild(t,o,i);if(e.isBinaryExpression(a)&&a.operatorToken.kind===e.SyntaxKind.InKeyword){if(be.enabled){const t=e.getOriginalNode(a);be("transformIn",t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}const t=[];if("ArkTS"===r.targetLanguage){const r=n.getTypeAtLocation(a.left);if(r.isStringLiteral()||r.isNumberLiteral()){const i=n.getNonNullableType(n.getTypeAtLocation(a.right));if(i.isUnion()){const s=n.narrowTypeByInKeyword(i,r,!0);if(s!==i){const r=K(s,a,e,n);r&&t.push(r)}}}}return s.createCallExpression(s.createIdentifier("resolveInOperator"),t,[a.right,a.left])}return a};return t=>e.visitNode(t,o)}}),ve=e("uts:transformer:keyof"),Fe=(e,t,r)=>{const i=r.transformKeyof?.shouldTransform??(()=>!0);return{before(r){const n=t.getProgram().getTypeChecker(),{factory:s}=r,o=t=>{const a=e.visitEachChild(t,o,r);if(e.isTypeOperatorNode(a)&&a.operator===e.SyntaxKind.KeyOfKeyword){const t=n.getTypeAtLocation(a);if(!i(a,t,n,r))return a;if(t.isUnion()){const r=t.types.map((e=>e.isStringLiteral()||e.isNumberLiteral()?e.value:void 0)).filter((e=>void 0!==e));if(ve.enabled){const r=e.getOriginalNode(a);ve(r.getText(),`${n.typeToString(t)} at ${r.getSourceFile().__relativeFileName}`)}return s.createUnionTypeNode(r.map((e=>s.createLiteralTypeNode("string"==typeof e?s.createStringLiteral(e):s.createNumericLiteral(e)))))}if(t.isStringLiteral()){if(ve.enabled){const r=e.getOriginalNode(a);ve(r.getText(),`${n.typeToString(t)} at ${r.getSourceFile().__relativeFileName}`)}return s.createLiteralTypeNode(s.createStringLiteral(t.value))}if(t.isNumberLiteral()){if(ve.enabled){const r=e.getOriginalNode(a);ve(r.getText(),`${n.typeToString(t)} at ${r.getSourceFile().__relativeFileName}`)}return s.createLiteralTypeNode(s.createNumericLiteral(t.value))}}return a};return t=>e.visitNode(t,o)}}};function De(e,t,r){const i=r.getNonNullableType(e);return!!i.isUnion()&&(!(i.types.length<=1)&&i.types.every((e=>L(e,t))))}function Ae(e,t,r){const i=r.getNonNullableType(e);if(!i.isUnion())return;if(i.types.length<=1)return;if(!i.types.every((e=>e.flags&t.TypeFlags.Object&&void 0!==e.aliasSymbol)))return;const n=i.types[0],s=r.getPropertiesOfType(n);for(const e of s){let n,s=!0;for(const o of i.types){const i=r.getPropertyOfType(o,e.escapedName);if(!i){s=!1;break}const a=r.getTypeOfSymbol(i);if(Ce(a,t))n="string";else{if(!ke(a,t)){s=!1;break}n="number"}}if(s&&n)return{name:e.name,type:n}}}function Ce(e,t){return!!(e.flags&t.TypeFlags.StringLiteral)||!!e.isUnion()&&e.types.every((e=>Ce(e,t)))}function ke(e,t){return!!(e.flags&t.TypeFlags.NumberLiteral)||!!e.isUnion()&&e.types.every((e=>ke(e,t)))}const Pe=e("uts:transformer:narrowType:discriminatedUnion"),Le=(e,t,r)=>({before(i){const n=t.getProgram().getTypeChecker(),{factory:s}=i,o=t=>{const a=e.visitEachChild(t,o,i);if(e.isTypeAliasDeclaration(a)&&e.isUnionTypeNode(a.type)){if(a.type.types.every((t=>e.isTypeReferenceNode(t)))){const t=n.getTypeAtLocation(a.type);if(t.isUnion()){if(Ae(t,e,n)){if(Pe.enabled){const t=e.getOriginalNode(a);Pe(`type ${t.name.getText()} = UTSUnionTypeObject`,` at ${t.getSourceFile().__relativeFileName}`)}return s.updateTypeAliasDeclaration(a,a.modifiers,a.name,a.typeParameters,s.createTypeReferenceNode(s.createIdentifier("UTSUnionTypeObject"),void 0))}}}}else if(e.isPropertyAccessExpression(t)&&e.isIdentifier(t.expression)){const i=n.getTypeAtLocation(t.name);if(i.isUnion()){const o=n.getNonNullableType(i);if(o.isUnion()&&o.types.every((e=>e.isStringLiteral()||e.isNumberLiteral()))){const i=n.getTypeAtLocation(t.expression);if(i.isUnion()){const o=Ae(i,e,n);if(o&&o.name===t.name.text){const i=[t.expression,s.createStringLiteral(t.name.text)];"Swift"===r.targetLanguage&&i.push(s.createPropertyAccessExpression(s.createIdentifier("String"),s.createIdentifier("self")));const n="Swift"===r.targetLanguage?void 0:[s.createKeywordTypeNode("string"===o.type?e.SyntaxKind.StringKeyword:e.SyntaxKind.NumberKeyword)];return s.createCallExpression(s.createIdentifier("resolveUTSObjectProperty"),n,i)}}}}}return a};return t=>e.visitNode(t,o)}}),we=e("uts:transformer:narrowType:nonNullable");function Oe(e,t){const r=e.parent;return!!r&&(!!t.isExpression(e)&&(!t.isNonNullExpression(r)&&(!t.isAsExpression(r)&&((!t.isBinaryExpression(r)||r.operatorToken.kind!==t.SyntaxKind.InstanceOfKeyword||r.left!==e&&r.right!==e)&&((!t.isTypeOfExpression(r)||r.expression!==e)&&((!t.isPropertyAccessExpression(r)||r.name!==e)&&((!t.isPropertyAccessChain(r)||r.name!==e)&&(!(t.isFunctionDeclaration(e)||t.isArrowFunction(e)||t.isFunctionExpression(e)||t.isClassDeclaration(e)||t.isInterfaceDeclaration(e)||t.isTypeAliasDeclaration(e)||t.isTypeLiteralNode(e)||t.isTypeOfExpression(e))&&(!(t.isTypeAliasDeclaration(r)||t.isInterfaceDeclaration(r)||t.isPropertySignature(r)||t.isMethodSignature(r)||t.isFunctionDeclaration(r)||t.isTypeOfExpression(r))&&((!t.isParameter(r)||r.name!==e)&&((!t.isVariableDeclaration(r)||r.name!==e)&&((!t.isPropertyAssignment(r)||r.name!==e)&&((!t.isBinaryExpression(r)||r.left!==e||r.operatorToken.kind!==t.SyntaxKind.EqualsToken)&&(!!(t.isIdentifier(e)||t.isPropertyAccessExpression(e)||t.isElementAccessExpression(e)||t.isNonNullExpression(e)||t.isParenthesizedExpression(e)||t.isPropertyAccessChain(e)||t.isElementAccessChain(e)||t.isCallExpression(e))&&Ie(e,t)))))))))))))))}function Ie(e,t){return Ue(e,t)||(t.isPropertyAccessExpression(e)||t.isNonNullExpression(e)||t.isParenthesizedExpression(e))&&Ie(e.expression,t)||t.isBinaryExpression(e)&&e.operatorToken.kind===t.SyntaxKind.CommaToken&&Ie(e.right,t)||t.isElementAccessExpression(e)&&(t.isStringLiteral(e.argumentExpression)||t.isNumericLiteral(e.argumentExpression))&&Ie(e.expression,t)||function(e,t){return t.isBinaryExpression(e)&&function(e,t){return e>=t.SyntaxKind.FirstAssignment&&e<=t.SyntaxKind.LastAssignment}(e.operatorToken.kind,t)&&t.isLeftHandSideExpression(e.left)}(e,t)&&Ie(e.left,t)}function Ue(e,t){return e.kind===t.SyntaxKind.Identifier||e.kind===t.SyntaxKind.ThisKeyword||e.kind===t.SyntaxKind.SuperKeyword||e.kind===t.SyntaxKind.MetaProperty||e.kind===t.SyntaxKind.PropertyAccessExpression&&Ue(e.expression,t)||e.kind===t.SyntaxKind.ParenthesizedExpression&&Ue(e.expression,t)}function Ke(e,t,r,i){let n=i.getSymbolAtLocation(e);if(!n&&r.isNonNullExpression(e)&&(n=i.getSymbolAtLocation(e.expression)),n){const s=i.getTypeOfSymbol(n),o=i.getTypeAtLocation(e);if(o===s)return;const a=i.getNonNullableType(s),c=i.getNonNullableType(o),l=i.getAnyType();if(l===c)return;const p=a===c&&a!==s&&c===o&&t(e,i);if(r.isExpression(e)){const t=i.getContextualType(e);if(t){if(t.flags===r.TypeFlags.Unknown)return;const e=i.getNonNullableType(t);if(l===e)return;if(p&&e===a&&e!==t)return}}if(p||a!==c&&function(e,t,r){if(O(e,t,r))return!1;if(e=r.getNonNullableType(e),e===r.getAnyType())return!0;if(e.isUnion()&&Re(e,t))return!0;return!1}(s,r,i)){if(c.isLiteral()&&i.getApparentType(c)===i.getApparentType(a))return;if(p&&we.enabled){const t=r.getOriginalNode(e);we(t.getText(),`as ${i.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return{narrowedType:c,isNarrowNonNullable:p}}}}function Re(e,t){const r=e.types.filter((e=>!z(t,e)&&(!e.symbol||"UTSObjectMarker"!==e.symbol.escapedName))),i=r.length;if(i<=1)return!1;const n=r[0];if(n.isLiteral()||n.flags===t.TypeFlags.BooleanLiteral){const e=n.flags;for(let t=1;t<i;t++)if(r[t].flags!==e)return!0;return!1}return!0}const $e=e("uts:transformer:narrowType"),Me=(e,t,r)=>{const i=r.transformNarrowType?.shouldTransformNonNullable??(()=>!1);return{before(n){const s=t.getProgram().getTypeChecker(),{factory:o}=n,a=new Map;let c;const l=p=>{const u=e.visitEachChild(p,l,n);if(Oe(p,e)){const l=Ke(p,i,e,s);if(l){const{narrowedType:i,isNarrowNonNullable:d}=l;if(d&&"Swift"===r.targetLanguage&&!function(e,t,r,i){let n=e.parent;if(n&&r.isConditionalExpression(n)){let e,s;for(n=n.parent;n;){if(r.isVariableDeclaration(n)&&r.isIdentifier(n.name)){if(e=i.getSymbolAtLocation(n.name),e)for(n=n.parent;n;){if(r.isVariableStatement(n)){s=n.parent;break}n=n.parent}break}n=n.parent}if(e&&s){let n=!1;const o=s=>!n&&r.isNonNullExpression(s)&&r.isIdentifier(s.expression)&&i.getSymbolAtLocation(s.expression)===e?(n=!0,s):r.visitEachChild(s,o,t);if(r.visitEachChild(s,o,t),n)return!1}}return!0}(p,n,e,s))return u;if(d&&e.isExpression(u)&&"Swift"!==r.targetLanguage)return o.createNonNullExpression(u);const f=function(e,t,r,i){const n=q(r,i,t);return n||(D(r,i,t)?K(t,e,r,i):void 0)}(p,i,e,s);if(f){if(j(e,t,s,i,c,a),$e.enabled){const t=e.getOriginalNode(p);$e(t.getText(),`as ${s.typeToString(i)} at ${t.getSourceFile().__relativeFileName}`)}return o.createAsExpression(u,f)}}}return u};return t=>{c=t;const r=e.visitNode(t,l);return 0===a.size?r:o.updateSourceFile(r,[...a.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};const je=e("uts:transformer:narrowType:parameterUnionType"),ze=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isFunctionDeclaration(t)){const r=We("modifier",t.parameters,e,i);if(r){if(je.enabled){const r=e.getOriginalNode(t);je(`function ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return n.updateFunctionDeclaration(t,t.modifiers,t.asteriskToken,t.name,t.typeParameters,r,t.type,t.body)}}else if(e.isMethodDeclaration(t)){const r=We("modifier",t.parameters,e,i);if(r){if(je.enabled){const r=e.getOriginalNode(t);je(`method ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return n.updateMethodDeclaration(t,t.modifiers,t.asteriskToken,t.name,t.questionToken,t.typeParameters,r,t.type,t.body)}}else if(e.isConstructorDeclaration(t)){const r=We("modifier",t.parameters,e,i);if(r){if(je.enabled){const r=e.getOriginalNode(t);je(`constructor ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return n.updateConstructorDeclaration(t,t.modifiers,r,t.body)}}else if(e.isMethodSignature(t)){const r=We("type",t.parameters,e,i);if(r){if(je.enabled){const r=e.getOriginalNode(t);je(`method signature ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return n.updateMethodSignature(t,t.modifiers,t.name,t.questionToken,t.typeParameters,r,t.type)}}else if(e.isFunctionTypeNode(t)){const r=We("type",t.parameters,e,i);if(r){if(je.enabled){const r=e.getOriginalNode(t);je(`function type ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return n.updateFunctionTypeNode(t,t.typeParameters,r,t.type)}}else if(e.isArrowFunction(t)){const r=We("type",t.parameters,e,i);if(r){if(je.enabled){const r=e.getOriginalNode(t);je(`arrow function ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return n.updateArrowFunction(t,t.modifiers,t.typeParameters,r,t.type,t.equalsGreaterThanToken,t.body)}}else if(e.isFunctionExpression(t)){const r=We("type",t.parameters,e,i);if(r){if(je.enabled){const r=e.getOriginalNode(t);je(`function expression ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return n.updateFunctionExpression(t,t.modifiers,t.asteriskToken,t.name,t.typeParameters,r,t.type,t.body)}}return o};return t=>e.visitNode(t,s)}});function We(e,t,r,i){const{factory:n}=r,s=new Map;if(t.forEach(((t,o)=>{if(t.type){const a=i.getTypeAtLocation(t.type);if(a.isUnion()&&Re(a,r)){let c=!1;const l=e=>{r.isTypeReferenceNode(e)?c=!0:r.forEachChild(e,l)};if(l(t.type),c){if(Ae(a,r,i)){if("modifier"===e)s.set(o,{addModifier:!0});else{const e=n.createTypeReferenceNode("UTSUnionTypeObject",[]);s.set(o,{addModifier:!1,type:W(a,i)?X(e,r):e})}return}const c=function(e,t,r,i){const n=[];for(const s of e){const e=K(s,i,t,r);if(!e)return;if(t.isTypeLiteralNode(e))return;n.push(e)}return t.factory.createUnionTypeNode(n)}(a.types,r,i,t);if(c)if("modifier"===e)s.set(o,{type:c,addModifier:De(a,r,i)});else if(De(a,r,i)){const e=n.createTypeReferenceNode("UTSUnionTypeObject",[]);s.set(o,{addModifier:!1,type:W(a,i)?X(e,r):e})}}}}})),s.size>0){const e=[];return t.forEach(((t,r)=>{if(s.has(r)){const{type:i,addModifier:o}=s.get(r),a=[];o&&a.push(n.createDecorator(n.createIdentifier("UTSUnionTypeObject"))),e.push(n.updateParameterDeclaration(t,a.length>0?[...t.modifiers??[],...a]:t.modifiers,t.dotDotDotToken,t.name,t.questionToken,i??t.type,t.initializer))}else e.push(t)})),n.createNodeArray(e)}}const qe=e("uts:transformer:UTSObjectUnionType"),Be=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isUnionTypeNode(o)){if(o.parent&&e.isParameter(o.parent))return o;const t=i.getTypeAtLocation(o);if(t.isUnion()&&De(t,e,i)){const t=o.types.some((t=>e.isLiteralTypeNode(t)&&t.literal.kind===e.SyntaxKind.NullKeyword));if(qe.enabled){const t=e.getOriginalNode(o);qe(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return t?n.createUnionTypeNode([n.createTypeReferenceNode("UTSUnionTypeObject"),n.createLiteralTypeNode(n.createNull())]):n.createTypeReferenceNode("UTSUnionTypeObject")}}return o};return t=>e.visitNode(t,s)}}),Ge=e=>({parser:{SourceFile(t){const r=t=>{t.forEachChild(r);t.parent&&e.isBinaryExpression(t)&&(t.left.kind!==e.SyntaxKind.NullKeyword&&t.right.kind!==e.SyntaxKind.NullKeyword||(t.operatorToken.kind===e.SyntaxKind.EqualsEqualsEqualsToken?t.operatorToken.kind=e.SyntaxKind.EqualsEqualsToken:t.operatorToken.kind===e.SyntaxKind.ExclamationEqualsEqualsToken&&(t.operatorToken.kind=e.SyntaxKind.ExclamationEqualsToken)))};return e=>(e.forEachChild(r),e)}}});function Ve(e,t){return e.isObjectLiteralExpression(t)||e.isArrayLiteralExpression(t)||e.isAsExpression(t)||e.isPropertyAssignment(t)}function He(e){return"UTSJSONObject"===e.symbol?.name||e.isUnionOrIntersection()&&e.types.some((e=>He(e)))}const Je=e("uts:transformer:objectLiteral"),Qe=(e,t,r)=>{const i=r?.transformObjectLiteral?.shouldTransformAsExpression??(()=>!0),n="ArkTS"===r.targetLanguage,s=r.isPureSwift??!1;return{parser:{SourceFile(t){const{factory:r}=t;let i;function n(t){if(Je.enabled){const{line:r,character:n}=e.getLineAndCharacterOfPosition(i,t.getEnd());Je("createAs:",`at ${i.fileName}:${r+1}:${n}`)}return r.createAsExpression(t,r.createTypeReferenceNode(r.createIdentifier("UTSJSONObject"),void 0))}function s(t){if(Je.enabled){const{line:r,character:n}=e.getLineAndCharacterOfPosition(i,t.getEnd());Je("createAsArray:",`at ${i.fileName}:${r+1}:${n}`)}return r.createAsExpression(t,r.createArrayTypeNode(r.createTypeReferenceNode(r.createIdentifier("UTSJSONObject"),void 0)))}const o=t=>{t.forEachChild(o);const i=t.parent;if(i)if(e.isObjectLiteralExpression(t))if(e.isExportAssignment(i)){const e=t.getSourceFile().fileName;(e.endsWith(".vue.ts")||e.endsWith(".uvue.ts"))&&e.includes("utssdk")&&(e.includes("app-android")||e.includes("app-ios"))||(i.expression=n(t))}else e.isVariableDeclaration(i)&&!i.type||e.isPropertyDeclaration(i)&&!i.type?i.initializer=n(t):Xe(e,i)&&(i.expression=e.isParenthesizedExpression(i)?n(t):r.createParenthesizedExpression(n(t)));else if(e.isArrayLiteralExpression(t)){t.elements.length&&t.elements.every((t=>e.isObjectLiteralExpression(t)))&&(e.isExportAssignment(i)?i.expression=s(t):e.isVariableDeclaration(i)&&!i.type||e.isPropertyDeclaration(i)&&!i.type?i.initializer=s(t):Xe(e,i)&&(i.expression=e.isParenthesizedExpression(i)?s(t):r.createParenthesizedExpression(s(t))))}};return e=>(i=e,e.forEachChild(o),e)}},before(r){const o=t.getProgram().getTypeChecker(),{factory:a}=r,c=new Map;let l;const p=u=>{const d=e.visitEachChild(u,p,r);if(e.isObjectLiteralExpression(d)){const f=e.getOriginalNode(d).parent;let y=!1;if(f){if(e.isAsExpression(f))return g(d);if(e.isVariableDeclaration(f)&&f.type&&(y=!0,!n))return g(d)}if(!i(d))return d;function g(e){if(!s)return e;const t=o.getContextualType(e);return t?m(e,t):e}function m(t,r){const i=r.aliasSymbol||r.symbol;if(!i)return t;if(!(i.flags&e.SymbolFlags.TypeAlias))return t;const n=i.members;if(!n||0===n.size)return t;const s=[];let o=!1;return n.forEach(((r,i)=>{const n=t.properties.find((t=>e.isPropertyAssignment(t)&&e.isIdentifier(t.name)&&t.name.text===i));n?s.push(n):(o=!0,s.push(a.createPropertyAssignment(a.createIdentifier(i.toString()),a.createNull())))})),o?a.updateObjectLiteralExpression(t,s):t}const T=C(o,d),_=function(e,t,r,i){if(r)if((r=k(t,r)).isUnion()&&i){for(const n of r.types)if(L(n,e)&&t.isTypeAssignableTo(i,n))return n}else if(L(r,e))return r}(e,o,T,o.getTypeAtLocation(d));if(_&&!y)return i(d,_)?a.createAsExpression(s?m(d,_):d,j(e,t,o,_,l,c)||a.createTypeReferenceNode(_.aliasSymbol.name)):d;if(n){const h=function(e,t){let r,i=t;for(;(r=i.parent||i.original?.parent)&&Ve(e,r);)i=r;return e.isPropertyAssignment(i)?void 0:i}(e,d);let x=!1;if(He(T))x=!0;else if(h){let S=h;e.isAsExpression(S)&&(S=S.expression);x="error"!==C(o,S).intrinsicName&&"error"!==T.intrinsicName&&o.isTypeAssignableTo(T,o.getUTSJSONObjectType())}if(x)return a.createAsExpression(d,a.createTypeReferenceNode(a.createIdentifier("UTSJSONObject"),void 0))}}return d};return t=>{l=t;const r=e.visitNode(t,p);return 0===c.size?r:a.updateSourceFile(r,[...c.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function Xe(e,t){return e.isParenthesizedExpression(t)&&t.parent?Xe(e,t.parent):e.isPropertyAccessExpression(t)}const Ye=e("uts:transformer:returnType"),Ze=(e,t,r)=>{const i=r?.transformReturnType?.shouldTransform??(()=>!0),n="ArkTS"===r.targetLanguage||"JavaScript"===r.targetLanguage;return{before(r){const s=t.getProgram().getTypeChecker(),{factory:o}=r,a=new Map;let c;const l=p=>{const u=e.visitEachChild(p,l,r);if(e.isFunctionDeclaration(u)){if(!u.type){const r=s.getSignatureFromDeclaration(u);if(r){const i=s.getReturnTypeOfSignature(r),l=tt(n,e,s,i,!1,u);if(l){if(Ye.enabled){const t=e.getOriginalNode(u);Ye("function:",`${t.name?.getText()}():${et(e,s,l,i)} at ${c.__relativeFileName}`)}return j(e,t,s,i,c,a),o.updateFunctionDeclaration(u,u.modifiers,u.asteriskToken,u.name,u.typeParameters,u.parameters,l,u.body)}}}}else if(e.isMethodDeclaration(u)){if(!u.type){const r=s.getTypeAtLocation(u).getCallSignatures()[0];if(r&&r.getReturnType().flags&e.TypeFlags.Void)return u;const l=w(e,s,u);if(l&&!i(e.getOriginalNode(u),l,s))return u;const p=k(s,l)?.getCallSignatures(),d=p&&p.length?p[0]:s.getSignatureFromDeclaration(u);if(d){const r=s.getReturnTypeOfSignature(d),i=tt(n,e,s,r,!(!p||!p.length),u);if(i){if(Ye.enabled){const t=e.getOriginalNode(u);Ye("method:",`${t.name?.getText()}():${et(e,s,i,r)} at ${c.__relativeFileName}`)}return j(e,t,s,r,c,a),o.updateMethodDeclaration(u,u.modifiers,u.asteriskToken,u.name,u.questionToken,u.typeParameters,u.parameters,i,u.body)}}}}else if(e.isArrowFunction(u)){if(!u.type){const r=s.getTypeAtLocation(u),l=r.getCallSignatures()[0];if(l&&l.getReturnType().flags&e.TypeFlags.Void)return u;const p=A(e,s,u);if(p&&!i(e.getOriginalNode(u),p,s))return u;let d=r;if(p){const e=s.getNonNullableType(p);e.getCallSignatures().length&&!e.isUnion()&&(d=p)}const f=k(s,d)?.getCallSignatures();if(f&&f.length){const r=f[0].getReturnType();let i=!!p;const l=s.getTypeAtLocation(e.getOriginalNode(u)).getCallSignatures();l.length&&l[0].getReturnType()===f[0].getReturnType()&&(i=!1);const d=tt(n,e,s,r,i,u);if(d){if(Ye.enabled){const t=e.getOriginalNode(u);Ye("arrow function:",`():${et(e,s,d,r)} at ${t.getSourceFile().__relativeFileName}`)}return j(e,t,s,r,c,a),o.updateArrowFunction(u,u.modifiers,u.typeParameters,u.parameters,d,u.equalsGreaterThanToken,u.body)}}}}else if(e.isFunctionExpression(u)&&!u.type){const r=s.getTypeAtLocation(u),l=r.getCallSignatures()[0];if(l&&l.getReturnType().flags&e.TypeFlags.Void)return u;const p=A(e,s,u);if(p&&!i(e.getOriginalNode(u),p,s))return u;let d=r;if(p){const e=s.getNonNullableType(p);e.getCallSignatures().length&&!e.isUnion()&&(d=p)}const f=k(s,d)?.getCallSignatures();if(f&&f.length){const r=f[0].getReturnType();let i=!!p;const l=s.getTypeAtLocation(e.getOriginalNode(u)).getCallSignatures();l.length&&l[0].getReturnType()===f[0].getReturnType()&&(i=!1);const d=tt(n,e,s,r,i,u);if(d)return Ye.enabled&&Ye("function expression:",`():${et(e,s,d,r)} at ${c.__relativeFileName}`),j(e,t,s,r,c,a),o.updateFunctionExpression(u,u.modifiers,u.asteriskToken,u.name,u.typeParameters,u.parameters,d,u.body)}}return u};return t=>{c=t;const r=e.visitNode(t,l);return 0===a.size?r:o.updateSourceFile(r,[...a.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function et(e,t,r,i){return e.isTypeReferenceNode(r)&&e.isIdentifier(r.typeName)?r.typeName.text:t.typeToString(i)}function tt(e,t,r,i,n,s){if(O(i,t,r))return;const o=q(t,r,i,e);if(o)return o;const a=!n;if(i.isUnion()&&P(t,k(r,i))){if(!a)return;return t.factory.createUnionTypeNode([t.factory.createTypeReferenceNode(t.factory.createIdentifier("UTSJSONObject")),t.factory.createLiteralTypeNode(t.factory.createNull())])}return i.flags&t.TypeFlags.Void?void 0:P(t,i)?a?t.factory.createTypeReferenceNode(t.factory.createIdentifier("UTSJSONObject")):void 0:D(t,r,i)?K(i,s,t,r):void 0}const rt=e("uts:transformer:UTSJSONObject"),it=["dynamicJSONFields","__$arrayContent"],nt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isPropertyAccessExpression(o)&&!function(e,t){return e.parent&&t.isCallExpression(e.parent)&&e.parent.expression===e}(o,e)){if(function(e,t){const r=t.getUTSJSONObjectType?.();if(r)return e===r||t.getNonNullableType(e)===r;return!1}(i.getTypeAtLocation(o.expression),i)){const t=o.name.text;if(it.includes(t))return o;if(o.questionDotToken){if(rt.enabled){const t=e.getOriginalNode(o);rt(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return n.createElementAccessChain(o.expression,o.questionDotToken,n.createStringLiteral(t))}if(rt.enabled){const t=e.getOriginalNode(o);rt(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return n.createElementAccessExpression(o.expression,n.createStringLiteral(t))}}return o};return t=>e.visitNode(t,s)}});const st=(e,t)=>({parser:{SourceFile(t){const{factory:r}=t,i=n=>{const s=e.visitEachChild(n,i,t);return e.isTypeAliasDeclaration(s)&&e.isTypeLiteralNode(s.type)&&s.type.members.push(r.createPropertySignature(void 0,r.createComputedPropertyName(r.createIdentifier("UTSObjectMarker")),r.createToken(e.SyntaxKind.QuestionToken),r.createLiteralTypeNode(r.createTrue()))),s};return e=>(e.forEachChild(i),e)}},before(t){const r=i=>{const n=e.visitEachChild(i,r,t);if(!(e.isPropertySignature(n)&&e.isComputedPropertyName(n.name)&&e.isIdentifier(n.name.expression)&&"UTSObjectMarker"===n.name.expression.text))return n};return t=>e.visitNode(t,r)}});function ot(e,t,r,i=new Set,n=new Set){if(i.has(e))return!1;switch(i.add(e),e.kind){case t.SyntaxKind.LiteralType:return e.literal.kind===t.SyntaxKind.NullKeyword;case t.SyntaxKind.UnionType:return e.types.some((e=>ot(e,t,r,i,n)));case t.SyntaxKind.TypeReference:{const s=e,o=r.getSymbolAtLocation(s.typeName);if(o&&!n.has(o)){n.add(o);const e=o.declarations?.find((e=>e.kind===t.SyntaxKind.TypeAliasDeclaration));if(e)return ot(e.type,t,r,i,n)}return!1}case t.SyntaxKind.TypeOperator:return ot(e.type,t,r,i,n);default:return!1}}const at=e("uts:transformer:arkts-no-any-unknown"),ct=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isCallExpression(o)){const{expression:t,typeArguments:r,arguments:s}=o;if(e.isPropertyAccessExpression(t)&&e.isIdentifier(t.name)){const a=i.getTypeAtLocation(t.expression);if("Promise"===a.symbol?.name)if(1===s.length&&"catch"===t.name.text){const i=lt(s[0],e);if(i)return n.updateCallExpression(o,t,r,[i])}else if(2===s.length&&"then"===t.name.text){const i=lt(s[1],e);if(i)return n.updateCallExpression(o,t,r,[s[0],i])}}}return o};return t=>e.visitNode(t,s)}});function lt(e,t){if(t.isArrowFunction(e)){const{parameters:r}=e;if(1===r.length){const i=r[0];if(!i.type){if(at.enabled){const e=t.getOriginalNode(i);at(e.getText(),`at ${e.getSourceFile().__relativeFileName}`)}const{factory:r}=t;return r.updateArrowFunction(e,e.modifiers,e.typeParameters,[r.updateParameterDeclaration(i,i.modifiers,i.dotDotDotToken,i.name,i.questionToken,r.createTypeReferenceNode(r.createIdentifier("ESObject"),void 0),i.initializer)],e.type,e.equalsGreaterThanToken,e.body)}}}else if(t.isFunctionExpression(e)){const{parameters:r}=e;if(1===r.length){const i=r[0];if(!i.type){if(at.enabled){const e=t.getOriginalNode(i);at(e.getText(),`at ${e.getSourceFile().__relativeFileName}`)}return t.factory.updateFunctionExpression(e,e.modifiers,e.asteriskToken,e.name,e.typeParameters,[t.factory.updateParameterDeclaration(i,i.modifiers,i.dotDotDotToken,i.name,i.questionToken,Q(t),i.initializer)],e.type,e.body)}}}}const pt=e("uts:transformer:runtimeHelper"),ut=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isPropertyAccessExpression(o)){const{expression:t,name:r}=o;if(e.isIdentifier(t)&&("JSON"===t.text||"console"===t.text)){if(pt.enabled){const t=e.getOriginalNode(o);pt(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return n.updatePropertyAccessExpression(o,n.createPropertyAccessExpression(n.createIdentifier("UTS"),t),r)}}if(e.isCallExpression(t)){const r=function(e,t,r){if(t.isPropertyAccessExpression(e.expression)){const i=function(e,t,r){if(!t.isIdentifier(e.name))return;const i=r.getTypeAtLocation(e.expression);let n="";if(i.isUnion())i.types.every((e=>{if(e.symbol){if("Map"===e.symbol.name)return!0;if("WeakMap"===e.symbol.name)return!0}return!1}))&&(n="Map");else if(r.isArrayType(i))n="Array";else if(i.flags&t.TypeFlags.StringLike)n="String";else if(i.symbol){const e=i.symbol.name;"Map"===e?n="Map":"WeakMap"===e&&(n="WeakMap")}if(!n)return;return dt[`${n}_${e.name.text}`]}(e.expression,t,r);if(i){const r=t.factory;return r.createCallExpression(r.createPropertyAccessExpression(r.createIdentifier("UTS"),r.createIdentifier(i)),void 0,[e.expression.expression,...e.arguments])}}}(t,e,i);if(r)return r}return o};return t=>e.visitNode(t,s)}});const dt={Array_find:"arrayFind",Array_pop:"arrayPop",Array_shift:"arrayShift",Array_copyWithin:"arrayCopyWithin",Array_fill:"arrayFill",Map_get:"mapGet",WeakMap_get:"weakMapGet",String_codePointAt:"stringCodePointAt"},ft=(e,t)=>({parser:{SourceFile(t){const{factory:r}=t,i=t=>{t.forEachChild(i),e.isCatchClause(t)&&(t.variableDeclaration?t.variableDeclaration.type||(t.variableDeclaration.type=r.createKeywordTypeNode(e.SyntaxKind.AnyKeyword)):t.variableDeclaration=r.createVariableDeclaration(r.createIdentifier("e"),void 0,r.createKeywordTypeNode(e.SyntaxKind.AnyKeyword)))};return e=>(e.forEachChild(i),e)}}}),yt=e("uts:transformer:decorators:inlineAndReified"),gt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r;function s(t){const s=t.typeParameters.map((e=>e.name.text));const o=function(e,t){const r=[];return t?.forEach((t=>{const i=mt(e,t);i&&r.push(i)})),r}(e,t.modifiers);if(o.includes("reified"))return[];const a={found:!1,keywords:new Map([["reified",!1]]),typeParameterNames:s},c=(t=>{const n=t.keywords,s=o=>{if(e.isCallExpression(o)&&o.typeArguments){const r=o.typeArguments,s=t.typeParameterNames;if(r.some((t=>{if(e.isTypeReferenceNode(t)&&e.isIdentifier(t.typeName)){const e=t.typeName.text;return s.includes(e)}}))){const r=i.getResolvedSignature(o);if(r){const i=r.declaration;i&&(e.getJSDocTags(i).forEach((e=>{const r=e.tagName.text;n.has(r)&&(t.found=!0,n.set(r,!0))})),(e.isFunctionDeclaration(i)||e.isMethodDeclaration(i))&&i.modifiers?.forEach((r=>{const i=mt(e,r);i&&n.has(i)&&(t.found=!0,n.set(i,!0))})))}}}return e.visitEachChild(o,s,r)};return s})(a);if(e.visitEachChild(t,c,r),a.found){const e=[];for(const[t,r]of a.keywords.entries())r&&("reified"!==t||o.includes("inline")||e.push(n.createDecorator(n.createCallExpression(n.createPropertyAccessExpression(n.createIdentifier("UTSAndroid"),n.createIdentifier("keyword")),void 0,[n.createStringLiteral("inline")]))),e.push(n.createDecorator(n.createCallExpression(n.createPropertyAccessExpression(n.createIdentifier("UTSAndroid"),n.createIdentifier("keyword")),void 0,[n.createStringLiteral(t)]))));return e}}const o=t=>{const i=e.visitEachChild(t,o,r);if(e.isFunctionDeclaration(i)&&i.typeParameters){const t=s(i);if(t){if(yt.enabled){const t=e.getOriginalNode(i);yt(t.name?.getText()||t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return n.updateFunctionDeclaration(i,n.createNodeArray([...t,...i.modifiers||[]]),i.asteriskToken,i.name,i.typeParameters,i.parameters,i.type,i.body)}}else if(e.isMethodDeclaration(i)&&i.typeParameters){const t=s(i);if(t){if(yt.enabled){const t=e.getOriginalNode(i);yt(t.name.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return n.updateMethodDeclaration(i,n.createNodeArray([...t,...i.modifiers||[]]),i.asteriskToken,i.name,i.questionToken,i.typeParameters,i.parameters,i.type,i.body)}}return i};return t=>e.visitNode(t,o)}});function mt(e,t){if(e.isDecorator(t)&&e.isCallExpression(t.expression)&&e.isPropertyAccessExpression(t.expression.expression)&&e.isIdentifier(t.expression.expression.name)&&e.isIdentifier(t.expression.expression.expression)&&"UTSAndroid"===t.expression.expression.expression.text&&"keyword"===t.expression.expression.name.text&&e.isStringLiteral(t.expression.arguments[0]))return t.expression.arguments[0].text}const Tt=e=>({before(t){const{factory:r}=t,i=n=>{if(e.isImportDeclaration(n)){const t=n.importClause;if(t&&t.namedBindings&&e.isNamedImports(t.namedBindings)&&0===t.namedBindings.elements.length)return r.createEmptyStatement()}return e.visitEachChild(n,i,t)};return t=>e.visitNode(t,i)}}),_t=e("uts:transformer:interface:override"),ht=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{if(e.isClassDeclaration(t)||e.isClassExpression(t)){const s=t.heritageClauses?.filter((t=>t.token===e.SyntaxKind.ImplementsKeyword)),o=s?.flatMap((e=>e.types.map((e=>i.getTypeAtLocation(e)))));if(o?.length){const s=t=>{if(e.isConstructorDeclaration(t)){let r=!1;const s=[];for(const a of t.parameters){let c=a;if(e.isParameterPropertyDeclaration(a,t)){const t=xt(a,o,e,i);if(t){if(_t.enabled){const t=e.getOriginalNode(a);_t(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}c=n.updateParameterDeclaration(a,t,a.dotDotDotToken,a.name,a.questionToken,a.type,a.initializer),r=!0}}s.push(c)}if(r)return n.updateConstructorDeclaration(t,t.modifiers,s,t.body)}else if(e.isPropertyDeclaration(t)&&!St(t,[e.SyntaxKind.OverrideKeyword,e.SyntaxKind.StaticKeyword])){const r=xt(t,o,e,i);if(r){if(_t.enabled){const r=e.getOriginalNode(t);_t(r.getText(),`at ${r.getSourceFile().__relativeFileName}`)}return n.updatePropertyDeclaration(t,r,t.name,t.questionToken||t.exclamationToken,t.type,t.initializer)}}else if(e.isMethodDeclaration(t)&&!St(t,[e.SyntaxKind.OverrideKeyword,e.SyntaxKind.StaticKeyword])){const r=xt(t,o,e,i);if(r){if(_t.enabled){const r=e.getOriginalNode(t);_t(r.getText(),`at ${r.getSourceFile().__relativeFileName}`)}return n.updateMethodDeclaration(t,r,t.asteriskToken,t.name,t.questionToken,t.typeParameters,t.parameters,t.type,t.body)}}return t};return e.visitEachChild(t,s,r)}}return e.visitEachChild(t,s,r)};return t=>e.visitNode(t,s)}});function xt(e,t,r,i){const n=i.getSymbolAtLocation(e.name);if(n){if(t.some((e=>e.getProperties().some((e=>e.name===n.name))))){return e.modifiers?[...e.modifiers.filter((e=>Nt(e,r))),r.factory.createModifier(r.SyntaxKind.OverrideKeyword),...e.modifiers.filter((e=>!Nt(e,r)))]:[r.factory.createModifier(r.SyntaxKind.OverrideKeyword)]}}}function St(e,t){return e.modifiers?.some((e=>t.includes(e.kind)))}function Nt(e,t){return e.kind===t.SyntaxKind.Decorator||e.kind===t.SyntaxKind.PublicKeyword||e.kind===t.SyntaxKind.ProtectedKeyword||e.kind===t.SyntaxKind.PrivateKeyword||e.kind===t.SyntaxKind.AbstractKeyword}const bt=e("uts:transformer:k2:openPropertyLateInit"),Et=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isPropertyDeclaration(o)&&!o.initializer&&!o.exclamationToken&&!function(e,t){return t?.some((t=>t.kind===e.SyntaxKind.AbstractKeyword||t.kind===e.SyntaxKind.PrivateKeyword||t.kind===e.SyntaxKind.Decorator&&e.isCallExpression(t.expression)&&e.isIdentifier(t.expression.expression)&&"by"===t.expression.expression.text))}(e,o.modifiers)){if(bt.enabled){const t=e.getOriginalNode(o);bt(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}const t=i.getTypeAtLocation(o);return Dt(t,o.type,e,i)?n.updatePropertyDeclaration(o,vt(e,o.modifiers),o.name,o.questionToken,o.type,n.createNull()):function(e,t){if(t.flags&e.TypeFlags.BooleanLike)return!0;const r=t.symbol;if(r)return Ft.includes(r.name);return!1}(e,t)?n.updatePropertyDeclaration(o,[n.createDecorator(n.createCallExpression(n.createIdentifier("by"),void 0,[n.createStringLiteral("notNull")])),...vt(e,o.modifiers)||[]],o.name,void 0,o.type,void 0):n.updatePropertyDeclaration(o,vt(e,o.modifiers),o.name,n.createToken(e.SyntaxKind.ExclamationToken),o.type,void 0)}if(e.isConstructorDeclaration(o)&&o.parameters.length&&o.parameters.find((t=>e.isParameterPropertyDeclaration(t,o)&&!t.initializer))){const t=[];return o.parameters.forEach((r=>{if(e.isParameterPropertyDeclaration(r,o)&&!r.initializer){Dt(i.getTypeAtLocation(r),r.type,e,i)?t.push(n.updateParameterDeclaration(r,r.modifiers,r.dotDotDotToken,r.name,r.questionToken,r.type,n.createNull())):t.push(n.updateParameterDeclaration(r,[n.createDecorator(n.createCallExpression(n.createIdentifier("by"),void 0,[n.createStringLiteral("notNull")])),...r.modifiers||[]],r.dotDotDotToken,r.name,r.questionToken,r.type,void 0))}else t.push(r)})),n.updateConstructorDeclaration(o,o.modifiers,t,o.body)}return o};return t=>e.visitNode(t,s)}});function vt(e,t){return t?.filter((t=>t.kind!==e.SyntaxKind.ReadonlyKeyword))}const Ft=["Byte","Short","Int","Long","Float","Double","Boolean","Char","UByte","UShort","UInt","ULong"];function Dt(e,t,r,i){return e.flags&r.TypeFlags.Any?!(!t||!ot(t,r,i)):i.getNonNullableType(e)!==e}const At=e("uts:transformer:number:toString"),Ct=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isCallExpression(o)&&0===o.arguments.length&&e.isPropertyAccessExpression(o.expression)&&"toString"===o.expression.name.text){const t=i.getTypeAtLocation(o.expression.expression);return t.flags&e.TypeFlags.NumberLiteral||t.flags&e.TypeFlags.Number?n.updateCallExpression(o,o.expression,o.typeArguments,[n.createNumericLiteral("10")]):o}if(e.isBinaryExpression(o)&&o.operatorToken.kind===e.SyntaxKind.PlusToken&&e.isNumericLiteral(o.right)&&o.right.getText().includes(".")){if(i.getTypeAtLocation(o).flags&e.TypeFlags.String){if(At.enabled){const t=e.getOriginalNode(o);At(t.right.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return n.updateBinaryExpression(o,o.left,o.operatorToken,n.createCallExpression(n.createPropertyAccessExpression(o.right,"toString"),void 0,[n.createNumericLiteral("10")]))}}else if(e.isTemplateSpan(o)&&e.isNumericLiteral(o.expression)&&o.expression.getText().includes(".")){if(At.enabled){const t=e.getOriginalNode(o);At(t.expression.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return n.updateTemplateSpan(o,n.createCallExpression(n.createPropertyAccessExpression(o.expression,"toString"),void 0,[n.createNumericLiteral("10")]),o.literal)}return o};return t=>e.visitNode(t,s)}}),kt=e("uts:transforms:rest_parameters"),Pt="do_not_transform_spread",Lt=(e,t,r)=>{const i=r.transformRestParameters?.shouldTransform??(()=>!0);return{before(r){const n=t.getProgram().getTypeChecker(),{factory:s}=r,o=t=>{const a=e.visitEachChild(t,o,r);if(e.isMethodDeclaration(a)&&a.parameters.length&&a.body){const t=k(n,w(e,n,a));if(t){const o=t.getCallSignatures();if(o&&1===o.length){if(!i(a,o[0],n,r))return a;const t=wt(o[0],a,e);if(t){if(kt.enabled){const r=e.getOriginalNode(a);kt("method:",`${r.name.getText()}(${I(e,t.parameters)}) at ${r.getSourceFile().__relativeFileName}`)}return s.updateMethodDeclaration(a,a.modifiers,a.asteriskToken,a.name,a.questionToken,a.typeParameters,t.parameters,a.type,s.createBlock([...t.statements,...a.body.statements]))}}}}else if(e.isArrowFunction(a)&&a.parameters.length){const t=k(n,n.getContextualType(a));if(t){if(t!==n.getTypeAtLocation(a)){const o=t.getCallSignatures();if(o&&o.length){if(!i(a,o[0],n,r))return a;const t=wt(o[0],a,e);if(t){if(kt.enabled){const r=e.getOriginalNode(a);kt("arrow function:",`(${I(e,t.parameters)}) at ${r.getSourceFile().__relativeFileName}`)}const r=e.isExpression(a.body)?s.createBlock([...t.statements,s.createReturnStatement(a.body)]):s.createBlock([...t.statements,...a.body.statements]);return Ut(o[0],a,s.updateArrowFunction(a,a.modifiers,a.typeParameters,t.parameters,a.type,a.equalsGreaterThanToken,r),e)}}}}}else if(e.isFunctionExpression(a)&&a.parameters.length){const t=k(n,n.getContextualType(a));if(t){if(t!==n.getTypeAtLocation(a)){const o=t.getCallSignatures();if(o&&o.length){if(!i(a,o[0],n,r))return a;const t=wt(o[0],a,e);if(t){if(kt.enabled){const r=e.getOriginalNode(a);kt("function expression:",`(${I(e,t.parameters)}) at ${r.getSourceFile().__relativeFileName}`)}return Ut(o[0],a,s.updateFunctionExpression(a,a.modifiers,a.asteriskToken,a.name,a.typeParameters,t.parameters,a.type,s.createBlock([...t.statements,...a.body.statements])),e)}}}}}return a};return t=>e.visitNode(t,o)}}};function wt(e,t,r){const i=function(e,t){if(e.parameters.length){const r=e.parameters[e.parameters.length-1];if(r.valueDeclaration&&t.isParameter(r.valueDeclaration)&&r.valueDeclaration.dotDotDotToken)return e.parameters.length-1}return-1}(e,r);if(-1!==i&&i<t.parameters.length){const e=function(e,t){if(e.find((e=>!t.isIdentifier(e.name))))return[];return e.map((e=>({name:e.name.getText(),isRestParameter:!!e.dotDotDotToken})))}(t.parameters.slice(i),r);if(e.length)return{parameters:r.factory.createNodeArray([...t.parameters.slice(0,i),(n=r.factory,n.createParameterDeclaration(void 0,void 0,n.createIdentifier(Pt),void 0,void 0,void 0))]),statements:Ot(e,r.factory)}}var n}function Ot(e,t){return t.createNodeArray(e.map((({name:e,isRestParameter:r},i)=>function(e,t,r,i){return i.createVariableStatement(void 0,i.createNodeArray([It(e,t,r,i)]))}(e,i,r,t))))}function It(e,t,r,i){return i.createVariableDeclaration(i.createIdentifier(e),void 0,void 0,r?i.createNewExpression(i.createIdentifier("Array"),void 0,[i.createSpreadElement(i.createIdentifier(Pt))]):i.createElementAccessExpression(i.createIdentifier(Pt),i.createNumericLiteral(t.toString())))}function Ut(e,t,r,i){const n=i.getOriginalNode(t).parent;if(n&&(i.isVariableDeclaration(n)||i.isBinaryExpression(n)&&n.operatorToken.kind===i.SyntaxKind.EqualsToken)&&e.declaration&&e.declaration.parent){const t=e.declaration.parent;if(i.isTypeAliasDeclaration(t)){const e=t.name.getText(),n=i.factory;return n.createNewExpression(n.createIdentifier(e),void 0,[r])}}return r}const Kt=(e,t)=>({before(r){const i=t.getProgram(),{factory:n}=r;return t=>function t(s){const o=e.visitEachChild(s,t,r),a=i.getTypeChecker();if(e.isCallExpression(o)&&o.typeArguments&&o.typeArguments.length>0){const t=a.getResolvedSignature(o);if(!t)return o;const r=o.arguments,i=t.getParameters();if(r.length<i.length){const t=r.length>0&&e.isBinaryExpression(r[0])&&r[0].operatorToken.kind===e.SyntaxKind.EqualsToken,s=[];for(let a=0;a<i.length;a++){const c=i[a],l=c.declarations?.[0];if(l&&e.isParameter(l)){if(l.dotDotDotToken)return o;if(!e.isIdentifier(l.name))return o;if(t?r.some((t=>e.isBinaryExpression(t)&&t.left.getText()===l.name.getText())):a<r.length)continue;if(l.initializer){if(!e.isLiteralExpression(l.initializer))return o;s.push(t?n.createBinaryExpression(n.cloneNode(l.name),e.SyntaxKind.EqualsToken,n.cloneNode(l.initializer)):n.cloneNode(l.initializer))}else s.push(t?n.createBinaryExpression(n.createIdentifier(c.name),e.SyntaxKind.EqualsToken,n.createNull()):n.createNull())}}return n.updateCallExpression(o,o.expression,o.typeArguments,[...r,...s])}}return o}(t)}}),Rt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r;return t=>{const s=[],o=a=>{const c=e.visitEachChild(a,o,r);if(e.isCallExpression(c)&&c.typeArguments&&c.typeArguments.length>0){const o=c.parent||e.getOriginalNode(c)?.parent;if(o&&!e.isAsExpression(o)){const o=i.getTypeAtLocation(c);if(o){let a=i.typeToTypeNode(o,e.getOriginalNode(c),e.NodeBuilderFlags.UseAliasDefinedOutsideCurrentScope);if(o.isUnion()&&De(o,e,i)){return a.types.some((t=>e.isLiteralTypeNode(t)&&t.literal.kind===e.SyntaxKind.NullKeyword))&&(a=n.createUnionTypeNode([n.createTypeReferenceNode("UTSUnionTypeObject"),n.createLiteralTypeNode(n.createNull())])),a=n.createTypeReferenceNode("UTSUnionTypeObject"),n.createAsExpression(c,a)}if(a){const o=[...s],l=new x(c,t,i,r,e,s);try{const e=l.visitTypeNode(a);if(e){return n.createAsExpression(c,e)}}catch(e){return s.splice(0,s.length,...o),c}}}}}return c},a=e.visitNode(t,o);return x.updateSourceFile(s,a,n,e)}}}),$t=e("uts:transformer:existentialType"),Mt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isTypeReferenceNode(o)&&o.typeArguments&&1===o.typeArguments.length&&o.typeArguments[0].kind===e.SyntaxKind.UnknownKeyword){let t=!1;if(e.isIdentifier(o.typeName)){const e=o.typeName.text;"Array"!==e&&"Set"!==e&&"Map"!==e&&"Ref"!==e||(t=!0)}if(!t){const t=i.getTypeFromTypeNode(o);if(t.symbol?.flags&e.SymbolFlags.Interface){if($t.enabled){const t=e.getOriginalNode(o);$t(t.getText(),` at ${t.getSourceFile().__relativeFileName}`)}return n.createTypeReferenceNode("SwiftExistentialType",[o.typeArguments[0],n.createTypeReferenceNode(o.typeName)])}}}return o};return t=>e.visitNode(t,s)}}),jt=e("uts:transformer:numberNarrowing"),zt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isNumericLiteral(o)&&o.parent&&!e.isAsExpression(o.parent)){const t=i.getContextualType(o);if(t){const r=i.getNonNullableType(t);if(r.isUnion()&&!function(e){return e.types.every((e=>e.isNumberLiteral()))}(r)){const t=r.types;if(t.length>1&&t.some((t=>function(e,t,r){return e.flags&t.TypeFlags.UTSNumberLike||e===(r.getUTSNumberType||r.getNumberType)?.()}(t,e,i)))){if(jt.enabled){const t=e.getOriginalNode(o);jt(`${t.getText()} as number`,` at ${t.getSourceFile().__relativeFileName}`)}return n.createAsExpression(o,Z(e))}}}}return o};return t=>e.visitNode(t,s)}}),Wt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r;return t=>function t(s){if(!e.isClassDeclaration(s)||!s.heritageClauses?.some((t=>t.token===e.SyntaxKind.ExtendsKeyword)))return e.visitEachChild(s,t,r);const o=i.getTypeAtLocation(s),a=i.getBaseTypes(o);if(0===a.length)return e.visitEachChild(s,t,r);const c=a[0].getSymbol();if(!c)return e.visitEachChild(s,t,r);const l=i.getTypeOfSymbol(c).getConstructSignatures();if(0===l.length)return e.visitEachChild(s,t,r);const p=s.members.map((t=>{if(!e.isConstructorDeclaration(t))return t;const r=i.getSignatureFromDeclaration(t);if(!r)return t;for(const s of l)if(qt(r,s,i)){const r=t.modifiers?.some((t=>{if(e.isDecorator(t)){const r=t.expression;if(e.isCallExpression(r)&&e.isPropertyAccessExpression(r.expression)&&e.isIdentifier(r.expression.expression)&&"UTSiOS"===r.expression.expression.text&&"keyword"===r.expression.name.text&&1===r.arguments.length&&e.isStringLiteral(r.arguments[0])&&"override"===r.arguments[0].text)return!0}return!1}));if(!r){const r=n.createDecorator(n.createCallExpression(n.createPropertyAccessExpression(n.createIdentifier("UTSiOS"),"keyword"),void 0,[n.createStringLiteral("override")])),i=e.getModifiers(t)||[];return n.updateConstructorDeclaration(t,[r,...i],t.parameters,t.body)}break}return t}));return n.updateClassDeclaration(s,e.getModifiers(s),s.name,s.typeParameters,s.heritageClauses,p)}(t)}});function qt(e,t,r){const i=e.getParameters(),n=t.getParameters();if(i.length!==n.length)return!1;for(let e=0;e<i.length;e++){const t=i[e],s=n[e],o=r.getTypeOfSymbolAtLocation(t,t.valueDeclaration),a=r.getTypeOfSymbolAtLocation(s,s.valueDeclaration);if(r.typeToString(o)!==r.typeToString(a))return!1}return!0}const Bt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker();return t=>{const n=[];const s=function s(o){const a=e.visitEachChild(o,s,r);if(e.isPropertyDeclaration(a)&&a.modifiers?.some((t=>t.kind===e.SyntaxKind.OverrideKeyword))&&void 0===a.type){const s=a.parent,o=a.name;if(e.isClassDeclaration(s)&&e.isIdentifier(o)){const c=o.text,l=i.getTypeAtLocation(s),p=i.getBaseTypes(l),u=i.getTypeOfPropertyOfType(l,c);let d=p[0],f=u;for(;d;){const e=i.getTypeOfPropertyOfType(d,c);if(!e)break;i.isTypeAssignableTo(u,e)&&i.isTypeAssignableTo(e,u)||(f=e),d=i.getBaseTypes(d)[0]}const y=i.typeToTypeNode(f,a,e.NodeBuilderFlags.UseAliasDefinedOutsideCurrentScope);if(y){const s=[...n],o=new x(a,t,i,r,e,n);try{const t=o.visitTypeNode(y);if(t)return e.factory.updatePropertyDeclaration(a,a.modifiers,a.name,a.questionToken,t,a.initializer)}catch(e){n.splice(0,n.length,...s)}}}}return a}(t);return x.updateSourceFile(n,s,r.factory,e)}}}),Gt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r;return t=>{const s=t=>{const o=e.visitEachChild(t,s,r);function a(e){const t=i.getSymbolAtLocation(e);if(!t)return!0;const r=i.getTypeOfSymbol(t);return W(r,i)||r===i.getAnyType()}return e.isNonNullExpression(o)?a(o.expression)?o:o.expression:e.isPropertyAccessChain(o)?a(o.expression)?o:n.updatePropertyAccessChain(o,o.expression,void 0,o.name):e.isElementAccessChain(o)?a(o.expression)?o:n.updateElementAccessChain(o,o.expression,void 0,o.argumentExpression):e.isCallChain(o)?a(o.expression)?o:n.updateCallChain(o,o.expression,void 0,o.typeArguments,o.arguments):o};return e.visitNode(t,s)}}});const Vt={componentPublicInstancePropertyAccessFallback:function(e,t,r,i,n,s){if(!e.isPropertyAccessExpression(r)||!e.isExpression(i)||!e.isIdentifier(s))return;const o=n.aliasSymbol?.escapedName.toString();if("ComponentPublicInstance"!==o&&"CreateComponentPublicInstance"!==o)return;const a=s.escapedText.toString(),c=globalThis?.__utsUniXGlobalProperties__;if(c&&c.has(a)){const{initializerNode:r}=c.get(a),i=t.getTypeAtLocation(r);return i.isNumberLiteral()?t.getNumberType():i.isStringLiteral()?t.getStringType():i.flags&e.TypeFlags.BooleanLiteral?t.getBooleanType():i}},filterReferencedByPaths:function(e,t){if(t&&e.endsWith(".uvue.ts"))for(const[e]of t?.entries())if(e.endsWith("main.uts.ts"))return void t.delete(e)}};globalThis.__utsUniXGlobalProperties__=globalThis.__utsUniXGlobalProperties__||new Map;const Ht=e=>({parser:{SourceFile:t=>r=>{const i=r.fileName,n=globalThis?.__utsUniXGlobalProperties__;if(n)for(const[e,t]of n)t.file===i&&n.delete(e);return function r(s){if(e.isBinaryExpression(s)){const{left:t,operatorToken:r,right:o}=s;if(r.kind===e.SyntaxKind.EqualsToken&&e.isPropertyAccessExpression(t)){const{expression:r,name:s}=t;if(e.isPropertyAccessExpression(r)){const{expression:t,name:a}=r;if("globalProperties"===a.escapedText.toString()&&e.isPropertyAccessExpression(t)){const{name:e}=t;"config"===e.escapedText.toString()&&n.set(s.escapedText.toString(),{file:i,initializerNode:o})}}}}return e.visitEachChild(s,r,t)}(r)}}});function Jt(e,t,r,i){return{code:e,category:t,key:r,message:i}}const Qt=(e,t,r)=>{const{extname:i,resolveWorkers:n,rewriteRootDir:s}=r.transformCreateWorker||{resolveWorkers:()=>({})},o={Worker_Path_Expected_a_string_literal:Jt(0,e.DiagnosticCategory.Error,"Worker_Path_Expected_a_string_literal_0","uni.createWorker(workerPath) 的 workerPath 参数必须是字符串字面量"),Worker_Path_Not_Found:Jt(0,e.DiagnosticCategory.Error,"Worker_Path_Not_Found_0","Worker[{0}]路径不存在或未正确实现"),Worker_Not_Supported_on_App_IOS_Uvue:Jt(0,e.DiagnosticCategory.Error,"Worker_Not_Supported_on_App_IOS_Uvue_0","app-ios平台，目前仅 uts 插件中支持使用 uni.createWorker 创建 worker")};return{before(t){const{factory:a}=t,c=new Map,l=n(),p=n=>{if(e.isCallExpression(n)&&n.arguments.length>=1&&e.isPropertyAccessExpression(n.expression)&&"createWorker"===n.expression.name.escapedText&&e.isIdentifier(n.expression.expression)&&"uni"===n.expression.expression.escapedText){"JavaScript"===r.targetLanguage&&"app-ios"===r.platform&&t.error(e.createDiagnosticForNode(n,o.Worker_Not_Supported_on_App_IOS_Uvue));const p=n.arguments[0];let u="";if(e.isStringLiteral(p)||e.isNoSubstitutionTemplateLiteral(p)?u=p.text:t.error(e.createDiagnosticForNode(p,o.Worker_Path_Expected_a_string_literal)),u)if(u.startsWith("/")&&(u=u.slice(1)),l[u]){if("Kotlin"===r.targetLanguage||"Swift"===r.targetLanguage){const t=a.createIdentifier(l[u]);if(!c.has(u)){const e=a.createImportDeclaration(void 0,a.createImportClause(!1,void 0,a.createNamedImports([a.createImportSpecifier(!1,void 0,t)])),a.createStringLiteral(`@/${u}`),void 0);c.set(u,e)}const r=[a.createArrowFunction(void 0,void 0,[],a.createTypeReferenceNode(a.createIdentifier("WorkerTaskImpl"),void 0),a.createToken(e.SyntaxKind.EqualsGreaterThanToken),a.createNewExpression(t,void 0,[]))];for(let e=1;e<n.arguments.length;e++)r.push(n.arguments[e]);return a.updateCallExpression(n,n.expression,n.typeArguments,r)}if(i){let e=u.replace(".uts",i);s&&e.includes("uni_modules/")&&(e="/"+s+(e.startsWith("/")?"":"/")+e);const t=[a.createStringLiteral(e)];for(let e=1;e<n.arguments.length;e++)t.push(n.arguments[e]);return a.updateCallExpression(n,n.expression,n.typeArguments,t)}}else t.error(e.createDiagnosticForNode(p,o.Worker_Path_Not_Found,u))}return e.visitEachChild(n,p,t)};return t=>{const r=e.visitNode(t,p);return 0===c.size?r:a.updateSourceFile(r,[...c.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};let Xt=null,Yt=[];const Zt=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker();null===Xt&&i.getGlobalType&&(Xt=i.getGlobalType("UniApp",0,!1),Xt&&(Yt=Xt.getProperties().map((e=>e.getName()))));const n=t=>{if(Xt&&Yt.length){if(e.isCallExpression(t)&&e.isPropertyAccessExpression(t.expression)&&e.isIdentifier(t.expression.name)){const r=C(i,t.expression.expression);if(r&&r.isIntersection()&&r.types.some((e=>"UniApp"===e.symbol?.name))&&!Yt.includes(t.expression.name.text)){console.error(`error: '${t.expression.name.text}' 不是 UniApp 对象的方法，请检查是否拼写错误，如果想调用在 App.uvue 文件中定义的 methods 方法，请使用 .vm?.xxx 的方式调用，详情参考：https://doc.dcloud.net.cn/uni-app-x/api/get-app.html#appmethods`);const r=t.getSourceFile();if(r.__relativeFileName){const i=e.getLineAndCharacterOfPosition(r,t.pos),n=r.__relativeFileName.split("?")[0].replace(/\.(vue|uvue|uts).ts$/g,".$1");console.error("at "+n+":"+i.line)}}}return e.visitEachChild(t,n,r)}return t};return t=>e.visitNode(t,n)}}),er=["useSharedData","useSharedDataComponent","useSharedDataPage"].map((e=>"_"+e)),tr={_defineEmits:"__emit"},rr={_useSharedData:"Data",_useSharedDataComponent:"Component",_useSharedDataPage:"Page"},ir="_useSharedData",nr=["setSharedData","setSharedDataDynamicProps","setSharedDataEvents","setSharedDataClass","setSharedDataStyle","setSharedDataAttr","setSharedDataEvent","setSharedDataModel","setSharedDataTemplateRef"].map((e=>"_"+e)),sr=["createSharedDataComponent"].map((e=>"_"+e));function or(e,t,r,i){const n=i.createTypeReferenceNode("UniSharedDataAny");if(e.isUnion()&&(2===e.types.length||3===e.types.length)&&(e.types.some((e=>e.flags&r.TypeFlags.Null))||e.types.some((e=>e.flags&r.TypeFlags.Undefined)))){const n=e.types.filter((e=>!(e.flags&r.TypeFlags.Null||e.flags&r.TypeFlags.Undefined)));if(1===n.length)return i.createUnionTypeNode([or(n[0],t,r,i),i.createLiteralTypeNode(i.createNull())])}const s=t.getErrorType(),o=t.getAnyType();if(e===t.getBooleanType())return i.createKeywordTypeNode(r.SyntaxKind.BooleanKeyword);if(e.isUnionOrIntersection()||e===s||e===o)return n;if(e===t.getStringType())return i.createKeywordTypeNode(r.SyntaxKind.StringKeyword);if(e===t.getNumberType())return i.createKeywordTypeNode(r.SyntaxKind.NumberKeyword);if(e===t.getNullType()||e===t.getUndefinedType())return i.createLiteralTypeNode(i.createNull());if(t.isArrayType(e))return i.createTypeReferenceNode("UniSharedDataArray");if(e===t.getAnyType())return n;if(t.isTypeAssignableTo(e,t.getGlobalType("UniSharedData",0,!0))||e===t.getGlobalType("UniSharedDataFunctionSetTemplateRef",0,!0)||e===t.getGlobalType("UniSharedDataFunctionEventListener",0,!0)){return t.typeToTypeNode(e,void 0,r.NodeBuilderFlags.ForbidIndexedAccessSymbolReferences|r.NodeBuilderFlags.UseAliasDefinedOutsideCurrentScope)||n}return i.createTypeReferenceNode("UniSharedDataJSONObject")}function ar(e,t,r){return r.createMethodDeclaration(void 0,void 0,r.createIdentifier("_get_"+e),void 0,void 0,[r.createParameterDeclaration(void 0,void 0,r.createIdentifier("reactivity"),void 0,r.createTypeReferenceNode(r.createIdentifier("VueReactivity"),void 0),void 0)],r.cloneNode(t),void 0)}function cr(e,t,r){if(r.isLiteralTypeNode(e)){if(!r.isStringLiteral(e.literal))return;return e.literal.text}if(r.isTemplateLiteralTypeNode(e)||r.isTypeReferenceNode(e)){const r=t.getTypeAtLocation(e);if(!r.isStringLiteral())return;return r.value}}const lr=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),n=r.factory;let s=!1,o=!1,a={},c={},l={};function p(e){const t=i.getTypeAtLocation(e).getProperty("__className");if(t){const r=i.getTypeOfSymbolAtLocation(t,e);if(r.isLiteral()){return r.value+"SharedData"}}}const u=t=>{let d=!1,f=!1;if(s||(d=e.isMethodDeclaration(t)&&e.isIdentifier(t.name)&&"setup"===t.name.text,d&&(s=!0)),s&&(f=e.isFunctionExpression(t)&&!!t.name&&e.isIdentifier(t.name)&&"renderSharedData"===t.name.text,f&&(o=!0),e.isVariableDeclaration(t)&&t.initializer&&e.isCallExpression(t.initializer)&&e.isIdentifier(t.initializer.expression))){const r=t.initializer.expression.text;if(r in tr&&e.isIdentifier(t.name))return n.updateVariableDeclaration(t,t.name,t.exclamationToken,t.type,n.createIdentifier(tr[r]))}if(s&&o){if(e.isVariableDeclaration(t)&&t.initializer&&e.isCallExpression(t.initializer)&&e.isIdentifier(t.initializer.expression)){const r=t.initializer.expression.text;if(er.includes(r)&&e.isIdentifier(t.name)){const s=t.initializer.typeArguments,o=t.name.text;if(s&&1===s.length){const c=s[0];if(e.isLiteralTypeNode(c)||e.isTemplateLiteralTypeNode(c)||e.isTypeReferenceNode(c)){const s=cr(c,i,e);if(s)return a[o]={className:s,type:rr[r]||"Data"},n.updateVariableDeclaration(t,t.name,t.exclamationToken,t.type,n.createNewExpression(n.createIdentifier(s),void 0,t.initializer.arguments))}}}else if(sr.includes(r)){const r=t.initializer.arguments[0];if(e.isIdentifier(t.name)&&r&&e.isIdentifier(r)){const e=t.name.text,i=p(r);i&&(l[e]=i)}}}if(e.isCallExpression(t)&&e.isIdentifier(t.expression)){const r=t.expression.text;if(nr.includes(r)){const s=t.arguments,[o,u,d]=s;if(o&&u&&d&&e.isIdentifier(o)&&e.isStringLiteral(u)){const s=o.text,f=u.text;if("_setSharedDataClass"===r)c[s]=c[s]||{},c[s][f]=n.createArrayTypeNode(n.createKeywordTypeNode(e.SyntaxKind.StringKeyword));else if(e.isNewExpression(d)&&e.isIdentifier(d.expression)&&"UniSharedDataVFor"===d.expression.text){const t=d.arguments?.[1];if(t&&e.isArrowFunction(t)){const r=t.body;if(e.isCallExpression(r)&&e.isIdentifier(r.expression)&&r.expression.text===ir&&r.typeArguments&&1===r.typeArguments.length){const t=r.typeArguments[0];if(e.isLiteralTypeNode(t)||e.isTemplateLiteralTypeNode(t)||e.isTypeReferenceNode(t)){const r=cr(t,i,e);if(r){const e=r.match(/_(VFor\d*)$/);if(e){const t=`__sharedData_${e[1]}`;a[t]={className:r,type:"Data"},c[s]=c[s]||{},c[s][f]=n.createTypeReferenceNode(n.createIdentifier("UniSharedDataVFor"),[n.createTypeReferenceNode(n.createIdentifier(r))])}}}}}}else if(d&&e.isPropertyAccessExpression(d)&&e.isCallExpression(d.expression)&&e.isIdentifier(d.expression.expression)&&sr.includes(d.expression.expression.text)&&d.name&&e.isIdentifier(d.name)&&"sharedData"===d.name.text){const t=d.expression.arguments[0];if(t&&e.isIdentifier(t)){const e=p(t);e&&(c[s]=c[s]||{},c[s][f]=n.createTypeReferenceNode(n.createIdentifier(e)))}}else if(d&&e.isPropertyAccessExpression(d)&&d.expression&&e.isIdentifier(d.expression)&&d.name&&e.isIdentifier(d.name)&&"sharedData"===d.name.text&&d.expression.text&&l[d.expression.text]){const e=d.expression.text;let t=l[e];t&&(c[s]=c[s]||{},c[s][f]=n.createTypeReferenceNode(n.createIdentifier(t)))}else{const r=i.getTypeAtLocation(e.getOriginalNode(t)||t);r&&(c[s]=c[s]||{},c[s][f]=i.getBaseTypeOfLiteralType(r))}}}else if(r===ir&&t.typeArguments&&1===t.typeArguments.length){const r=t.typeArguments[0];if(e.isLiteralTypeNode(r)||e.isTemplateLiteralTypeNode(r)||e.isTypeReferenceNode(r)){const s=cr(r,i,e);if(s){if(s.match(/_(VFor\d*)$/))return n.createNewExpression(n.createIdentifier(s),void 0,t.arguments)}}}}}const y=e.visitEachChild(t,u,r);return o&&f&&(o=!1),s&&d&&(s=!1),y};return t=>{a={},c={},(t=e.visitNode(t,u)).__utsMeta||(t.__utsMeta={});const n=function(e,t,r,i,n){const s=[],o=Object.keys(t).sort(((e,t)=>t.length-e.length));for(const a of o){const{className:o,type:c}=t[a];e[a]||(e[a]={});const l=[],p=e[a],u=Object.keys(p).sort();for(const e of u){const t=p[e];if(i.isTypeNode(t)){const r=t;let s=!1;i.isUnionTypeNode(r)&&(s=r.types.some((e=>e.kind===i.SyntaxKind.UndefinedKeyword&&i.isLiteralTypeNode(e)&&e.literal.kind===i.SyntaxKind.NullKeyword))),l.push(n.createPropertyDeclaration([],n.createIdentifier(e),s?n.createToken(i.SyntaxKind.QuestionToken):void 0,r,void 0)),l.push(ar(e,r,n));continue}const s=t;if(!r.typeToTypeNode(s,void 0,i.NodeBuilderFlags.UseAliasDefinedOutsideCurrentScope))continue;let o=!1;s.isUnion()&&(o=s.types.some((e=>!!(e.flags&i.TypeFlags.Null)||!!(e.flags&i.TypeFlags.Undefined))));const a=or(s,r,i,n);l.push(n.createPropertyDeclaration([],n.createIdentifier(e),o?n.createToken(i.SyntaxKind.QuestionToken):void 0,a,void 0)),l.push(ar(e,a,n))}const d=n.createClassDeclaration([n.createToken(i.SyntaxKind.DeclareKeyword)],n.createIdentifier(o),void 0,[n.createHeritageClause(i.SyntaxKind.ExtendsKeyword,[n.createExpressionWithTypeArguments(n.createIdentifier("Page"===c?"UniSharedDataPage":"Component"===c?"UniSharedDataComponent":"UniSharedData"),void 0)])],l);s.push(d)}return s}(c,a,i,e,r.factory);return t.__utsMeta.sharedData={decls:n,declsText:n.map((e=>r.printNode(e,t))).join("\n")},t}}}),pr=e("uts:transformer:uniElement"),ur=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isCallExpression(o)&&e.isPropertyAccessExpression(o.expression)){const t=o.expression;if("addEventListener"===t.name.text){const r=i.getTypeAtLocation(t.expression),s=i.getNonNullableType(r);if(s!==function(e){fr||(fr=e.getGlobalType("UniElementImpl",0,!0));return fr}(i)&&i.isTypeStrictSubtypeOf(s,function(e){dr||(dr=e.getGlobalType("UniElement",0,!0));return dr}(i))){if(pr.enabled){const r=e.getOriginalNode(t.expression);pr(`${t.expression.getText()} as UniElementImpl`,` at ${r.getSourceFile().__relativeFileName}`)}const i=n.createTypeReferenceNode("UniElementImpl",[]);return n.updateCallExpression(o,n.updatePropertyAccessExpression(t,n.createAsExpression(t.expression,s===r?i:X(i,e)),t.name),o.typeArguments,o.arguments)}}}return o};return t=>e.visitNode(t,s)}});let dr,fr;const yr=e("uts:transformer:vModel"),gr=(e,t)=>({before(r){const i=t.getProgram().getTypeChecker(),{factory:n}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isArrowFunction(o)&&1===o.parameters.length&&e.isBlock(o.body)&&1===o.body.statements.length){const t=o.parameters[0];if(!t.type&&e.isIdentifier(t.name)&&"$event"===t.name.text){const r=o.parent;if(e.isPropertyAssignment(r)){const s=r.name;if(e.isStringLiteral(s)&&s.text.startsWith("onUpdate:")){const r=o.body.statements[0];if(e.isExpressionStatement(r)){let s=null;if(e.isBinaryExpression(r.expression)&&r.expression.operatorToken.kind===e.SyntaxKind.EqualsToken?s=i.getTypeAtLocation(r.expression.left):e.isCallExpression(r.expression)&&2===r.expression.arguments.length&&(s=i.getTypeAtLocation(r.expression.arguments[0])),s){const r=K(s,t,e,i);if(r){if(yr.enabled){const r=e.getOriginalNode(t);yr(`$event as ${i.typeToString(s)}`,` at ${r.getSourceFile().__relativeFileName}`)}return n.updateArrowFunction(o,o.modifiers,o.typeParameters,[n.updateParameterDeclaration(t,t.modifiers,t.dotDotDotToken,t.name,t.questionToken,mr(r,e),t.initializer)],o.type,o.equalsGreaterThanToken,o.body)}}}}}}}return o};return t=>e.visitNode(t,s)}});function mr(e,t){return t.isTypeReferenceNode(e)&&t.isIdentifier(e.typeName)&&1===e.typeArguments?.length&&"Ref"===e.typeName.text?e.typeArguments[0]:e}var Tr;function _r(e){return{...te,...Vt}}function hr(e,t={}){const r=[he];return e!==exports.TargetLanguage.Kotlin&&e!==exports.TargetLanguage.Swift||r.push(_e),e!==exports.TargetLanguage.Kotlin&&e!==exports.TargetLanguage.Swift||(r.push(st,Fe,Ge),t.enableGenericsParameterDefaults&&r.push(Se),t.enableNarrowType&&(r.push(Me),r.push(ze),r.push(Le),r.push(Be)),r.push(ie)),e!==exports.TargetLanguage.Kotlin&&e!==exports.TargetLanguage.Swift&&e!==exports.TargetLanguage.ArkTS||r.push(nt),e===exports.TargetLanguage.Kotlin&&r.push(Zt,gr,ht,ft,gt,Tt,Ct,Lt,Et),e===exports.TargetLanguage.Swift&&(t.isPureSwift&&r.push(Rt),t.isPureSwift&&r.push(Kt),r.push(zt),r.push(ur),r.push(Mt),t.isPureSwift&&r.push(Gt),t.isPureSwift&&r.push(Bt),t.isPureSwift&&r.push(Wt)),e===exports.TargetLanguage.ArkTS&&(r.push(ct),r.push(ut)),r.push(Ht,Qe,Ze,Ee,Qt,lr),r}exports.TargetLanguage=void 0,(Tr=exports.TargetLanguage||(exports.TargetLanguage={})).Kotlin="Kotlin",Tr.Swift="Swift",Tr.ArkTS="ArkTS",Tr.JavaScript="JavaScript";const xr=["map","filter","forEach","every","some","find","findIndex","reduce","reduceRight"];function Sr(e){return e.symbol&&["Set","Map"].includes(e.symbol.escapedName)}const Nr=["uni","uniCloud"];function br(e,t){if(e.isPropertyAccessExpression(t.expression)&&e.isIdentifier(t.expression.expression)){const e=t.expression.expression.getText();if(Nr.includes(e))return!0}return!1}const Er=["defineApp","defineComponent","defineVaporComponent","defineAsyncComponent","defineVaporSharedDataComponent","defineMixin"];function vr(e){return e===exports.TargetLanguage.Kotlin?"app-android":e===exports.TargetLanguage.Swift?"app-ios":e===exports.TargetLanguage.ArkTS?"app-harmony":""}function Fr(e,t,r){const i=r.parent;if(i&&e.isCallExpression(i))if(e.isIdentifier(i.expression)){const e=i.expression.getText();if("watch"===e||"watchEffect"===e||"watchPostEffect"===e||"watchSyncEffect"===e)return!1}else if(e.isPropertyAccessExpression(i.expression)){const e=i.expression.name.getText();if("then"===e||"catch"===e)return!1}return!0}function Dr(e,t){if(e.aliasSymbol||e.symbol){const r=(e.aliasSymbol||e.symbol).declarations;if(r&&r.length>0&&!o(r[0],t))return!1}return!0}function Ar(e,t){if(t.isNonNullExpression(e))return!1;if(t.isAsExpression(e))return!1;const r=e.parent;if(!r)return!1;if(t.isNonNullExpression(r))return!1;if(t.isCallExpression(r)&&r.questionDotToken)return!1;if(t.isBinaryExpression(r)&&r.operatorToken.kind===t.SyntaxKind.QuestionQuestionToken)return!1;if(t.isBinaryExpression(r)){const e=r.operatorToken.kind;if(e===t.SyntaxKind.EqualsEqualsToken||e===t.SyntaxKind.EqualsEqualsEqualsToken||e===t.SyntaxKind.ExclamationEqualsToken||e===t.SyntaxKind.ExclamationEqualsEqualsToken)return!1}if(t.isPropertyAccessExpression(r)){if(r.questionDotToken)return!1;if(t.isNonNullExpression(r.expression))return!1}return!0}exports.UniXCompiler=class{constructor(e){this._options=e}debug(e,...t){return this._utsCompiler.debug(e,...t)}getProgram(){return this._utsCompiler.getProgram()}getTypeScript(){return this._utsCompiler.getTypeScript()}close(){return this._utsCompiler.close()}wait(e){return this._utsCompiler.wait(e)}getRootFiles(){return this._utsCompiler.getRootFiles()}hasRootFile(e){return this._utsCompiler.hasRootFile(e)}addRootFile(e,t=2e3){return this._utsCompiler.addRootFile(e,t)}addRootFiles(e,t=2e3){return this._utsCompiler.addRootFiles(e,t)}getDiagnostics(){return this._utsCompiler.getDiagnostics()}async invalidate(e){}init(){if(this._utsCompiler)return Promise.resolve();const e=this._options,{mode:n,targetLanguage:a,hxLanguageServiceDir:c}=e,l=e.tsFactory(_r()),p=s(e.inputDir),u=s(e.outputDir),d=c?t.resolve(c,"builtin-dts"):"";let f=e.utsLibDir;const y=s(t.resolve(f,"uts/types/uts")),m=s(t.resolve(f,"uts/types/uni-x")),T=vr(a);T||(console.error(`${a} is unsupported`),process.exit(0));const _=s(t.resolve(m,T,"paths.json")),h=[t.resolve(m,`${T}.d.ts`)],x=t.resolve(p,"../uni-ext-api.d.ts");r.existsSync(x)&&h.push(x);let S="",N="",b="",E="";function F(){S=s(t.resolve(y,"common")),N=s(t.resolve(m,T)),b=s(t.resolve(require.resolve("@dcloudio/uni-app-x/package.json",{paths:[f]}),"../types"))}"app-harmony"===T&&(E=t.resolve(m,T)),c&&d?(r.existsSync(d)?(S=s(t.resolve(d,"uts-types/common")),N=s(t.resolve(d,`uts-types/${T}`)),b=s(t.resolve(d,"uniappx/node_modules/@dcloudio/uni-app-x/types"))):F(),"app-android"!==T&&"app-ios"!==T||(E=s(t.resolve(c,`../uts-development-${T.replace("app-","")}/uts-types/${T}`)),r.existsSync(E)||(E=""))):F();const D={};if(E&&r.existsSync(_)){const e=require(_);Object.keys(e).forEach((r=>{const i=[];e[r].forEach((e=>{i.push(t.resolve(E,e))})),D[r]=i}))}e.rootFiles&&e.rootFiles.length&&h.push(...e.rootFiles);const A=[t.resolve(m,"@vue/runtime-core/dist/runtime-core.d.ts")],C={rootDir:p,baseUrl:p,outDir:u,noImplicitAny:!1,noImplicitThis:!0,useDefineForClassFields:!1,sourceMap:"sourceMap"in e?e.sourceMap:"development"===process.env.NODE_ENV,inlineSources:"inlineSources"in e?e.inlineSources:"development"===process.env.NODE_ENV,noEmitOnError:!1,skipLibCheck:!0,resolveJsonModule:!1,typeRoots:[],paths:{"@uts/common.d.ts":[t.resolve(S,"common.d.ts")],[`@uni-x/${T}.d.ts`]:[t.resolve(N,"index.d.ts")],"@dcloudio/uni-app-x/index.d.ts":[t.resolve(b,"index.d.ts")],"@vue/shared":[t.resolve(m,"@vue/shared/dist/shared.d.ts")],"@vue/reactivity":[t.resolve(m,"@vue/reactivity/dist/reactivity.d.ts")],"@vue/runtime-core":A,vue:A,...D,...e.paths}},k={mode:n,typescript:l,inputDir:p,cacheDir:e.cacheDir,rootFiles:h,incremental:e.incremental,compilerOptions:C,reportFileName:function(e){let r="other";(e=s(e)).startsWith(y)?(r="system",e="uts:"+t.relative(y,e)):e.startsWith(m)?(r="system",e="uni-x:"+t.relative(m,e)):e.startsWith(b)?(r="system",e="uni-x:"+t.relative(b,e)):e.startsWith(S)?(r="system",e="uts:"+t.join("common",t.relative(S,e))):e.startsWith(N)?(r="system",e="uni-x:"+t.join(T,t.relative(N,e))):E&&e.startsWith(E)?(r="system",e=T+":"+t.relative(E,e)):e.startsWith(p)&&(r="user",e=t.relative(p,e));return{type:r,fileName:e}},reportDiagnostic(e){},createTransformers:function(t,{rootDir:r}){return v(l,hr(a,e.transformOptions),{watch:!0,platform:T,targetLanguage:a,hxPluginDir:e.hxPluginDir,utsLibDir:e.utsLibDir,isPureSwift:e.transformOptions?.isPureSwift??!1,setParentRecursive:!1,transformCreateWorker:{extname:e.transformOptions?.workers?.extname,rewriteRootDir:e.transformOptions?.workers?.rewriteRootDir,resolveWorkers:e.transformOptions?.workers?.resolve??(()=>({}))},transformObjectLiteral:{shouldTransformAsExpression(e,t){const i=(e=l.getOriginalNode(e)).parent;return!(i&&l.isCallExpression(i)&&br(l,i))&&!(t&&!Dr(t,r))}},transformArguments:{shouldTransform(e,t,r){if(function(e,t,r){if(!t.isArrowFunction(e)&&!t.isFunctionExpression(e))return!1;const i=e.parent;if(!t.isCallExpression(i))return!1;const n=i.expression;if(!t.isPropertyAccessExpression(n))return!1;const s=n.name.getText();if(!xr.includes(s))return!1;let o=r.getNonNullableType(r.getTypeAtLocation(n.expression));if(o.flags===t.TypeFlags.Any){let e=n.expression;t.isParenthesizedExpression(e)&&(e=e.expression),t.isAsExpression(e)&&(o=r.getNonNullableType(r.getTypeAtLocation(e.expression)))}return!(!r.isArrayType(o)&&!r.isTupleType(o))||(o.isUnion()||o.isIntersection()?o.types.some((e=>Sr(e))):!!Sr(o))}(e=l.getOriginalNode(e),l,r))return!1;const i=l.isMethodDeclaration(e)?e.parent:e.parent.parent;if(i&&l.isObjectLiteralExpression(i)){let e=i.parent;if(e&&(l.isAsExpression(e)&&(e=e.parent),l.isCallExpression(e)))if(l.isIdentifier(e.expression)){const t=e.expression.getText();if(Er.includes(t))return!1}else if(br(l,e))return!1}return Fr(l,r,e)}},transformReturnType:{shouldTransform(e,t,r){if(e=l.getOriginalNode(e),l.isMethodDeclaration(e)&&l.isIdentifier(e.name)){if("provide"===e.name.getText())return!1}return Fr(l,r,e)}},transformGenericsParameterDefaults:{shouldTransform:(e,t,i,n)=>!((l.isCallExpression(e)||l.isNewExpression(e))&&!function(e,t,r){const i=function(e,t){const r=t.getSymbolAtLocation(e);if(r){const e=r.declarations;if(e&&e.length>0)return e[0]}}(e,t);if(i)return o(i,r);return!0}(e.expression,i,r))&&!(t&&!Dr(t,r))},transformRestParameters:{shouldTransform(e,t,i,n){const s=t.declaration;return!s||o(s,r)}},transformNarrowType:{shouldTransformNonNullable:(e,t)=>a===exports.TargetLanguage.Kotlin?!l.isIdentifier(e)&&Ar(e,l):a===exports.TargetLanguage.Swift&&Ar(e,l)}})(t)},watchFile:e.watchFile,normalizeFileName:e.normalizeFileName,sourceMapCallback:(e,n,o)=>{const c=s(t.relative(u,e));if(e.endsWith(".uvue.map")||e.endsWith(".vue.map")){const e=t.resolve(p,c.replace(".map",".ts.map"));if(r.existsSync(e)){n=function(e,t){if(!e)return t;if(!t)return e;const r=JSON.parse(e),n=JSON.parse(t),s=new i.SourceMapConsumer(r),o=new i.SourceMapConsumer(n),a=new i.SourceMapGenerator(r);o.eachMapping((function(e){if(null==e.originalLine)return;const t=s.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=t.source&&a.addMapping({original:{line:t.line,column:t.column},generated:{line:e.generatedLine,column:e.generatedColumn},source:t.source,name:t.name})}));return[r,n].forEach((function(e,t){e.sources.forEach((function(e){const r=(0===t?s:o).sourceContentFor(e);null!=r&&a.setSourceContent(e,r)}))})),a.toString()}(r.readFileSync(e,"utf8"),n)}}return o?.(e,function(e,t){const r=JSON.parse(t);return r.sources=r.sources.map((t=>{const r=t.split("/.tsc/"+vr(e)+"/");return(t=(t=r[1]||r[0]).split("?")[0]).replace(".uts.ts",".uts")})),JSON.stringify(r)}(a,n)),!0}};return this._utsCompiler=new g(k),this._utsCompiler.init()}},exports.initTargetHacker=_r,exports.initTargetTransformers=hr;

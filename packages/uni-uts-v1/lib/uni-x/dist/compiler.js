"use strict";require("fs");var e,t,r=require("debug"),n=require("path"),i=require("fs-extra"),s=require("source-map-js");function o(e){return e.replace(/\\/g,"/")}function a(e,t,r,n,i,s,o){return{code:e,category:t,key:r,message:n,reportsUnnecessary:i,elidedInCompatabilityPyramid:s,reportsDeprecated:o}}function c(e){let t,r=()=>{};return t=e?Promise.race([new Promise((t=>setTimeout(t,e,!0))),new Promise((e=>r=e))]):new Promise((e=>r=e)),{promise:t,resolve:r}}!function(e){e[e.Warning=0]="Warning",e[e.Error=1]="Error",e[e.Suggestion=2]="Suggestion",e[e.Message=3]="Message"}(e||(e={})),a(1e5,e.Error,"Type_literal_property_must_have_a_type_annotation_100000","Type literal property must have a type annotation."),a(100001,e.Error,"Only_one_extends_heritage_clause_is_allowed_for_interface_100001","Only one extends heritage clause is allowed for interface"),a(100002,e.Error,"Variable_declaration_must_have_initializer_100002","Variable declaration must have initializer."),a(100003,e.Error,"Nested_type_literal_is_not_supported_100003","Nested type literal is not supported."),a(100004,e.Error,"Invalid_generic_type_which_can_not_be_constructed_100004","Invalid generic type which can not be constructed."),a(100005,e.Error,"script_setup_cannot_contain_ES_module_exports_100005","`<script setup>` cannot contain ES module exports."),function(e){e[e.STARTING_COMPILATION_IN_WATCH_MODE=6031]="STARTING_COMPILATION_IN_WATCH_MODE",e[e.FILE_CHANGE_DETECTED=6032]="FILE_CHANGE_DETECTED",e[e.FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES=6193]="FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES",e[e.FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES=6194]="FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES"}(t||(t={}));class l{constructor(e){this._startDeferred=null,this._finishDeferred=null,this._ts=e}watch(e){this._startDeferred=c(e),this._finishDeferred=c()}handleStatus(e){if(e.category===this._ts.DiagnosticCategory.Message)switch(e.code){case t.FILE_CHANGE_DETECTED:this.resolveStart();break;case t.FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES:case t.FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES:this.resolveFinish()}}resolveStart(){this._startDeferred&&(this._startDeferred.resolve(!1),this._startDeferred=null)}resolveFinish(){this._finishDeferred&&(this._finishDeferred.resolve(!1),this._finishDeferred=null)}async wait(){if(this._startDeferred){await this._startDeferred.promise&&(this._startDeferred=null,this._finishDeferred=null),await(this._finishDeferred?.promise)}}}const u=r("uts:tsc:compile"),p={strict:!0,noLib:!0,emitUTS:!0,isolatedModules:!0,target:99,module:99,moduleResolution:100};class f{constructor(e){this._rootFiles=[],this._options=e}debug(e,...t){return u(e,...t)}hasRootFile(e){return this._rootFiles.includes(o(e))}async addRootFile(e,t=2e3){return this.addRootFiles([e],t)}async addRootFiles(e,t=2e3){const r=e.map(o).filter((e=>!this._rootFiles.includes(e)));if(0===r.length)return void(e.length&&u.enabled&&u("addRootFile",e,"already exists"));u.enabled&&u("addRootFiles.start",r);const n=Date.now();this._rootFiles.push(...r),await this._watcher.updateRootFileNames(this._rootFiles.slice()),u.enabled&&u("addRootFiles.end",r,Date.now()-n)}getRootFiles(){return this._rootFiles}async wait(e,t){const r=Date.now();this._helper.watch(e),await this._helper.wait(),u.enabled&&u("wait",Date.now()-r,t)}async close(){this._watcher&&this._watcher.close()}getDiagnostics(){const e=this._watcher?.getProgram();return e?this._options.typescript.getPreEmitDiagnostics(e.getProgram()):[]}async init(){if(this._watcher)return;const e=Date.now(),{typescript:r,compilerOptions:i,rootFiles:s,incremental:a,createTransformers:c,watchFile:f,reportFileName:g,reportDiagnostic:y,normalizeFileName:T,sourceMapCallback:h}=this._options;u.enabled&&r.performance.enable(r.sys);const x=o(this._options.inputDir);this._rootFiles=s.map(o);const N={...i,...p,incremental:a,tsBuildInfoFile:a&&this._options.cacheDir?n.resolve(this._options.cacheDir,".tsbuildInfo"):""};if(N.paths||(N.paths={}),N.paths["@/*"]=[x+"/*"],u.enabled)if(Object.keys(N.paths).length>200){const{paths:e,...t}=N;u("Compiler options:",t)}else u("Compiler options:",N);let S=!0;const b=new Map,E=r.sys.useCaseSensitiveFileNames?d:m,v={...r.sys,watchFile:(e,t,n,i)=>f?f(e,t,n,i):r.sys.watchFile(e,t,n,i),fileExists:e=>!!O(e,r),readFile:(e,t)=>r.sys.readFile(O(e,r),t)};let _;u.enabled&&u("rootFiles",this._rootFiles);const{parser:F,before:A,after:C,afterDeclarations:D}=c({getProgram:()=>_,shouldTransform:function(e){if(b.has(e))return!0;return e.startsWith(x)},normalizeFileName:T},{rootDir:o(N.rootDir||"")});globalThis.__utsParser__||(globalThis.__utsParser__=F),globalThis.__utsCustomParser__=F;const{watcher:k,helper:P}=function(){let e=0;const n=new l(r),i={excludeDirectories:["/**/*/"]};u.enabled&&u("watchOptions",i);const o=r.createWatchCompilerHost(s,N,v,r.createEmitAndSemanticDiagnosticsBuilderProgram,y,(function(i){u.enabled&&u("reportWatchStatusChanged",i,Date.now()-e,"ms"),i.category===r.DiagnosticCategory.Message&&(i.code===t.STARTING_COMPILATION_IN_WATCH_MODE||i.code===t.FILE_CHANGE_DETECTED?e=Date.now():i.code!==t.FOUND_1_ERROR_WATCHING_FOR_FILE_CHANGES&&i.code!==t.FOUND_N_ERRORS_WATCHING_FOR_FILE_CHANGES||(u.enabled&&u("Compilation completed in",Date.now()-e,"ms"),function(e,t){if(u.enabled){const r={Files:t.getSourceFiles().length,Identifiers:t.getIdentifierCount(),Symbols:t.getSymbolCount(),Types:t.getTypeCount(),Instantiations:t.getInstantiationCount(),"Memory used":Math.round((e.sys.getMemoryUsage?e.sys.getMemoryUsage():-1)/1e3/1e3)+"M",cache:t.getRelationCacheSizes()};e.performance.forEachMeasure(((e,t)=>{r[e]=t})),u.enabled&&u("performance:",r),e.performance.disable(),e.performance.enable(e.sys)}}(r,_)));n.handleStatus(i)}),void 0,i);const a=o.createProgram;o.createProgram=(e,t,r,n)=>{!function(e){const t=e.resolveModuleNameLiterals;e.resolveModuleNameLiterals=(e,r,n,i,s,o)=>{const a=t(e,r,n,i,s,o);return a.forEach((({resolvedModule:e})=>{if(e){const t=b.get(E(e.resolvedFileName));t&&(e.resolvedFileName=t)}})),a}}(r);const i=a(e,t,r,n);return function(e,t){_=t;const r=t.emit.bind(t);t.emit=(n,i,s,o,a)=>{a||(a={}),(a.before||(a.before=[])).push(...A),(a.after||(a.after=[])).push(...C),(a.afterDeclarations||(a.afterDeclarations=[])).push(...D);return r(n,((r,n,s,o,a,c)=>{if(i=i||e?.writeFile||t.writeFile,!(h&&r.endsWith(".map")&&h(r,n,((e,t)=>i(e,t,s,o,a,c)))))return i(r,n,s,o,a,c)}),s,o,a)}}(r,i.getProgram()),function(e){if(u.enabled){const t=e.getSourceFiles(),r=[],n=[],i=[];t.forEach((e=>{const{type:t,fileName:s}=g(e.fileName);"system"===t?r.push(s):"user"===t?n.push(s):i.push(s)})),S&&(S=!1,u("libs:",r.length),r.sort().forEach((e=>u("  ",e))),u("users:",n.length),n.sort().forEach((e=>u("  ",e))),u("others:",i.length),i.sort().forEach((e=>u("  ",e)))),u("sourceFiles",{total:t.length,libs:r.length,users:n,others:i.length})}}(i.getProgram()),i};const c=r.createWatchProgram(o);return{watcher:c,helper:n}}();return this._watcher=k,this._helper=P,void(u.enabled&&u("init",Date.now()-e));function O(e,t){const r=E(e),n=b.get(r);if(n)return n;let i=e.split("?",2)[0];const s=i.endsWith(".ts");if(!s){const e=i+".ts";if(t.sys.fileExists(e))return b.set(r,e),i}if(t.sys.fileExists(i))return b.set(r,i),i;if(s){const e=i.slice(0,-3),n=[".uvue.ts",".uts.ts",".vue.ts"];for(const i of n){const n=e+i;if(t.sys.fileExists(n))return b.set(r,n),n}}}}}function d(e){return e}function g(e){return e.toLowerCase()}const y=/[^\u0130\u0131\u00DFa-z0-9\\/:\-_. ]+/g;function m(e){return y.test(e)?e.replace(y,g):e}class T{addAutoImport(e){this.autoImports.some((t=>t.fileName===e.fileName&&t.name===e.name&&t.localName===e.localName))||this.autoImports.push(e)}constructor(e,t,r,n,i,s){this.currentNode=e,this.currentSourceFile=t,this.checker=r,this.context=n,this.ts=i,this.autoImports=s}static updateSourceFile(e,t,r,n){if(0===e.length)return t;const i=[];for(let t=0;t<e.length;t++){const n=e[t],s=r.createImportDeclaration(void 0,r.createImportClause(!1,void 0,r.createNamedImports([r.createImportSpecifier(!1,r.createIdentifier(n.localName),r.createIdentifier(n.name))])),r.createStringLiteral(n.fileName));i.push(s)}const s=t.statements.findIndex((e=>!n.isImportDeclaration(e)))??t.statements.length,o=[...t.statements.slice(0,s),...i,...t.statements.slice(s)];return r.updateSourceFile(t,o,t.isDeclarationFile,t.referencedFiles,t.typeReferenceDirectives,t.hasNoDefaultLib,t.libReferenceDirectives)}visitTypeNode(e){const t=this.ts.visitEachChild(e,(e=>this.visitTypeNode(e)),this.context);if(this.ts.isImportTypeNode(t)){const e=t.qualifier;if(e){const r=e.symbol,n=r.declarations&&r.declarations[0];if(n){const r=n.getSourceFile().fileName,i=e.escapedText,s=ts.getUniqueName(i,this.currentSourceFile);if(i&&s)return this.addAutoImport({fileName:r,name:i,localName:s}),this.context.factory.createTypeReferenceNode(s,t.typeArguments)}}}else if(this.ts.isIdentifier(t)){const e=t.symbol;if(this.checker.isSymbolAccessible(e,this.currentNode,this.ts.SymbolFlags.Type,!0).accessibility===this.ts.SymbolAccessibility.CannotBeNamed)throw new Error(`Type '${t.getText()}' is not accessible in the current context.`)}return t}}function h(e){return e.endsWith(".uts.ts")?e.replace(/\.uts\.ts$/,""):e.replace(/\.\w+$/,"")}function x(e,t,r,n){return i=>{const s=r(i);return r=>{const o=e.isSourceFile(r);return i.fileName||o&&(i.fileName=r.fileName),t.shouldTransform(i.fileName)?(o&&!r.isUTSFile&&(r.isUTSFile=!0,t.isVueFile?.(i.fileName)&&(r.isVueFile=!0)),o&&"parser"===n&&r.statements.length&&(r.statements[0].parent||e.setParentRecursive(r,!0)),s(r)):r}}}function N(e,t){return t&&t!==e&&!Array.isArray(t)&&(t.__parsedByUtsParser=!0,t.parent=e.parent),t}let S;function b(e,t,r){return function(e){if(!e.ObjectFlags.UTSType){const{Class:t,Interface:r,Reference:n,Anonymous:i,ArrayLiteral:s}=e.ObjectFlags;e.ObjectFlags.UTSType=t|r|n|i|s}if(!e.TypeFlags.UTSType){const{Any:t,String:r,Number:n,Boolean:i,Enum:s,StringLiteral:o,NumberLiteral:a,BooleanLiteral:c,EnumLiteral:l,Void:u,Null:p,Object:f,Union:d,TemplateLiteral:g}=e.TypeFlags;e.TypeFlags.UTSType=t|r|n|i|s|o|a|c|l|u|p|f|d|g,e.TypeFlags.UTSStringLike=r|o|g,e.TypeFlags.UTSNumberLike=n|a}}(e),n=>{const i={},s=[],o=[],a=[];return t.forEach((t=>{let c=t(e,n,r);if("function"==typeof c)s.push(x(e,n,c,"before"));else{if(c.parser){const s=t(function(e){if(S)return S;S={...e};const{visitNode:t,visitEachChild:r}=e;return S.visitNode=(e,r)=>t(e,(e=>N(e,r(e)))),S.visitEachChild=(e,t,n)=>r(e,(e=>N(e,t(e))),n),S}(e),n,r);s.parser&&function(e,t,r,n){n.TypeAliasDeclaration&&(r.TypeAliasDeclaration||(r.TypeAliasDeclaration=[])).push(x(e,t,(e=>{const t=n.TypeAliasDeclaration(e);return e=>N(e,t(e))}),"parser")),n.SourceFile&&(r.SourceFile||(r.SourceFile=[])).push(x(e,t,n.SourceFile,"parser"))}(e,n,i,s.parser)}c.before&&s.push(x(e,n,c.before,"before")),c.after&&o.push(x(e,n,c.after,"after")),c.afterDeclarations&&a.push(x(e,n,c.afterDeclarations,"afterDeclarations"))}})),{parser:i,before:s,after:o,afterDeclarations:a}}}function E(e,t,r){if(r.flags&e.TypeFlags.TypeParameter)return!0;if(r.isUnion()){if(r.types.length>2)return!1;if(r===t.getBooleanType())return!0;const n=t.getNullType(),i=r.types[0],s=r.types[1];return i===n&&E(e,t,s)||s===n&&E(e,t,i)}return r.flags&e.TypeFlags.Object?!!(r.objectFlags&e.ObjectFlags.UTSType):!!(r.flags&e.TypeFlags.UTSType)}function v(e,t,r){const n=e.getOriginalNode(r);return e.isExpression(n)?t.getContextualType(n):void 0}function _(e,t){return e.getContextualType(t)??e.getTypeAtLocation(t)}function F(e,t){return t?e.getNonNullableType(t):t}function A(e,t){return t.flags&e.TypeFlags.Object&&t.objectFlags&e.ObjectFlags.Anonymous&&!t.aliasSymbol&&0===t.getCallSignatures().length}function C(e,t){if(e.symbol&&e.aliasSymbol&&e.aliasSymbol.flags&t.SymbolFlags.TypeAlias&&1===e.aliasSymbol.declarations?.length){const r=e.aliasSymbol.declarations[0];if(t.isTypeAliasDeclaration(r)&&t.isTypeLiteralNode(r.type)&&r.type.members.every((e=>t.isPropertySignature(e)||t.isCallSignatureDeclaration(e))))return!0}return!1}function D(e,t,r){const n=e.getOriginalNode(r).parent;if(n&&e.isObjectLiteralExpression(n)&&e.isIdentifier(r.name)){const e=t.getContextualType(n);if(e){const n=e.getProperty(r.name.text);if(n)return t.getTypeOfSymbol(n)}}}function k(e,t,r){return e===r.getErrorType?.()||!!(e.flags&t.TypeFlags.Any&&e.aliasSymbol)}function P(e,t,r){return e.flags&t.TypeFlags.UTSNumberLike||e===(r.getUTSNumberType||r.getNumberType)?.()}function O(e,t){return t.map((t=>e.isIdentifier(t.name)?t.name.text:t.name)).join(", ")}function L(e,t){return!!t.isImportTypeNode(e)||(t.forEachChild(e,(e=>L(e,t)))||!1)}function w(e,t,r,n){const i=function(e,t){for(t=e.getOriginalNode(t);;){if(!(t=t.parent))return;switch((t=e.getOriginalNode(t)).kind){case e.SyntaxKind.SourceFile:case e.SyntaxKind.MethodDeclaration:case e.SyntaxKind.MethodSignature:case e.SyntaxKind.FunctionDeclaration:case e.SyntaxKind.FunctionExpression:case e.SyntaxKind.GetAccessor:case e.SyntaxKind.SetAccessor:case e.SyntaxKind.ClassDeclaration:case e.SyntaxKind.InterfaceDeclaration:case e.SyntaxKind.EnumDeclaration:case e.SyntaxKind.ModuleDeclaration:return t}}}(r,t);let s=n.typeToTypeNode(e,i,r.NodeBuilderFlags.None);if(!s&&i&&(s=n.typeToTypeNode(e,void 0,r.NodeBuilderFlags.None)),s)return L(s,r)?n.typeToTypeNode(e,void 0,r.NodeBuilderFlags.None):s}r("uts:transformer:importAndExportDeclaration");const I=r("uts:transformer:autoImport");function U(e,t,r){const n=new Map;r.statements.forEach((r=>{if(!e.isImportDeclaration(r))return;const i=r.importClause;if(!i)return;const{name:s,namedBindings:a}=i;a&&e.isNamedImports(a)&&a.elements.forEach((e=>{const r=t.getSymbolAtLocation(e.name);if(r){const i=function(e){const{declarations:t}=e;if(!t||1!==t.length)return;return h(o(t[0].getSourceFile().fileName))}(t.getAliasedSymbol(r));if(!i)return;n.has(i)||n.set(i,{}),n.get(i)[e.name.text]=e.propertyName?.text??e.name.text}}))})),r.__imports=n}function K(e,t,r,i,s,a){let{aliasSymbol:c}=F(r,i);if(!c)return;const l=function(e,t,r){if(t.declarations)for(const n of t.declarations){const t=n.getSourceFile();if(t.isDeclarationFile)return;if(t===r||t.fileName===r.fileName)return;if(e.isModuleDeclaration(n))return;return h(o(t.fileName))}}(e,c,s);if(!l)return;const{factory:u}=e,p=c.getName();s.__imports||U(e,r,s);const f=s.__imports;if(f.has(l)){const e=f.get(l);if(e[p])return u.createTypeReferenceNode(e[p])}const d=function(e,t,r){let n=e.getUniqueName(t,r);r.__uniqueNames||(r.__uniqueNames=[]);let i=1;for(;r.__uniqueNames.includes(n);)n=`${t}_${i}`,i++;return r.__uniqueNames.push(n),n}(e,p,s);let g=l;const y=s.__rootDir;if(y&&l.startsWith(y)){const e=h(o(s.fileName));e.startsWith(y)&&(g=t.normalizeFileName(n.relative(n.dirname(e),l)),g=g.startsWith(".")?g:"./"+g)}const m=u.createImportDeclaration(void 0,u.createImportClause(!1,void 0,u.createNamedImports([u.createImportSpecifier(!1,d!==p?u.createIdentifier(p):void 0,u.createIdentifier(d))])),u.createStringLiteral(g),void 0);return I.enabled&&I(`import { ${p} as ${d} } from '${g}'`,"at",s.__relativeFileName),a.set(c,m),f.has(l)||f.set(l,{}),f.get(l)[p]=d,d!==p?u.createTypeReferenceNode(d):void 0}function R(e,t){return t.flags===e.TypeFlags.Null||t.flags===e.TypeFlags.Undefined}function $(e,t){return t.getNonNullableType(e)!==e}function M(e,t,r,n=!1){if(r.isStringLiteral())return function(e){j||(j=e.factory.createKeywordTypeNode(e.SyntaxKind.StringKeyword));return j}(e);if(r.isNumberLiteral())return J(e);if(r.flags&e.TypeFlags.BooleanLiteral)return function(e){B||(B=e.factory.createKeywordTypeNode(e.SyntaxKind.BooleanKeyword));return B}(e);if(r.isUnion()){const i=t.getNonNullableType(r);if(i.isUnion()){if(n)return t.typeToTypeNode(r,void 0,void 0);const s=i.types;if(s.length){let i=s[0];for(let t=1;t<s.length;t++)if(s[t].flags!==i.flags)return s.length!==r.types.length?e.factory.createUnionTypeNode([e.factory.createKeywordTypeNode(e.SyntaxKind.AnyKeyword),V(e)]):e.factory.createKeywordTypeNode(e.SyntaxKind.AnyKeyword);if(s.length===r.types.length)return M(e,t,i,n);{const r=M(e,t,i,n);if(r)return e.factory.createUnionTypeNode([r,V(e)])}}}else{const r=M(e,t,i,n);if(r)return e.factory.createUnionTypeNode([r,V(e)])}}}let q,j,G,B,W;function z(e){return W||(W=e.factory.createKeywordTypeNode(e.SyntaxKind.AnyKeyword)),W}function H(e,t){return t.factory.createUnionTypeNode([e,V(t)])}function V(e){return q||(q=e.factory.createLiteralTypeNode(e.factory.createNull())),q}function J(e){return G||(G=e.factory.createKeywordTypeNode(e.SyntaxKind.NumberKeyword)),G}function X(e,t,r,n){if(R(e,r)&&function(e,t){return t.flags&(e.TypeFlags.Null|e.TypeFlags.Undefined)}(e,n))return!0;if(t&&t.getGlobalType&&!t.getUTSJSONObjectType){const e=t.getGlobalType("UTSJSONObject",0,!0);t.getUTSJSONObjectType=()=>e;const r=t.getGlobalType("String",0,!0);t.getUTSStringType=()=>r;const n=t.getGlobalType("Number",0,!0);t.getUTSNumberType=()=>n}const i=t.getUTSJSONObjectType?.();if(i){const s=t.getNonNullableType(n);if(A(e,r)&&s===i||A(e,n)&&r===i)return!0}}const Q={isRelatedTo:X,isTypeRelatedTo:function(e,t,r,n){return X(e,t,r,n)},useTypeAndInterfaceAsValue:!0},Y=r("uts:transformer:arguments"),Z=(e,t,r)=>{const n=r.transformArguments?.shouldTransform??(()=>!0);return{before(i){const s=t.getProgram().getTypeChecker(),{factory:o}=i,a=new Map;let c;const l=t=>{const a=e.visitEachChild(t,l,i);if(e.isMethodDeclaration(a)){const t=F(s,D(e,s,a));if(t){if(!n(a,t,s))return a;const r=t.getCallSignatures();if(r&&r.length){const t=te(e,o,r,a.parameters);if(t){if(Y.enabled){const r=e.getOriginalNode(a);Y("method:",`${r.name.getText()}(${O(e,t)}) at ${c.__relativeFileName}`)}return o.updateMethodDeclaration(a,a.modifiers,a.asteriskToken,a.name,a.questionToken,a.typeParameters,t,a.type,a.body)}}}}else if(e.isArrowFunction(a)){const t=F(s,_(s,a));if(t.isUnion())return a;if(!n(a,t,s))return a;const r=t.getCallSignatures();if(r&&r.length){const t=te(e,o,r,a.parameters);if(t)return Y.enabled&&Y("arrow function:",`(${O(e,t)}) at ${c.__relativeFileName}`),o.updateArrowFunction(a,a.modifiers,a.typeParameters,t,a.type,a.equalsGreaterThanToken,a.body)}}else if(e.isFunctionExpression(a)){const t=F(s,_(s,a));if(t.isUnion())return a;if(!n(a,t,s))return a;const r=t.getCallSignatures();if(r&&r.length){const t=te(e,o,r,a.parameters);if(t)return Y.enabled&&Y("function expression:",`(${O(e,t)}) at ${c.__relativeFileName}`),o.updateFunctionExpression(a,a.modifiers,a.asteriskToken,a.name,a.typeParameters,t,a.type,a.body)}}else if(("Kotlin"===r.targetLanguage||"Swift"===r.targetLanguage)&&e.isCallExpression(a)&&0===a.arguments.length){const t=F(s,_(s,a.expression)).getCallSignatures();if(t&&1===t.length){const r=t[0].parameters;if(1===r.length){if(ee(s.getTypeOfSymbol(r[0]),e))return o.updateCallExpression(a,a.expression,a.typeArguments,o.createNodeArray([o.createVoidExpression(o.createNumericLiteral(0))]))}}}return a};return t=>{c=t;const r=e.visitNode(t,l);return 0===a.size?r:o.updateSourceFile(r,[...a.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function ee(e,t){return!!(e.flags&t.TypeFlags.Void)||e.isUnion()&&e.types.some((e=>ee(e,t)))}function te(e,t,r,n){let i;const s=n.length;for(const e of r){if(e.parameters.length===s)return;e.parameters.length>s&&(!i||e.parameters.length<i.parameters.length)&&(i=e)}if(!i)return;const o=[];for(const t of i.parameters){if(!t.valueDeclaration)return;if(!e.isParameter(t.valueDeclaration))return;if(t.valueDeclaration.questionToken||t.valueDeclaration.dotDotDotToken)break;o.push(t)}const a=o.length-s;if(a<=0)return;const c=[];for(let e=0;e<a;e++)c.push(t.createParameterDeclaration(void 0,void 0,t.createIdentifier(`_${i.parameters[e+s].name}`),void 0,void 0,void 0));return t.createNodeArray([...n,...c])}const re=(e,t)=>{function r(t,r){if(e.isSourceFile(r)){if(!r.__relativeFileName){const e=t.getCompilerOptions();if(e.rootDir&&n.isAbsolute(e.rootDir)){const t=o(e.rootDir),i=o(r.fileName);r.__rootDir=t,i.startsWith(t)?r.__relativeFileName=o(n.relative(t,i)):i.includes("/@dcloudio/")&&(r.__relativeFileName="@dcloudio/"+i.split("/@dcloudio/")[1])}r.__relativeFileName||(r.__relativeFileName=n.basename(r.fileName))}if(!t.printNode){const r=e.createPrinter();t.printNode=(t,n)=>r.printNode(e.EmitHint.Unspecified,t,n)}t.addBindDiagnostic||(t.addBindDiagnostic=e=>{r.bindDiagnostics.push(e)},t.addBindSuggestionDiagnostic=e=>{r.bindSuggestionDiagnostics||(r.bindSuggestionDiagnostics=[]),r.bindSuggestionDiagnostics.push(e)})}return r}return{before:e=>t=>r(e,t),after:e=>t=>r(e,t),afterDeclarations:e=>t=>r(e,t)}},ne=r("uts:transformer:generics"),ie=(e,t,r)=>{const n=r.transformGenericsParameterDefaults?.shouldTransform??(()=>!0);return{before(r){const i=t.getProgram().getTypeChecker(),{factory:s}=r,o=new Map;let a;const c=l=>{const u=e.visitEachChild(l,c,r);if(e.isTypeReferenceNode(u)){const c=i.getTypeAtLocation(u),l=c.aliasSymbol;if(l&&l.flags&e.SymbolFlags.TypeAlias&&!c.aliasTypeArguments)return u;if(c.resolvedTypeArguments||c.mapper||c.aliasTypeArguments){if(!n(u,c,i,r))return u;const l=se(u,c.resolvedTypeArguments||function(e){if(!e)return;if(0===e.kind)return[e.target];if(1===e.kind)return e.targets;if(2===e.kind)return e.targets.map((e=>e()))}(c.mapper)||c.aliasTypeArguments,e,i);if(l){if(l.newTypes.forEach((r=>K(e,t,i,r,a,o))),ne.enabled){const t=e.getOriginalNode(u);ne(t.getText(),`${i.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return s.updateTypeReferenceNode(u,u.typeName,l.newTypeArguments)}}}else if(e.isExpressionWithTypeArguments(u)){const c=i.getTypeFromTypeNode(u);if(function(e,t){return!!(function(e,t){return e.flags&t.TypeFlags.Object?e.objectFlags:0}(e,t)&t.ObjectFlags.Reference)}(c,e)&&c.resolvedTypeArguments?.length){if(!n(u,c,i,r))return u;const l=se(u,c.resolvedTypeArguments,e,i);if(l){if(l.newTypes.forEach((r=>K(e,t,i,r,a,o))),ne.enabled){const t=e.getOriginalNode(u);ne(t.getText(),`${i.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return s.updateExpressionWithTypeArguments(u,u.expression,l.newTypeArguments)}}}else if(e.isNewExpression(u)){const c=i.getTypeAtLocation(u),l=c.resolvedTypeArguments;if(Array.isArray(l)&&l.length){if(!n(u,c,i,r))return u;const p=se(u,l,e,i);if(p){if(p.newTypes.forEach((r=>K(e,t,i,r,a,o))),ne.enabled){const t=e.getOriginalNode(u);ne(t.getText(),`${i.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return s.updateNewExpression(u,u.expression,p.newTypeArguments,u.arguments)}}}else e.isCallExpression(u);return u};return t=>{a=t;const r=e.visitNode(t,c);return 0===o.size?r:s.updateSourceFile(r,[...o.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function se(e,t,r,n){const i=e.typeArguments?.length??0;if(t.length===i)return;const s=e.typeArguments??[],o=t.slice(s.length);return{newTypeArguments:r.factory.createNodeArray([...s,...o.map((t=>w(t,e,r,n)))]),newTypes:o}}const oe=r("uts:transformer:in"),ae=(e,t,r)=>({before(n){const i=t.getProgram().getTypeChecker(),{factory:s}=n,o=t=>{const a=e.visitEachChild(t,o,n);if(e.isBinaryExpression(a)&&a.operatorToken.kind===e.SyntaxKind.InKeyword){if(oe.enabled){const t=e.getOriginalNode(a);oe("transformIn",t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}const t=[];if("ArkTS"===r.targetLanguage){const r=i.getTypeAtLocation(a.left);if(r.isStringLiteral()||r.isNumberLiteral()){const n=i.getNonNullableType(i.getTypeAtLocation(a.right));if(n.isUnion()){const s=i.narrowTypeByInKeyword(n,r,!0);if(s!==n){const r=w(s,a,e,i);r&&t.push(r)}}}}return s.createCallExpression(s.createIdentifier("resolveInOperator"),t,[a.right,a.left])}return a};return t=>e.visitNode(t,o)}}),ce=r("uts:transformer:keyof"),le=(e,t,r)=>{const n=r.transformKeyof?.shouldTransform??(()=>!0);return{before(r){const i=t.getProgram().getTypeChecker(),{factory:s}=r,o=t=>{const a=e.visitEachChild(t,o,r);if(e.isTypeOperatorNode(a)&&a.operator===e.SyntaxKind.KeyOfKeyword){const t=i.getTypeAtLocation(a);if(!n(a,t,i,r))return a;if(t.isUnion()){const r=t.types.map((e=>e.isStringLiteral()||e.isNumberLiteral()?e.value:void 0)).filter((e=>void 0!==e));if(ce.enabled){const r=e.getOriginalNode(a);ce(r.getText(),`${i.typeToString(t)} at ${r.getSourceFile().__relativeFileName}`)}return s.createUnionTypeNode(r.map((e=>s.createLiteralTypeNode("string"==typeof e?s.createStringLiteral(e):s.createNumericLiteral(e)))))}if(t.isStringLiteral()){if(ce.enabled){const r=e.getOriginalNode(a);ce(r.getText(),`${i.typeToString(t)} at ${r.getSourceFile().__relativeFileName}`)}return s.createLiteralTypeNode(s.createStringLiteral(t.value))}if(t.isNumberLiteral()){if(ce.enabled){const r=e.getOriginalNode(a);ce(r.getText(),`${i.typeToString(t)} at ${r.getSourceFile().__relativeFileName}`)}return s.createLiteralTypeNode(s.createNumericLiteral(t.value))}}return a};return t=>e.visitNode(t,o)}}};function ue(e,t,r){const n=r.getNonNullableType(e);return!!n.isUnion()&&(!(n.types.length<=1)&&n.types.every((e=>C(e,t))))}function pe(e,t,r){const n=r.getNonNullableType(e);if(!n.isUnion())return;if(n.types.length<=1)return;if(!n.types.every((e=>e.flags&t.TypeFlags.Object&&void 0!==e.aliasSymbol)))return;const i=n.types[0],s=r.getPropertiesOfType(i);for(const e of s){let i,s=!0;for(const o of n.types){const n=r.getPropertyOfType(o,e.escapedName);if(!n){s=!1;break}const a=r.getTypeOfSymbol(n);if(fe(a,t))i="string";else{if(!de(a,t)){s=!1;break}i="number"}}if(s&&i)return{name:e.name,type:i}}}function fe(e,t){return!!(e.flags&t.TypeFlags.StringLiteral)||!!e.isUnion()&&e.types.every((e=>fe(e,t)))}function de(e,t){return!!(e.flags&t.TypeFlags.NumberLiteral)||!!e.isUnion()&&e.types.every((e=>de(e,t)))}const ge=r("uts:transformer:narrowType:discriminatedUnion"),ye=(e,t,r)=>({before(n){const i=t.getProgram().getTypeChecker(),{factory:s}=n,o=t=>{const a=e.visitEachChild(t,o,n);if(e.isTypeAliasDeclaration(a)&&e.isUnionTypeNode(a.type)){if(a.type.types.every((t=>e.isTypeReferenceNode(t)))){const t=i.getTypeAtLocation(a.type);if(t.isUnion()){if(pe(t,e,i)){if(ge.enabled){const t=e.getOriginalNode(a);ge(`type ${t.name.getText()} = UTSUnionTypeObject`,` at ${t.getSourceFile().__relativeFileName}`)}return s.updateTypeAliasDeclaration(a,a.modifiers,a.name,a.typeParameters,s.createTypeReferenceNode(s.createIdentifier("UTSUnionTypeObject"),void 0))}}}}else if(e.isPropertyAccessExpression(t)&&e.isIdentifier(t.expression)){const n=i.getTypeAtLocation(t.name);if(n.isUnion()){const o=i.getNonNullableType(n);if(o.isUnion()&&o.types.every((e=>e.isStringLiteral()||e.isNumberLiteral()))){const n=i.getTypeAtLocation(t.expression);if(n.isUnion()){const o=pe(n,e,i);if(o&&o.name===t.name.text){const n=[t.expression,s.createStringLiteral(t.name.text)];"Swift"===r.targetLanguage&&n.push(s.createPropertyAccessExpression(s.createIdentifier("String"),s.createIdentifier("self")));const i="Swift"===r.targetLanguage?void 0:[s.createKeywordTypeNode("string"===o.type?e.SyntaxKind.StringKeyword:e.SyntaxKind.NumberKeyword)];return s.createCallExpression(s.createIdentifier("resolveUTSObjectProperty"),i,n)}}}}}return a};return t=>e.visitNode(t,o)}}),me=r("uts:transformer:narrowType:nonNullable");function Te(e,t){const r=e.parent;return!!r&&(!!t.isExpression(e)&&(!t.isNonNullExpression(r)&&(!t.isAsExpression(r)&&((!t.isBinaryExpression(r)||r.operatorToken.kind!==t.SyntaxKind.InstanceOfKeyword||r.left!==e&&r.right!==e)&&((!t.isTypeOfExpression(r)||r.expression!==e)&&((!t.isPropertyAccessExpression(r)||r.name!==e)&&((!t.isPropertyAccessChain(r)||r.name!==e)&&(!(t.isFunctionDeclaration(e)||t.isArrowFunction(e)||t.isFunctionExpression(e)||t.isClassDeclaration(e)||t.isInterfaceDeclaration(e)||t.isTypeAliasDeclaration(e)||t.isTypeLiteralNode(e)||t.isTypeOfExpression(e))&&(!(t.isTypeAliasDeclaration(r)||t.isInterfaceDeclaration(r)||t.isPropertySignature(r)||t.isMethodSignature(r)||t.isFunctionDeclaration(r)||t.isTypeOfExpression(r))&&((!t.isParameter(r)||r.name!==e)&&((!t.isVariableDeclaration(r)||r.name!==e)&&((!t.isPropertyAssignment(r)||r.name!==e)&&((!t.isBinaryExpression(r)||r.left!==e||r.operatorToken.kind!==t.SyntaxKind.EqualsToken)&&(!!(t.isIdentifier(e)||t.isPropertyAccessExpression(e)||t.isElementAccessExpression(e)||t.isNonNullExpression(e)||t.isParenthesizedExpression(e)||t.isPropertyAccessChain(e)||t.isElementAccessChain(e)||t.isCallExpression(e))&&he(e,t)))))))))))))))}function he(e,t){return xe(e,t)||(t.isPropertyAccessExpression(e)||t.isNonNullExpression(e)||t.isParenthesizedExpression(e))&&he(e.expression,t)||t.isBinaryExpression(e)&&e.operatorToken.kind===t.SyntaxKind.CommaToken&&he(e.right,t)||t.isElementAccessExpression(e)&&(t.isStringLiteral(e.argumentExpression)||t.isNumericLiteral(e.argumentExpression))&&he(e.expression,t)||function(e,t){return t.isBinaryExpression(e)&&function(e,t){return e>=t.SyntaxKind.FirstAssignment&&e<=t.SyntaxKind.LastAssignment}(e.operatorToken.kind,t)&&t.isLeftHandSideExpression(e.left)}(e,t)&&he(e.left,t)}function xe(e,t){return e.kind===t.SyntaxKind.Identifier||e.kind===t.SyntaxKind.ThisKeyword||e.kind===t.SyntaxKind.SuperKeyword||e.kind===t.SyntaxKind.MetaProperty||e.kind===t.SyntaxKind.PropertyAccessExpression&&xe(e.expression,t)||e.kind===t.SyntaxKind.ParenthesizedExpression&&xe(e.expression,t)}function Ne(e,t,r,n){let i=n.getSymbolAtLocation(e);if(!i&&r.isNonNullExpression(e)&&(i=n.getSymbolAtLocation(e.expression)),i){const s=n.getTypeOfSymbol(i),o=n.getTypeAtLocation(e);if(o===s)return;const a=n.getNonNullableType(s),c=n.getNonNullableType(o),l=n.getAnyType();if(l===c)return;const u=a===c&&a!==s&&c===o&&t(e,n);if(r.isExpression(e)){const t=n.getContextualType(e);if(t){if(t.flags===r.TypeFlags.Unknown)return;const e=n.getNonNullableType(t);if(l===e)return;if(u&&e===a&&e!==t)return}}if(u||a!==c&&function(e,t,r){if(k(e,t,r))return!1;if(e=r.getNonNullableType(e),e===r.getAnyType())return!0;if(e.isUnion()&&Se(e,t))return!0;return!1}(s,r,n)){if(c.isLiteral()&&n.getApparentType(c)===n.getApparentType(a))return;if(u&&me.enabled){const t=r.getOriginalNode(e);me(t.getText(),`as ${n.typeToString(c)} at ${t.getSourceFile().__relativeFileName}`)}return{narrowedType:c,isNarrowNonNullable:u}}}}function Se(e,t){const r=e.types.filter((e=>!R(t,e)&&(!e.symbol||"UTSObjectMarker"!==e.symbol.escapedName))),n=r.length;if(n<=1)return!1;const i=r[0];if(i.isLiteral()||i.flags===t.TypeFlags.BooleanLiteral){const e=i.flags;for(let t=1;t<n;t++)if(r[t].flags!==e)return!0;return!1}return!0}const be=r("uts:transformer:narrowType"),Ee=(e,t,r)=>{const n=r.transformNarrowType?.shouldTransformNonNullable??(()=>!1);return{before(i){const s=t.getProgram().getTypeChecker(),{factory:o}=i,a=new Map;let c;const l=u=>{const p=e.visitEachChild(u,l,i);if(Te(u,e)){const l=Ne(u,n,e,s);if(l){const{narrowedType:n,isNarrowNonNullable:f}=l;if(f&&"Swift"===r.targetLanguage&&!function(e,t,r,n){let i=e.parent;if(i&&r.isConditionalExpression(i)){let e,s;for(i=i.parent;i;){if(r.isVariableDeclaration(i)&&r.isIdentifier(i.name)){if(e=n.getSymbolAtLocation(i.name),e)for(i=i.parent;i;){if(r.isVariableStatement(i)){s=i.parent;break}i=i.parent}break}i=i.parent}if(e&&s){let i=!1;const o=s=>!i&&r.isNonNullExpression(s)&&r.isIdentifier(s.expression)&&n.getSymbolAtLocation(s.expression)===e?(i=!0,s):r.visitEachChild(s,o,t);if(r.visitEachChild(s,o,t),i)return!1}}return!0}(u,i,e,s))return p;if(f&&e.isExpression(p)&&"Swift"!==r.targetLanguage)return o.createNonNullExpression(p);const d=function(e,t,r,n){const i=M(r,n,t);return i||(E(r,n,t)?w(t,e,r,n):void 0)}(u,n,e,s);if(d){if(K(e,t,s,n,c,a),be.enabled){const t=e.getOriginalNode(u);be(t.getText(),`as ${s.typeToString(n)} at ${t.getSourceFile().__relativeFileName}`)}return o.createAsExpression(p,d)}}}return p};return t=>{c=t;const r=e.visitNode(t,l);return 0===a.size?r:o.updateSourceFile(r,[...a.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};const ve=r("uts:transformer:narrowType:parameterUnionType"),_e=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isFunctionDeclaration(t)){const r=Fe("modifier",t.parameters,e,n);if(r){if(ve.enabled){const r=e.getOriginalNode(t);ve(`function ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return i.updateFunctionDeclaration(t,t.modifiers,t.asteriskToken,t.name,t.typeParameters,r,t.type,t.body)}}else if(e.isMethodDeclaration(t)){const r=Fe("modifier",t.parameters,e,n);if(r){if(ve.enabled){const r=e.getOriginalNode(t);ve(`method ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return i.updateMethodDeclaration(t,t.modifiers,t.asteriskToken,t.name,t.questionToken,t.typeParameters,r,t.type,t.body)}}else if(e.isConstructorDeclaration(t)){const r=Fe("modifier",t.parameters,e,n);if(r){if(ve.enabled){const r=e.getOriginalNode(t);ve(`constructor ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return i.updateConstructorDeclaration(t,t.modifiers,r,t.body)}}else if(e.isMethodSignature(t)){const r=Fe("type",t.parameters,e,n);if(r){if(ve.enabled){const r=e.getOriginalNode(t);ve(`method signature ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return i.updateMethodSignature(t,t.modifiers,t.name,t.questionToken,t.typeParameters,r,t.type)}}else if(e.isFunctionTypeNode(t)){const r=Fe("type",t.parameters,e,n);if(r){if(ve.enabled){const r=e.getOriginalNode(t);ve(`function type ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return i.updateFunctionTypeNode(t,t.typeParameters,r,t.type)}}else if(e.isArrowFunction(t)){const r=Fe("type",t.parameters,e,n);if(r){if(ve.enabled){const r=e.getOriginalNode(t);ve(`arrow function ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return i.updateArrowFunction(t,t.modifiers,t.typeParameters,r,t.type,t.equalsGreaterThanToken,t.body)}}else if(e.isFunctionExpression(t)){const r=Fe("type",t.parameters,e,n);if(r){if(ve.enabled){const r=e.getOriginalNode(t);ve(`function expression ${r.name?.getText()}()`,`at ${r.getSourceFile().__relativeFileName}`)}return i.updateFunctionExpression(t,t.modifiers,t.asteriskToken,t.name,t.typeParameters,r,t.type,t.body)}}return o};return t=>e.visitNode(t,s)}});function Fe(e,t,r,n){const{factory:i}=r,s=new Map;if(t.forEach(((t,o)=>{if(t.type){const a=n.getTypeAtLocation(t.type);if(a.isUnion()&&Se(a,r)){let c=!1;const l=e=>{r.isTypeReferenceNode(e)?c=!0:r.forEachChild(e,l)};if(l(t.type),c){if(pe(a,r,n)){if("modifier"===e)s.set(o,{addModifier:!0});else{const e=i.createTypeReferenceNode("UTSUnionTypeObject",[]);s.set(o,{addModifier:!1,type:$(a,n)?H(e,r):e})}return}const c=function(e,t,r,n){const i=[];for(const s of e){const e=w(s,n,t,r);if(!e)return;if(t.isTypeLiteralNode(e))return;i.push(e)}return t.factory.createUnionTypeNode(i)}(a.types,r,n,t);if(c)if("modifier"===e)s.set(o,{type:c,addModifier:ue(a,r,n)});else if(ue(a,r,n)){const e=i.createTypeReferenceNode("UTSUnionTypeObject",[]);s.set(o,{addModifier:!1,type:$(a,n)?H(e,r):e})}}}}})),s.size>0){const e=[];return t.forEach(((t,r)=>{if(s.has(r)){const{type:n,addModifier:o}=s.get(r),a=[];o&&a.push(i.createDecorator(i.createIdentifier("UTSUnionTypeObject"))),e.push(i.updateParameterDeclaration(t,a.length>0?[...t.modifiers??[],...a]:t.modifiers,t.dotDotDotToken,t.name,t.questionToken,n??t.type,t.initializer))}else e.push(t)})),i.createNodeArray(e)}}const Ae=r("uts:transformer:UTSObjectUnionType"),Ce=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isUnionTypeNode(o)){if(o.parent&&e.isParameter(o.parent))return o;const t=n.getTypeAtLocation(o);if(t.isUnion()&&ue(t,e,n)){const t=o.types.some((t=>e.isLiteralTypeNode(t)&&t.literal.kind===e.SyntaxKind.NullKeyword));if(Ae.enabled){const t=e.getOriginalNode(o);Ae(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return t?i.createUnionTypeNode([i.createTypeReferenceNode("UTSUnionTypeObject"),i.createLiteralTypeNode(i.createNull())]):i.createTypeReferenceNode("UTSUnionTypeObject")}}return o};return t=>e.visitNode(t,s)}}),De=e=>({parser:{SourceFile(t){const r=t=>{t.forEachChild(r);t.parent&&e.isBinaryExpression(t)&&(t.left.kind!==e.SyntaxKind.NullKeyword&&t.right.kind!==e.SyntaxKind.NullKeyword||(t.operatorToken.kind===e.SyntaxKind.EqualsEqualsEqualsToken?t.operatorToken.kind=e.SyntaxKind.EqualsEqualsToken:t.operatorToken.kind===e.SyntaxKind.ExclamationEqualsEqualsToken&&(t.operatorToken.kind=e.SyntaxKind.ExclamationEqualsToken)))};return e=>(e.forEachChild(r),e)}}});function ke(e,t){return e.isObjectLiteralExpression(t)||e.isArrayLiteralExpression(t)||e.isAsExpression(t)||e.isPropertyAssignment(t)}function Pe(e){return"UTSJSONObject"===e.symbol?.name||e.isUnionOrIntersection()&&e.types.some((e=>Pe(e)))}const Oe=r("uts:transformer:objectLiteral"),Le=(e,t,r)=>{const n=r?.transformObjectLiteral?.shouldTransformAsExpression??(()=>!0),i="ArkTS"===r.targetLanguage,s="Swift"===r.targetLanguage;return{parser:{SourceFile(t){const{factory:r}=t;let n;function i(t){if(Oe.enabled){const{line:r,character:i}=e.getLineAndCharacterOfPosition(n,t.getEnd());Oe("createAs:",`at ${n.fileName}:${r+1}:${i}`)}return r.createAsExpression(t,r.createTypeReferenceNode(r.createIdentifier("UTSJSONObject"),void 0))}function s(t){if(Oe.enabled){const{line:r,character:i}=e.getLineAndCharacterOfPosition(n,t.getEnd());Oe("createAsArray:",`at ${n.fileName}:${r+1}:${i}`)}return r.createAsExpression(t,r.createArrayTypeNode(r.createTypeReferenceNode(r.createIdentifier("UTSJSONObject"),void 0)))}const o=t=>{t.forEachChild(o);const n=t.parent;if(n)if(e.isObjectLiteralExpression(t))e.isExportAssignment(n)?n.expression=i(t):e.isVariableDeclaration(n)&&!n.type||e.isPropertyDeclaration(n)&&!n.type?n.initializer=i(t):we(e,n)&&(n.expression=e.isParenthesizedExpression(n)?i(t):r.createParenthesizedExpression(i(t)));else if(e.isArrayLiteralExpression(t)){t.elements.length&&t.elements.every((t=>e.isObjectLiteralExpression(t)))&&(e.isExportAssignment(n)?n.expression=s(t):e.isVariableDeclaration(n)&&!n.type||e.isPropertyDeclaration(n)&&!n.type?n.initializer=s(t):we(e,n)&&(n.expression=e.isParenthesizedExpression(n)?s(t):r.createParenthesizedExpression(s(t))))}};return e=>(n=e,e.forEachChild(o),e)}},before(r){const o=t.getProgram().getTypeChecker(),{factory:a}=r,c=new Map;let l;const u=p=>{const f=e.visitEachChild(p,u,r);if(e.isObjectLiteralExpression(f)){const d=e.getOriginalNode(f).parent;let g=!1;if(d){if(e.isAsExpression(d))return y(f);if(e.isVariableDeclaration(d)&&d.type&&(g=!0,!i))return y(f)}if(!n(f))return f;function y(e){if(!s)return e;const t=o.getContextualType(e);return t?m(e,t):e}function m(t,r){const n=r.aliasSymbol||r.symbol;if(!n)return t;if(!(n.flags&e.SymbolFlags.TypeAlias))return t;const i=r.symbol.members;if(!i||0===i.size)return t;const s=[];let o=!1;return i.forEach(((r,n)=>{const i=t.properties.find((t=>e.isPropertyAssignment(t)&&e.isIdentifier(t.name)&&t.name.text===n));i?s.push(i):(o=!0,s.push(a.createPropertyAssignment(a.createIdentifier(n.toString()),a.createNull())))})),o?a.updateObjectLiteralExpression(t,s):t}const T=_(o,f),h=function(e,t,r,n){if(r)if((r=F(t,r)).isUnion()&&n){for(const i of r.types)if(C(i,e)&&t.isTypeAssignableTo(n,i))return i}else if(C(r,e))return r}(e,o,T,o.getTypeAtLocation(f));if(h&&!g)return n(f,h)?a.createAsExpression(s?m(f,h):f,K(e,t,o,h,l,c)||a.createTypeReferenceNode(h.aliasSymbol.name)):f;if(i){const x=function(e,t){let r,n=t;for(;(r=n.parent||n.original?.parent)&&ke(e,r);)n=r;return e.isPropertyAssignment(n)?void 0:n}(e,f);let N=!1;if(Pe(T))N=!0;else if(x){let S=x;e.isAsExpression(S)&&(S=S.expression);N="error"!==_(o,S).intrinsicName&&"error"!==T.intrinsicName&&o.isTypeAssignableTo(T,o.getUTSJSONObjectType())}if(N)return a.createAsExpression(f,a.createTypeReferenceNode(a.createIdentifier("UTSJSONObject"),void 0))}}return f};return t=>{l=t;const r=e.visitNode(t,u);return 0===c.size?r:a.updateSourceFile(r,[...c.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function we(e,t){return e.isParenthesizedExpression(t)&&t.parent?we(e,t.parent):e.isPropertyAccessExpression(t)}const Ie=r("uts:transformer:returnType"),Ue=(e,t,r)=>{const n=r?.transformReturnType?.shouldTransform??(()=>!0),i="ArkTS"===r.targetLanguage||"JavaScript"===r.targetLanguage;return{before(r){const s=t.getProgram().getTypeChecker(),{factory:o}=r,a=new Map;let c;const l=u=>{const p=e.visitEachChild(u,l,r);if(e.isFunctionDeclaration(p)){if(!p.type){const r=s.getSignatureFromDeclaration(p);if(r){const n=s.getReturnTypeOfSignature(r),l=Re(i,e,s,n,!1,p);if(l){if(Ie.enabled){const t=e.getOriginalNode(p);Ie("function:",`${t.name?.getText()}():${Ke(e,s,l,n)} at ${c.__relativeFileName}`)}return K(e,t,s,n,c,a),o.updateFunctionDeclaration(p,p.modifiers,p.asteriskToken,p.name,p.typeParameters,p.parameters,l,p.body)}}}}else if(e.isMethodDeclaration(p)){if(!p.type){const r=s.getTypeAtLocation(p).getCallSignatures()[0];if(r&&r.getReturnType().flags&e.TypeFlags.Void)return p;const l=D(e,s,p);if(l&&!n(e.getOriginalNode(p),l,s))return p;const u=F(s,l)?.getCallSignatures(),f=u&&u.length?u[0]:s.getSignatureFromDeclaration(p);if(f){const r=s.getReturnTypeOfSignature(f),n=Re(i,e,s,r,!(!u||!u.length),p);if(n){if(Ie.enabled){const t=e.getOriginalNode(p);Ie("method:",`${t.name?.getText()}():${Ke(e,s,n,r)} at ${c.__relativeFileName}`)}return K(e,t,s,r,c,a),o.updateMethodDeclaration(p,p.modifiers,p.asteriskToken,p.name,p.questionToken,p.typeParameters,p.parameters,n,p.body)}}}}else if(e.isArrowFunction(p)){if(!p.type){const r=s.getTypeAtLocation(p),l=r.getCallSignatures()[0];if(l&&l.getReturnType().flags&e.TypeFlags.Void)return p;const u=v(e,s,p);if(u&&!n(e.getOriginalNode(p),u,s))return p;let f=r;if(u){const e=s.getNonNullableType(u);e.getCallSignatures().length&&!e.isUnion()&&(f=u)}const d=F(s,f)?.getCallSignatures();if(d&&d.length){const r=d[0].getReturnType();let n=!!u;const l=s.getTypeAtLocation(e.getOriginalNode(p)).getCallSignatures();l.length&&l[0].getReturnType()===d[0].getReturnType()&&(n=!1);const f=Re(i,e,s,r,n,p);if(f){if(Ie.enabled){const t=e.getOriginalNode(p);Ie("arrow function:",`():${Ke(e,s,f,r)} at ${t.getSourceFile().__relativeFileName}`)}return K(e,t,s,r,c,a),o.updateArrowFunction(p,p.modifiers,p.typeParameters,p.parameters,f,p.equalsGreaterThanToken,p.body)}}}}else if(e.isFunctionExpression(p)&&!p.type){const r=s.getTypeAtLocation(p),l=r.getCallSignatures()[0];if(l&&l.getReturnType().flags&e.TypeFlags.Void)return p;const u=v(e,s,p);if(u&&!n(e.getOriginalNode(p),u,s))return p;let f=r;if(u){const e=s.getNonNullableType(u);e.getCallSignatures().length&&!e.isUnion()&&(f=u)}const d=F(s,f)?.getCallSignatures();if(d&&d.length){const r=d[0].getReturnType();let n=!!u;const l=s.getTypeAtLocation(e.getOriginalNode(p)).getCallSignatures();l.length&&l[0].getReturnType()===d[0].getReturnType()&&(n=!1);const f=Re(i,e,s,r,n,p);if(f)return Ie.enabled&&Ie("function expression:",`():${Ke(e,s,f,r)} at ${c.__relativeFileName}`),K(e,t,s,r,c,a),o.updateFunctionExpression(p,p.modifiers,p.asteriskToken,p.name,p.typeParameters,p.parameters,f,p.body)}}return p};return t=>{c=t;const r=e.visitNode(t,l);return 0===a.size?r:o.updateSourceFile(r,[...a.values(),...r.statements],r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib,r.libReferenceDirectives)}}}};function Ke(e,t,r,n){return e.isTypeReferenceNode(r)&&e.isIdentifier(r.typeName)?r.typeName.text:t.typeToString(n)}function Re(e,t,r,n,i,s){if(k(n,t,r))return;const o=M(t,r,n,e);if(o)return o;const a=!i;if(n.isUnion()&&A(t,F(r,n))){if(!a)return;return t.factory.createUnionTypeNode([t.factory.createTypeReferenceNode(t.factory.createIdentifier("UTSJSONObject")),t.factory.createLiteralTypeNode(t.factory.createNull())])}return n.flags&t.TypeFlags.Void?void 0:A(t,n)?a?t.factory.createTypeReferenceNode(t.factory.createIdentifier("UTSJSONObject")):void 0:E(t,r,n)?w(n,s,t,r):void 0}const $e=r("uts:transformer:UTSJSONObject"),Me=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isPropertyAccessExpression(o)&&!function(e,t){return e.parent&&t.isCallExpression(e.parent)&&e.parent.expression===e}(o,e)){if(function(e,t){const r=t.getUTSJSONObjectType?.();if(r)return e===r||t.getNonNullableType(e)===r;return!1}(n.getTypeAtLocation(o.expression),n)){const t=o.name.text;if(o.questionDotToken){if($e.enabled){const t=e.getOriginalNode(o);$e(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return i.createElementAccessChain(o.expression,o.questionDotToken,i.createStringLiteral(t))}if($e.enabled){const t=e.getOriginalNode(o);$e(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return i.createElementAccessExpression(o.expression,i.createStringLiteral(t))}}return o};return t=>e.visitNode(t,s)}});const qe=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isBinaryExpression(o)&&o.operatorToken.kind===e.SyntaxKind.EqualsToken){if(P(_(n,o.left),e,n)&&Ge(o.right,e))return i.createBinaryExpression(o.left,o.operatorToken,i.createCallExpression(i.createIdentifier("Number"),[],[o.right]))}else if(e.isCallExpression(o)&&o.arguments.length){const t=je(o.arguments,e,n);if(t)return i.updateCallExpression(o,o.expression,o.typeArguments,t)}else if(e.isNewExpression(o)&&o.arguments?.length){const t=je(o.arguments,e,n);if(t)return i.updateNewExpression(o,o.expression,o.typeArguments,t)}else if(e.isObjectLiteralExpression(o)){let t=!1;const r=o.properties.map((r=>{if(e.isPropertyAssignment(r)&&r.initializer){const s=je([r.initializer],e,n);if(s)return t=!0,i.updatePropertyAssignment(r,r.name,s[0])}return r}));if(t)return i.updateObjectLiteralExpression(o,r)}return o};return t=>e.visitNode(t,s)}});function je(e,t,r){const n=[];let i=!1;if(e.forEach((e=>{P(_(r,e),t,r)&&Ge(e,t)?(i=!0,n.push(t.factory.createCallExpression(t.factory.createIdentifier("Number"),[],[e]))):n.push(e)})),i)return n}function Ge(e,t){if(t.isNumericLiteral(e))return!0;if(t.isParenthesizedExpression(e))return Ge(e.expression,t);if(t.isPrefixUnaryExpression(e))switch(e.operator){case t.SyntaxKind.MinusToken:case t.SyntaxKind.PlusToken:case t.SyntaxKind.TildeToken:return Ge(e.operand,t);default:return!1}if(t.isBinaryExpression(e))switch(e.operatorToken.kind){case t.SyntaxKind.PlusToken:case t.SyntaxKind.MinusToken:case t.SyntaxKind.AsteriskToken:case t.SyntaxKind.SlashToken:case t.SyntaxKind.PercentToken:case t.SyntaxKind.LessThanLessThanToken:case t.SyntaxKind.GreaterThanGreaterThanToken:case t.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:case t.SyntaxKind.CaretToken:case t.SyntaxKind.AmpersandToken:case t.SyntaxKind.BarToken:case t.SyntaxKind.AsteriskAsteriskToken:return Ge(e.left,t)&&Ge(e.right,t);default:return!1}return!1}const Be=(e,t)=>({parser:{SourceFile(t){const{factory:r}=t,n=i=>{const s=e.visitEachChild(i,n,t);return e.isTypeAliasDeclaration(s)&&e.isTypeLiteralNode(s.type)&&s.type.members.push(r.createPropertySignature(void 0,r.createComputedPropertyName(r.createIdentifier("UTSObjectMarker")),r.createToken(e.SyntaxKind.QuestionToken),r.createLiteralTypeNode(r.createTrue()))),s};return e=>(e.forEachChild(n),e)}},before(t){const r=n=>{const i=e.visitEachChild(n,r,t);if(!(e.isPropertySignature(i)&&e.isComputedPropertyName(i.name)&&e.isIdentifier(i.name.expression)&&"UTSObjectMarker"===i.name.expression.text))return i};return t=>e.visitNode(t,r)}}),We=r("uts:transformer:arkts-no-any-unknown"),ze=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isCallExpression(o)){const{expression:t,typeArguments:r,arguments:s}=o;if(e.isPropertyAccessExpression(t)&&e.isIdentifier(t.name)){const a=n.getTypeAtLocation(t.expression);if("Promise"===a.symbol?.name)if(1===s.length&&"catch"===t.name.text){const n=He(s[0],e);if(n)return i.updateCallExpression(o,t,r,[n])}else if(2===s.length&&"then"===t.name.text){const n=He(s[1],e);if(n)return i.updateCallExpression(o,t,r,[s[0],n])}}}return o};return t=>e.visitNode(t,s)}});function He(e,t){if(t.isArrowFunction(e)){const{parameters:r}=e;if(1===r.length){const n=r[0];if(!n.type){if(We.enabled){const e=t.getOriginalNode(n);We(e.getText(),`at ${e.getSourceFile().__relativeFileName}`)}const{factory:r}=t;return r.updateArrowFunction(e,e.modifiers,e.typeParameters,[r.updateParameterDeclaration(n,n.modifiers,n.dotDotDotToken,n.name,n.questionToken,r.createTypeReferenceNode(r.createIdentifier("ESObject"),void 0),n.initializer)],e.type,e.equalsGreaterThanToken,e.body)}}}else if(t.isFunctionExpression(e)){const{parameters:r}=e;if(1===r.length){const n=r[0];if(!n.type){if(We.enabled){const e=t.getOriginalNode(n);We(e.getText(),`at ${e.getSourceFile().__relativeFileName}`)}return t.factory.updateFunctionExpression(e,e.modifiers,e.asteriskToken,e.name,e.typeParameters,[t.factory.updateParameterDeclaration(n,n.modifiers,n.dotDotDotToken,n.name,n.questionToken,z(t),n.initializer)],e.type,e.body)}}}}const Ve=r("uts:transformer:runtimeHelper"),Je=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isPropertyAccessExpression(o)){const{expression:t,name:r}=o;if(e.isIdentifier(t)&&("JSON"===t.text||"console"===t.text)){if(Ve.enabled){const t=e.getOriginalNode(o);Ve(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return i.updatePropertyAccessExpression(o,i.createPropertyAccessExpression(i.createIdentifier("UTS"),t),r)}}if(e.isCallExpression(t)){const r=function(e,t,r){if(t.isPropertyAccessExpression(e.expression)){const n=function(e,t,r){if(!t.isIdentifier(e.name))return;const n=r.getTypeAtLocation(e.expression);let i="";if(n.isUnion())n.types.every((e=>{if(e.symbol){if("Map"===e.symbol.name)return!0;if("WeakMap"===e.symbol.name)return!0}return!1}))&&(i="Map");else if(r.isArrayType(n))i="Array";else if(n.flags&t.TypeFlags.StringLike)i="String";else if(n.symbol){const e=n.symbol.name;"Map"===e?i="Map":"WeakMap"===e&&(i="WeakMap")}if(!i)return;return Xe[`${i}_${e.name.text}`]}(e.expression,t,r);if(n){const r=t.factory;return r.createCallExpression(r.createPropertyAccessExpression(r.createIdentifier("UTS"),r.createIdentifier(n)),void 0,[e.expression.expression,...e.arguments])}}}(t,e,n);if(r)return r}return o};return t=>e.visitNode(t,s)}});const Xe={Array_find:"arrayFind",Array_pop:"arrayPop",Array_shift:"arrayShift",Array_copyWithin:"arrayCopyWithin",Array_fill:"arrayFill",Map_get:"mapGet",WeakMap_get:"weakMapGet",String_codePointAt:"stringCodePointAt"},Qe=(e,t)=>({parser:{SourceFile(t){const{factory:r}=t,n=t=>{t.forEachChild(n),e.isCatchClause(t)&&(t.variableDeclaration?t.variableDeclaration.type||(t.variableDeclaration.type=r.createKeywordTypeNode(e.SyntaxKind.AnyKeyword)):t.variableDeclaration=r.createVariableDeclaration(r.createIdentifier("e"),void 0,r.createKeywordTypeNode(e.SyntaxKind.AnyKeyword)))};return e=>(e.forEachChild(n),e)}}}),Ye=r("uts:transformer:decorators:inlineAndReified"),Ze=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r;function s(t){const s=t.typeParameters.map((e=>e.name.text));const o=function(e,t){const r=[];return t?.forEach((t=>{const n=et(e,t);n&&r.push(n)})),r}(e,t.modifiers);if(o.includes("reified"))return[];const a={found:!1,keywords:new Map([["reified",!1]]),typeParameterNames:s},c=(t=>{const i=t.keywords,s=o=>{if(e.isCallExpression(o)&&o.typeArguments){const r=o.typeArguments,s=t.typeParameterNames;if(r.some((t=>{if(e.isTypeReferenceNode(t)&&e.isIdentifier(t.typeName)){const e=t.typeName.text;return s.includes(e)}}))){const r=n.getResolvedSignature(o);if(r){const n=r.declaration;n&&(e.getJSDocTags(n).forEach((e=>{const r=e.tagName.text;i.has(r)&&(t.found=!0,i.set(r,!0))})),(e.isFunctionDeclaration(n)||e.isMethodDeclaration(n))&&n.modifiers?.forEach((r=>{const n=et(e,r);n&&i.has(n)&&(t.found=!0,i.set(n,!0))})))}}}return e.visitEachChild(o,s,r)};return s})(a);if(e.visitEachChild(t,c,r),a.found){const e=[];for(const[t,r]of a.keywords.entries())r&&("reified"!==t||o.includes("inline")||e.push(i.createDecorator(i.createCallExpression(i.createPropertyAccessExpression(i.createIdentifier("UTSAndroid"),i.createIdentifier("keyword")),void 0,[i.createStringLiteral("inline")]))),e.push(i.createDecorator(i.createCallExpression(i.createPropertyAccessExpression(i.createIdentifier("UTSAndroid"),i.createIdentifier("keyword")),void 0,[i.createStringLiteral(t)]))));return e}}const o=t=>{const n=e.visitEachChild(t,o,r);if(e.isFunctionDeclaration(n)&&n.typeParameters){const t=s(n);if(t){if(Ye.enabled){const t=e.getOriginalNode(n);Ye(t.name?.getText()||t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return i.updateFunctionDeclaration(n,i.createNodeArray([...t,...n.modifiers||[]]),n.asteriskToken,n.name,n.typeParameters,n.parameters,n.type,n.body)}}else if(e.isMethodDeclaration(n)&&n.typeParameters){const t=s(n);if(t){if(Ye.enabled){const t=e.getOriginalNode(n);Ye(t.name.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return i.updateMethodDeclaration(n,i.createNodeArray([...t,...n.modifiers||[]]),n.asteriskToken,n.name,n.questionToken,n.typeParameters,n.parameters,n.type,n.body)}}return n};return t=>e.visitNode(t,o)}});function et(e,t){if(e.isDecorator(t)&&e.isCallExpression(t.expression)&&e.isPropertyAccessExpression(t.expression.expression)&&e.isIdentifier(t.expression.expression.name)&&e.isIdentifier(t.expression.expression.expression)&&"UTSAndroid"===t.expression.expression.expression.text&&"keyword"===t.expression.expression.name.text&&e.isStringLiteral(t.expression.arguments[0]))return t.expression.arguments[0].text}const tt=r("uts:transformer:interface:override"),rt=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{if(e.isClassDeclaration(t)||e.isClassExpression(t)){const s=t.heritageClauses?.filter((t=>t.token===e.SyntaxKind.ImplementsKeyword)),o=s?.flatMap((e=>e.types.map((e=>n.getTypeAtLocation(e)))));if(o?.length){const s=t=>{if(e.isConstructorDeclaration(t)){let r=!1;const s=[];for(const a of t.parameters){let c=a;if(e.isParameterPropertyDeclaration(a,t)){const t=nt(a,o,e,n);if(t){if(tt.enabled){const t=e.getOriginalNode(a);tt(t.getText(),`at ${t.getSourceFile().__relativeFileName}`)}c=i.updateParameterDeclaration(a,t,a.dotDotDotToken,a.name,a.questionToken,a.type,a.initializer),r=!0}}s.push(c)}if(r)return i.updateConstructorDeclaration(t,t.modifiers,s,t.body)}else if(e.isPropertyDeclaration(t)&&!it(t,[e.SyntaxKind.OverrideKeyword,e.SyntaxKind.StaticKeyword])){const r=nt(t,o,e,n);if(r){if(tt.enabled){const r=e.getOriginalNode(t);tt(r.getText(),`at ${r.getSourceFile().__relativeFileName}`)}return i.updatePropertyDeclaration(t,r,t.name,t.questionToken,t.type,t.initializer)}}else if(e.isMethodDeclaration(t)&&!it(t,[e.SyntaxKind.OverrideKeyword,e.SyntaxKind.StaticKeyword])){const r=nt(t,o,e,n);if(r){if(tt.enabled){const r=e.getOriginalNode(t);tt(r.getText(),`at ${r.getSourceFile().__relativeFileName}`)}return i.updateMethodDeclaration(t,r,t.asteriskToken,t.name,t.questionToken,t.typeParameters,t.parameters,t.type,t.body)}}return t};return e.visitEachChild(t,s,r)}}return e.visitEachChild(t,s,r)};return t=>e.visitNode(t,s)}});function nt(e,t,r,n){const i=n.getSymbolAtLocation(e.name);if(i){if(t.some((e=>e.getProperties().some((e=>e.name===i.name))))){return e.modifiers?[...e.modifiers.filter((e=>st(e,r))),r.factory.createModifier(r.SyntaxKind.OverrideKeyword),...e.modifiers.filter((e=>!st(e,r)))]:[r.factory.createModifier(r.SyntaxKind.OverrideKeyword)]}}}function it(e,t){return e.modifiers?.some((e=>t.includes(e.kind)))}function st(e,t){return e.kind===t.SyntaxKind.Decorator||e.kind===t.SyntaxKind.PublicKeyword||e.kind===t.SyntaxKind.ProtectedKeyword||e.kind===t.SyntaxKind.PrivateKeyword||e.kind===t.SyntaxKind.AbstractKeyword}const ot=r("uts:transformer:number:toString"),at=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isCallExpression(o)&&0===o.arguments.length&&e.isPropertyAccessExpression(o.expression)&&"toString"===o.expression.name.text){const t=n.getTypeAtLocation(o.expression.expression);return t.flags&e.TypeFlags.NumberLiteral||t.flags&e.TypeFlags.Number?i.updateCallExpression(o,o.expression,o.typeArguments,[i.createNumericLiteral("10")]):o}if(e.isBinaryExpression(o)&&o.operatorToken.kind===e.SyntaxKind.PlusToken&&e.isNumericLiteral(o.right)&&o.right.getText().includes(".")){if(n.getTypeAtLocation(o).flags&e.TypeFlags.String){if(ot.enabled){const t=e.getOriginalNode(o);ot(t.right.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return i.updateBinaryExpression(o,o.left,o.operatorToken,i.createCallExpression(i.createPropertyAccessExpression(o.right,"toString"),void 0,[i.createNumericLiteral("10")]))}}else if(e.isTemplateSpan(o)&&e.isNumericLiteral(o.expression)&&o.expression.getText().includes(".")){if(ot.enabled){const t=e.getOriginalNode(o);ot(t.expression.getText(),`at ${t.getSourceFile().__relativeFileName}`)}return i.updateTemplateSpan(o,i.createCallExpression(i.createPropertyAccessExpression(o.expression,"toString"),void 0,[i.createNumericLiteral("10")]),o.literal)}return o};return t=>e.visitNode(t,s)}}),ct=r("uts:transforms:rest_parameters"),lt="do_not_transform_spread",ut=(e,t,r)=>{const n=r.transformRestParameters?.shouldTransform??(()=>!0);return{before(r){const i=t.getProgram().getTypeChecker(),{factory:s}=r,o=t=>{const a=e.visitEachChild(t,o,r);if(e.isMethodDeclaration(a)&&a.parameters.length&&a.body){const t=F(i,D(e,i,a));if(t){const o=t.getCallSignatures();if(o&&1===o.length){if(!n(a,o[0],i,r))return a;const t=pt(o[0],a,e);if(t){if(ct.enabled){const r=e.getOriginalNode(a);ct("method:",`${r.name.getText()}(${O(e,t.parameters)}) at ${r.getSourceFile().__relativeFileName}`)}return s.updateMethodDeclaration(a,a.modifiers,a.asteriskToken,a.name,a.questionToken,a.typeParameters,t.parameters,a.type,s.createBlock([...t.statements,...a.body.statements]))}}}}else if(e.isArrowFunction(a)&&a.parameters.length){const t=F(i,i.getContextualType(a));if(t){if(t!==i.getTypeAtLocation(a)){const o=t.getCallSignatures();if(o&&o.length){if(!n(a,o[0],i,r))return a;const t=pt(o[0],a,e);if(t){if(ct.enabled){const r=e.getOriginalNode(a);ct("arrow function:",`(${O(e,t.parameters)}) at ${r.getSourceFile().__relativeFileName}`)}const r=e.isExpression(a.body)?s.createBlock([...t.statements,s.createReturnStatement(a.body)]):s.createBlock([...t.statements,...a.body.statements]);return gt(o[0],a,s.updateArrowFunction(a,a.modifiers,a.typeParameters,t.parameters,a.type,a.equalsGreaterThanToken,r),e)}}}}}else if(e.isFunctionExpression(a)&&a.parameters.length){const t=F(i,i.getContextualType(a));if(t){if(t!==i.getTypeAtLocation(a)){const o=t.getCallSignatures();if(o&&o.length){if(!n(a,o[0],i,r))return a;const t=pt(o[0],a,e);if(t){if(ct.enabled){const r=e.getOriginalNode(a);ct("function expression:",`(${O(e,t.parameters)}) at ${r.getSourceFile().__relativeFileName}`)}return gt(o[0],a,s.updateFunctionExpression(a,a.modifiers,a.asteriskToken,a.name,a.typeParameters,t.parameters,a.type,s.createBlock([...t.statements,...a.body.statements])),e)}}}}}return a};return t=>e.visitNode(t,o)}}};function pt(e,t,r){const n=function(e,t){if(e.parameters.length){const r=e.parameters[e.parameters.length-1];if(r.valueDeclaration&&t.isParameter(r.valueDeclaration)&&r.valueDeclaration.dotDotDotToken)return e.parameters.length-1}return-1}(e,r);if(-1!==n&&n<t.parameters.length){const e=function(e,t){if(e.find((e=>!t.isIdentifier(e.name))))return[];return e.map((e=>({name:e.name.getText(),isRestParameter:!!e.dotDotDotToken})))}(t.parameters.slice(n),r);if(e.length)return{parameters:r.factory.createNodeArray([...t.parameters.slice(0,n),(i=r.factory,i.createParameterDeclaration(void 0,void 0,i.createIdentifier(lt),void 0,void 0,void 0))]),statements:ft(e,r.factory)}}var i}function ft(e,t){return t.createNodeArray(e.map((({name:e,isRestParameter:r},n)=>function(e,t,r,n){return n.createVariableStatement(void 0,n.createNodeArray([dt(e,t,r,n)]))}(e,n,r,t))))}function dt(e,t,r,n){return n.createVariableDeclaration(n.createIdentifier(e),void 0,void 0,r?n.createNewExpression(n.createIdentifier("Array"),void 0,[n.createSpreadElement(n.createIdentifier(lt))]):n.createElementAccessExpression(n.createIdentifier(lt),n.createNumericLiteral(t.toString())))}function gt(e,t,r,n){const i=n.getOriginalNode(t).parent;if(i&&(n.isVariableDeclaration(i)||n.isBinaryExpression(i)&&i.operatorToken.kind===n.SyntaxKind.EqualsToken)&&e.declaration&&e.declaration.parent){const t=e.declaration.parent;if(n.isTypeAliasDeclaration(t)){const e=t.name.getText(),i=n.factory;return i.createNewExpression(i.createIdentifier(e),void 0,[r])}}return r}const yt=(e,t)=>({before(r){const n=t.getProgram(),{factory:i}=r;return t=>function t(s){const o=e.visitEachChild(s,t,r),a=n.getTypeChecker();if(e.isCallExpression(o)&&o.typeArguments&&o.typeArguments.length>0){const t=a.getResolvedSignature(o);if(!t)return o;const r=o.arguments,n=t.getParameters();if(r.length<n.length){const t=r.length>0&&e.isBinaryExpression(r[0])&&r[0].operatorToken.kind===e.SyntaxKind.EqualsToken,s=[];for(let a=0;a<n.length;a++){const c=n[a],l=c.declarations?.[0];if(l&&e.isParameter(l)){if(l.dotDotDotToken)return o;if(!e.isIdentifier(l.name))return o;if(t?r.some((t=>e.isBinaryExpression(t)&&t.left.getText()===l.name.getText())):a<r.length)continue;if(l.initializer){if(!e.isLiteralExpression(l.initializer))return o;s.push(t?i.createBinaryExpression(i.cloneNode(l.name),e.SyntaxKind.EqualsToken,i.cloneNode(l.initializer)):i.cloneNode(l.initializer))}else s.push(t?i.createBinaryExpression(i.createIdentifier(c.name),e.SyntaxKind.EqualsToken,i.createNull()):i.createNull())}}return i.updateCallExpression(o,o.expression,o.typeArguments,[...r,...s])}}return o}(t)}}),mt=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r;return t=>{const s=[],o=a=>{const c=e.visitEachChild(a,o,r);if(e.isCallExpression(c)&&c.typeArguments&&c.typeArguments.length>0){const o=c.parent||e.getOriginalNode(c)?.parent;if(o&&!e.isAsExpression(o)){const o=n.getTypeAtLocation(c);if(o){let a=n.typeToTypeNode(o,e.getOriginalNode(c),e.NodeBuilderFlags.UseAliasDefinedOutsideCurrentScope);if(o.isUnion()&&ue(o,e,n)){return a.types.some((t=>e.isLiteralTypeNode(t)&&t.literal.kind===e.SyntaxKind.NullKeyword))&&(a=i.createUnionTypeNode([i.createTypeReferenceNode("UTSUnionTypeObject"),i.createLiteralTypeNode(i.createNull())])),a=i.createTypeReferenceNode("UTSUnionTypeObject"),i.createAsExpression(c,a)}if(a){const o=[...s],l=new T(c,t,n,r,e,s);try{const e=l.visitTypeNode(a);if(e){return i.createAsExpression(c,e)}}catch(e){return s.splice(0,s.length,...o),c}}}}}return c},a=e.visitNode(t,o);return T.updateSourceFile(s,a,i,e)}}}),Tt=r("uts:transformer:existentialType"),ht=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isTypeReferenceNode(o)&&o.typeArguments&&1===o.typeArguments.length&&o.typeArguments[0].kind===e.SyntaxKind.UnknownKeyword){let t=!1;if(e.isIdentifier(o.typeName)){const e=o.typeName.text;"Array"!==e&&"Set"!==e&&"Map"!==e&&"Ref"!==e||(t=!0)}if(!t){const t=n.getTypeFromTypeNode(o);if(t.symbol?.flags&e.SymbolFlags.Interface){if(Tt.enabled){const t=e.getOriginalNode(o);Tt(t.getText(),` at ${t.getSourceFile().__relativeFileName}`)}return i.createTypeReferenceNode("SwiftExistentialType",[o.typeArguments[0],i.createTypeReferenceNode(o.typeName)])}}}return o};return t=>e.visitNode(t,s)}}),xt=r("uts:transformer:numberNarrowing"),Nt=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isNumericLiteral(o)&&o.parent&&!e.isAsExpression(o.parent)){const t=n.getContextualType(o);if(t){const r=n.getNonNullableType(t);if(r.isUnion()&&!function(e){return e.types.every((e=>e.isNumberLiteral()))}(r)){const t=r.types;if(t.length>1&&t.some((t=>P(t,e,n)))){if(xt.enabled){const t=e.getOriginalNode(o);xt(`${t.getText()} as number`,` at ${t.getSourceFile().__relativeFileName}`)}return i.createAsExpression(o,J(e))}}}}return o};return t=>e.visitNode(t,s)}}),St=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r;return t=>function t(s){if(!e.isClassDeclaration(s)||!s.heritageClauses?.some((t=>t.token===e.SyntaxKind.ExtendsKeyword)))return e.visitEachChild(s,t,r);const o=n.getTypeAtLocation(s),a=n.getBaseTypes(o);if(0===a.length)return e.visitEachChild(s,t,r);const c=a[0].getSymbol();if(!c)return e.visitEachChild(s,t,r);const l=n.getTypeOfSymbol(c).getConstructSignatures();if(0===l.length)return e.visitEachChild(s,t,r);const u=s.members.map((t=>{if(!e.isConstructorDeclaration(t))return t;const r=n.getSignatureFromDeclaration(t);if(!r)return t;for(const s of l)if(bt(r,s,n)){const r=t.modifiers?.some((t=>{if(e.isDecorator(t)){const r=t.expression;if(e.isCallExpression(r)&&e.isPropertyAccessExpression(r.expression)&&e.isIdentifier(r.expression.expression)&&"UTSiOS"===r.expression.expression.text&&"keyword"===r.expression.name.text&&1===r.arguments.length&&e.isStringLiteral(r.arguments[0])&&"override"===r.arguments[0].text)return!0}return!1}));if(!r){const r=i.createDecorator(i.createCallExpression(i.createPropertyAccessExpression(i.createIdentifier("UTSiOS"),"keyword"),void 0,[i.createStringLiteral("override")])),n=e.getModifiers(t)||[];return i.updateConstructorDeclaration(t,[r,...n],t.parameters,t.body)}break}return t}));return i.updateClassDeclaration(s,e.getModifiers(s),s.name,s.typeParameters,s.heritageClauses,u)}(t)}});function bt(e,t,r){const n=e.getParameters(),i=t.getParameters();if(n.length!==i.length)return!1;for(let e=0;e<n.length;e++){const t=n[e],s=i[e],o=r.getTypeOfSymbolAtLocation(t,t.valueDeclaration),a=r.getTypeOfSymbolAtLocation(s,s.valueDeclaration);if(r.typeToString(o)!==r.typeToString(a))return!1}return!0}const Et=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker();return t=>{const i=[];const s=function s(o){const a=e.visitEachChild(o,s,r);if(e.isPropertyDeclaration(a)&&a.modifiers?.some((t=>t.kind===e.SyntaxKind.OverrideKeyword))&&void 0===a.type){const s=a.parent,o=a.name;if(e.isClassDeclaration(s)&&e.isIdentifier(o)){const c=o.text,l=n.getTypeAtLocation(s),u=n.getBaseTypes(l),p=n.getTypeOfPropertyOfType(l,c);let f=u[0],d=p;for(;f;){const e=n.getTypeOfPropertyOfType(f,c);if(!e)break;n.isTypeAssignableTo(p,e)&&n.isTypeAssignableTo(e,p)||(d=e),f=n.getBaseTypes(f)[0]}const g=n.typeToTypeNode(d,a,e.NodeBuilderFlags.UseAliasDefinedOutsideCurrentScope);if(g){const s=[...i],o=new T(a,t,n,r,e,i);try{const t=o.visitTypeNode(g);if(t)return e.factory.updatePropertyDeclaration(a,a.modifiers,a.name,a.questionToken,t,a.initializer)}catch(e){i.splice(0,i.length,...s)}}}}return a}(t);return T.updateSourceFile(i,s,r.factory,e)}}}),vt=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r;return t=>{const s=t=>{const o=e.visitEachChild(t,s,r);function a(e){const t=n.getSymbolAtLocation(e);if(!t)return!0;const r=n.getTypeOfSymbol(t);return $(r,n)||r===n.getAnyType()}return e.isNonNullExpression(o)?a(o.expression)?o:o.expression:e.isPropertyAccessChain(o)?a(o.expression)?o:i.updatePropertyAccessChain(o,o.expression,void 0,o.name):e.isElementAccessChain(o)?a(o.expression)?o:i.updateElementAccessChain(o,o.expression,void 0,o.argumentExpression):e.isCallChain(o)?a(o.expression)?o:i.updateCallChain(o,o.expression,void 0,o.typeArguments,o.arguments):o};return e.visitNode(t,s)}}});const _t={componentPublicInstancePropertyAccessFallback:function(e,t,r,n,i,s){if(!e.isPropertyAccessExpression(r)||!e.isExpression(n)||!e.isIdentifier(s))return;const o=i.aliasSymbol?.escapedName.toString();if("ComponentPublicInstance"!==o&&"CreateComponentPublicInstance"!==o)return;const a=s.escapedText.toString(),c=globalThis?.__utsUniXGlobalProperties__;if(c&&c.has(a)){const{initializerNode:r}=c.get(a),n=t.getTypeAtLocation(r);return n.isNumberLiteral()?t.getNumberType():n.isStringLiteral()?t.getStringType():n.flags&e.TypeFlags.BooleanLiteral?t.getBooleanType():n}},filterReferencedByPaths:function(e,t){if(t&&e.endsWith(".uvue.ts"))for(const[e]of t?.entries())if(e.endsWith("main.uts.ts"))return void t.delete(e)}};globalThis.__utsUniXGlobalProperties__=globalThis.__utsUniXGlobalProperties__||new Map;const Ft=e=>({parser:{SourceFile:t=>r=>{const n=r.fileName,i=globalThis?.__utsUniXGlobalProperties__;if(i)for(const[e,t]of i)t.file===n&&i.delete(e);return function r(s){if(e.isBinaryExpression(s)){const{left:t,operatorToken:r,right:o}=s;if(r.kind===e.SyntaxKind.EqualsToken&&e.isPropertyAccessExpression(t)){const{expression:r,name:s}=t;if(e.isPropertyAccessExpression(r)){const{expression:t,name:a}=r;if("globalProperties"===a.escapedText.toString()&&e.isPropertyAccessExpression(t)){const{name:e}=t;"config"===e.escapedText.toString()&&i.set(s.escapedText.toString(),{file:n,initializerNode:o})}}}}return e.visitEachChild(s,r,t)}(r)}}});let At=null,Ct=[];const Dt=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker();null===At&&n.getGlobalType&&(At=n.getGlobalType("UniApp",0,!1),At&&(Ct=At.getProperties().map((e=>e.getName()))));const i=t=>{if(At&&Ct.length){if(e.isCallExpression(t)&&e.isPropertyAccessExpression(t.expression)&&e.isIdentifier(t.expression.name)){const r=_(n,t.expression.expression);if(r&&r.isIntersection()&&r.types.some((e=>"UniApp"===e.symbol?.name))&&!Ct.includes(t.expression.name.text)){console.error(`error: '${t.expression.name.text}' 不是 UniApp 对象的方法，请检查是否拼写错误，如果想调用在 App.uvue 文件中定义的 methods 方法，请使用 .vm?.xxx 的方式调用，详情参考：https://doc.dcloud.net.cn/uni-app-x/api/get-app.html#appmethods`);const r=t.getSourceFile();if(r.__relativeFileName){const n=e.getLineAndCharacterOfPosition(r,t.pos),i=r.__relativeFileName.split("?")[0].replace(/\.(vue|uvue|uts).ts$/g,".$1");console.error("at "+i+":"+n.line)}}}return e.visitEachChild(t,i,r)}return t};return t=>e.visitNode(t,i)}}),kt=r("uts:transformer:uniElement"),Pt=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isCallExpression(o)&&e.isPropertyAccessExpression(o.expression)){const t=o.expression;if("addEventListener"===t.name.text){const r=n.getTypeAtLocation(t.expression),s=n.getNonNullableType(r);if(s!==function(e){Lt||(Lt=e.getGlobalType("UniElementImpl",0,!0));return Lt}(n)&&n.isTypeStrictSubtypeOf(s,function(e){Ot||(Ot=e.getGlobalType("UniElement",0,!0));return Ot}(n))){if(kt.enabled){const r=e.getOriginalNode(t.expression);kt(`${t.expression.getText()} as UniElementImpl`,` at ${r.getSourceFile().__relativeFileName}`)}const n=i.createTypeReferenceNode("UniElementImpl",[]);return i.updateCallExpression(o,i.updatePropertyAccessExpression(t,i.createAsExpression(t.expression,s===r?n:H(n,e)),t.name),o.typeArguments,o.arguments)}}}return o};return t=>e.visitNode(t,s)}});let Ot,Lt;const wt=r("uts:transformer:vModel"),It=(e,t)=>({before(r){const n=t.getProgram().getTypeChecker(),{factory:i}=r,s=t=>{const o=e.visitEachChild(t,s,r);if(e.isArrowFunction(o)&&1===o.parameters.length&&e.isBlock(o.body)&&1===o.body.statements.length){const t=o.parameters[0];if(!t.type&&e.isIdentifier(t.name)&&"$event"===t.name.text){const r=o.parent;if(e.isPropertyAssignment(r)){const s=r.name;if(e.isStringLiteral(s)&&s.text.startsWith("onUpdate:")){const r=o.body.statements[0];if(e.isExpressionStatement(r)&&e.isBinaryExpression(r.expression)&&r.expression.operatorToken.kind===e.SyntaxKind.EqualsToken){const s=n.getTypeAtLocation(r.expression.left),a=w(s,t,e,n);if(a){if(wt.enabled){const r=e.getOriginalNode(t);wt(`$event as ${n.typeToString(s)}`,` at ${r.getSourceFile().__relativeFileName}`)}return i.updateArrowFunction(o,o.modifiers,o.typeParameters,[i.updateParameterDeclaration(t,t.modifiers,t.dotDotDotToken,t.name,t.questionToken,a,t.initializer)],o.type,o.equalsGreaterThanToken,o.body)}}}}}}return o};return t=>e.visitNode(t,s)}});var Ut;function Kt(e){return{...Q,..._t}}function Rt(e,t={}){const r=[re];return e!==exports.TargetLanguage.Kotlin&&e!==exports.TargetLanguage.Swift||(r.push(Be,le,De),t.enableGenericsParameterDefaults&&r.push(ie),t.enableNarrowType&&(r.push(Ee),r.push(_e),r.push(ye),r.push(Ce)),r.push(Z)),e!==exports.TargetLanguage.Kotlin&&e!==exports.TargetLanguage.Swift&&e!==exports.TargetLanguage.ArkTS||r.push(Me),e===exports.TargetLanguage.Kotlin&&(r.push(Dt,It,rt,Qe,Ze,at,ut),t.enableUTSNumber&&r.push(qe)),e===exports.TargetLanguage.Swift&&(r.push(mt),r.push(yt),r.push(Nt),r.push(Pt),r.push(ht),r.push(vt),r.push(Et),r.push(St)),e===exports.TargetLanguage.ArkTS&&(r.push(ze),r.push(Je)),r.push(Ft,Le,Ue,ae),r}exports.TargetLanguage=void 0,(Ut=exports.TargetLanguage||(exports.TargetLanguage={})).Kotlin="Kotlin",Ut.Swift="Swift",Ut.ArkTS="ArkTS",Ut.JavaScript="JavaScript";const $t=["map","filter","forEach","every","some","find","findIndex","reduce","reduceRight"];function Mt(e){return e.symbol&&["Set","Map"].includes(e.symbol.escapedName)}const qt=r("uts:tsc:compile");const jt=["uni","uniCloud"];function Gt(e,t){if(e.isPropertyAccessExpression(t.expression)&&e.isIdentifier(t.expression.expression)){const e=t.expression.expression.getText();if(jt.includes(e))return!0}return!1}const Bt=["defineApp","defineComponent","defineAsyncComponent","defineVaporComponent","defineMixin"];function Wt(e){return e===exports.TargetLanguage.Kotlin?"app-android":e===exports.TargetLanguage.Swift?"app-ios":e===exports.TargetLanguage.ArkTS?"app-harmony":""}function zt(e,t,r){const n=r.parent;if(n&&e.isCallExpression(n))if(e.isIdentifier(n.expression)){const e=n.expression.getText();if("watch"===e||"watchEffect"===e||"watchPostEffect"===e||"watchSyncEffect"===e)return!1}else if(e.isPropertyAccessExpression(n.expression)){const e=n.expression.name.getText();if("then"===e||"catch"===e)return!1}return!0}const Ht=["/uni-app-x/types/uni/","/uni-app-x/types/uni-cloud/","/UniPage.d.ts","/IUniElement.d.ts"];function Vt(e,t){if(e.aliasSymbol||e.symbol){const r=(e.aliasSymbol||e.symbol).declarations;if(r&&r.length>0&&!Jt(r[0],t))return!1}return!0}function Jt(e,t){const r=e.getSourceFile();if(r.isDeclarationFile){if(!0===r.__isUTSDeclarationFile)return!0;if(!1===r.__isUTSDeclarationFile)return!1;const e=o(r.fileName);return e.startsWith(t)||Ht.some((t=>e.includes(t)))?(r.__isUTSDeclarationFile=!0,!0):(r.__isUTSDeclarationFile=!1,!1)}return!0}function Xt(e,t){if(t.isNonNullExpression(e))return!1;if(t.isAsExpression(e))return!1;const r=e.parent;if(!r)return!1;if(t.isNonNullExpression(r))return!1;if(t.isCallExpression(r)&&r.questionDotToken)return!1;if(t.isBinaryExpression(r)&&r.operatorToken.kind===t.SyntaxKind.QuestionQuestionToken)return!1;if(t.isBinaryExpression(r)){const e=r.operatorToken.kind;if(e===t.SyntaxKind.EqualsEqualsToken||e===t.SyntaxKind.EqualsEqualsEqualsToken||e===t.SyntaxKind.ExclamationEqualsToken||e===t.SyntaxKind.ExclamationEqualsEqualsToken)return!1}if(t.isPropertyAccessExpression(r)){if(r.questionDotToken)return!1;if(t.isNonNullExpression(r.expression))return!1}return!0}exports.UniXCompiler=class{constructor(e){this._options=e}debug(e,...t){return this._utsCompiler.debug(e,...t)}close(){return this._utsCompiler.close()}wait(e){return this._utsCompiler.wait(e)}getRootFiles(){return this._utsCompiler.getRootFiles()}hasRootFile(e){return this._utsCompiler.hasRootFile(e)}addRootFile(e,t=2e3){return this._utsCompiler.addRootFile(e,t)}addRootFiles(e,t=2e3){return this._utsCompiler.addRootFiles(e,t)}getDiagnostics(){return this._utsCompiler.getDiagnostics()}async invalidate(e){}init(){if(this._utsCompiler)return Promise.resolve();const e=this._options,{mode:t,targetLanguage:r,hxLanguageServiceDir:a}=e,c=e.tsFactory(Kt()),l=o(e.inputDir),u=o(e.outputDir),p=a?n.resolve(a,"builtin-dts"):"";let d=e.utsLibDir;const g=o(n.resolve(d,"uts/types/uts")),y=o(n.resolve(d,"uts/types/uni-x")),m=Wt(r);m||(console.error(`${r} is unsupported`),process.exit(0));const T=o(n.resolve(y,m,"paths.json")),h=[n.resolve(y,`${m}.d.ts`)],x=n.resolve(l,"../uni-ext-api.d.ts");i.existsSync(x)&&h.push(x);let N="",S="",E="",v="";function _(){N=o(n.resolve(g,"common")),S=o(n.resolve(y,m)),E=o(n.resolve(require.resolve("@dcloudio/uni-app-x/package.json",{paths:[d]}),"../types"))}"app-harmony"===m&&(v=n.resolve(y,m)),a&&p?(i.existsSync(p)?(N=o(n.resolve(p,"uts-types/common")),S=o(n.resolve(p,`uts-types/${m}`)),E=o(n.resolve(p,"uniappx/node_modules/@dcloudio/uni-app-x/types"))):_(),"app-android"!==m&&"app-ios"!==m||(v=o(n.resolve(a,`../uts-development-${m.replace("app-","")}/uts-types/${m}`)),i.existsSync(v)||(v=""))):_();const F={};if(v&&i.existsSync(T)){const e=require(T);Object.keys(e).forEach((t=>{const r=[];e[t].forEach((e=>{r.push(n.resolve(v,e))})),F[t]=r}))}e.rootFiles&&e.rootFiles.length&&h.push(...e.rootFiles);const A=[n.resolve(y,"@vue/runtime-core/dist/runtime-core.d.ts")],C={rootDir:l,baseUrl:l,outDir:u,noImplicitAny:!1,noImplicitThis:!0,useDefineForClassFields:!1,sourceMap:"sourceMap"in e?e.sourceMap:"development"===process.env.NODE_ENV,inlineSources:"inlineSources"in e?e.inlineSources:"development"===process.env.NODE_ENV,noEmitOnError:!1,skipLibCheck:!0,resolveJsonModule:!1,typeRoots:[],paths:{"@uts/common.d.ts":[n.resolve(N,"common.d.ts")],[`@uni-x/${m}.d.ts`]:[n.resolve(S,"index.d.ts")],"@dcloudio/uni-app-x/index.d.ts":[n.resolve(E,"index.d.ts")],"@vue/shared":[n.resolve(y,"@vue/shared/dist/shared.d.ts")],"@vue/reactivity":[n.resolve(y,"@vue/reactivity/dist/reactivity.d.ts")],"@vue/runtime-core":A,vue:A,...F,...e.paths}},D={getCanonicalFileName:e=>e,getCurrentDirectory:()=>l,getNewLine:()=>c.sys.newLine},k={mode:t,typescript:c,inputDir:l,cacheDir:e.cacheDir,rootFiles:h,incremental:e.incremental,compilerOptions:C,reportFileName:function(e){let t="other";(e=o(e)).startsWith(g)?(t="system",e="uts:"+n.relative(g,e)):e.startsWith(y)?(t="system",e="uni-x:"+n.relative(y,e)):e.startsWith(E)?(t="system",e="uni-x:"+n.relative(E,e)):e.startsWith(N)?(t="system",e="uts:"+n.join("common",n.relative(N,e))):e.startsWith(S)?(t="system",e="uni-x:"+n.join(m,n.relative(S,e))):v&&e.startsWith(v)?(t="system",e=m+":"+n.relative(v,e)):e.startsWith(l)&&(t="user",e=n.relative(l,e));return{type:t,fileName:e}},reportDiagnostic:function(t){if(qt.enabled){const[r,s]=function(t,r){const s=`${function(e,t=!0){const r=c.DiagnosticCategory[e.category];return t?r.toLowerCase():r}(t)} UTS${t.code}: ${c.flattenDiagnosticMessageText(t.messageText,r.getNewLine())}`;if(t.file){let{line:r,character:o}=c.getLineAndCharacterOfPosition(t.file,t.start);r+=1,o+=1;let a=t.file.fileName;if(e.originalPositionForSync){const t=a+".map";if(i.existsSync(t)){const n=e.originalPositionForSync({sourceMapFile:t,line:r,column:o-1});n&&n.source&&(r=n.line,o=n.column,a=n.source)}}return n.isAbsolute(a)&&(a=n.relative(l,a)),a=a.replace(/\.(uvue|vue|uts)\.ts/,".$1"),[s,`at ${a}:${r}:${o}`]}return[s]}(t,D);console.warn("​"+r+"​"),s&&console.log(s)}},createTransformers:function(t,{rootDir:n}){return b(c,Rt(r,e.transformOptions),{targetLanguage:r,setParentRecursive:!1,transformObjectLiteral:{shouldTransformAsExpression(e,t){const r=(e=c.getOriginalNode(e)).parent;return!(r&&c.isCallExpression(r)&&Gt(c,r))&&!(t&&!Vt(t,n))}},transformArguments:{shouldTransform(e,t,r){if(function(e,t,r){if(!t.isArrowFunction(e)&&!t.isFunctionExpression(e))return!1;const n=e.parent;if(!t.isCallExpression(n))return!1;const i=n.expression;if(!t.isPropertyAccessExpression(i))return!1;const s=i.name.getText();if(!$t.includes(s))return!1;let o=r.getNonNullableType(r.getTypeAtLocation(i.expression));if(o.flags===t.TypeFlags.Any){let e=i.expression;t.isParenthesizedExpression(e)&&(e=e.expression),t.isAsExpression(e)&&(o=r.getNonNullableType(r.getTypeAtLocation(e.expression)))}return!(!r.isArrayType(o)&&!r.isTupleType(o))||(o.isUnion()||o.isIntersection()?o.types.some((e=>Mt(e))):!!Mt(o))}(e=c.getOriginalNode(e),c,r))return!1;const n=c.isMethodDeclaration(e)?e.parent:e.parent.parent;if(n&&c.isObjectLiteralExpression(n)){let e=n.parent;if(e&&(c.isAsExpression(e)&&(e=e.parent),c.isCallExpression(e)))if(c.isIdentifier(e.expression)){const t=e.expression.getText();if(Bt.includes(t))return!1}else if(Gt(c,e))return!1}return zt(c,r,e)}},transformReturnType:{shouldTransform(e,t,r){if(e=c.getOriginalNode(e),c.isMethodDeclaration(e)&&c.isIdentifier(e.name)){if("provide"===e.name.getText())return!1}return zt(c,r,e)}},transformGenericsParameterDefaults:{shouldTransform:(e,t,r,i)=>!((c.isCallExpression(e)||c.isNewExpression(e))&&!function(e,t,r){const n=function(e,t){const r=t.getSymbolAtLocation(e);if(r){const e=r.declarations;if(e&&e.length>0)return e[0]}}(e,t);if(n)return Jt(n,r);return!0}(e.expression,r,n))&&!(t&&!Vt(t,n))},transformRestParameters:{shouldTransform(e,t,r,i){const s=t.declaration;return!s||Jt(s,n)}},transformNarrowType:{shouldTransformNonNullable:(e,t)=>r===exports.TargetLanguage.Kotlin?!c.isIdentifier(e)&&Xt(e,c):r===exports.TargetLanguage.Swift&&Xt(e,c)}})(t)},watchFile:e.watchFile,normalizeFileName:e.normalizeFileName,sourceMapCallback:(e,t,a)=>{const c=o(n.relative(u,e));if(e.endsWith(".uvue.map")||e.endsWith(".vue.map")){const e=n.resolve(l,c.replace(".map",".ts.map"));if(i.existsSync(e)){t=function(e,t){if(!e)return t;if(!t)return e;const r=JSON.parse(e),n=JSON.parse(t),i=new s.SourceMapConsumer(r),o=new s.SourceMapConsumer(n),a=new s.SourceMapGenerator(r);o.eachMapping((function(e){if(null==e.originalLine)return;const t=i.originalPositionFor({line:e.originalLine,column:e.originalColumn});null!=t.source&&a.addMapping({original:{line:t.line,column:t.column},generated:{line:e.generatedLine,column:e.generatedColumn},source:t.source,name:t.name})}));return[r,n].forEach((function(e,t){e.sources.forEach((function(e){const r=(0===t?i:o).sourceContentFor(e);null!=r&&a.setSourceContent(e,r)}))})),a.toString()}(i.readFileSync(e,"utf8"),t)}}return a?.(e,function(e,t){const r=JSON.parse(t);return r.sources=r.sources.map((t=>{const r=t.split("/.tsc/"+Wt(e)+"/");return(t=(t=r[1]||r[0]).split("?")[0]).replace(".uts.ts",".uts")})),JSON.stringify(r)}(r,t)),!0}};return this._utsCompiler=new f(k),this._utsCompiler.init()}},exports.initTargetHacker=Kt,exports.initTargetTransformers=Rt;
